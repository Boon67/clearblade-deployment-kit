function Controls(){var a=document.getElementById("update"),b=document.getElementById("incremental"),c=document.getElementById("random"),d=document.getElementById("rescale"),e=document.getElementById("maxvalue"),f=function(){b.checked?incrementalUpdate():c.checked&&randomUpdate(),a.value="stop"},g=function(){stopAnimation(),a.value="start"},h=function(){return"stop"==a.value};this.start=f,a.onclick=function(){h()?g():f()},b.onchange=c.onchange=function(){h()&&(g(),f())},d.onclick=function(){var a=parseInt(e.value);a!=speedometer.max()&&(h()&&g(),speedometer.animatedRescale(a,2e3))}}function DigitalDisplay(a){function b(a,b,c,e){for(var f=0;f<7;f++)b&1<<f&&j.fillPolygon(d(c,e,a[f]))}function c(a){var b=function(b){return b*a*h},c=function(b){return b*a*i};return[[b(.28),c(.08),b(1),c(.08),b(.88),c(.15),b(.38),c(.15),b(.28),c(.08)],[b(.3),c(.49),b(.18),c(.52),b(.26),c(.1),b(.36),c(.17),b(.3),c(.49)],[b(1),c(.1),b(.93),c(.52),b(.84),c(.49),b(.9),c(.17),b(1),c(.11)],[b(.2),c(.54),b(.31),c(.5),b(.83),c(.5),b(.9),c(.54),b(.82),c(.56),b(.29),c(.56),b(.2),c(.54)],[b(.22),c(.91),b(.1),c(.98),b(.17),c(.55),b(.28),c(.59),b(.22),c(.91)],[b(.92),c(.55),b(.87),c(.98),b(.78),c(.92),b(.82),c(.59),b(.92),c(.55)],[b(.74),c(.93),b(.84),c(1),b(.13),c(1),b(.22),c(.93),b(.74),c(.93)]]}function d(a,b,c){var d=c.length;1&d&&d--;for(var e=new Array,f=0;f<d/2;f++)e[2*f+0]=a+c[2*f+0],e[2*f+1]=b+c[2*f+1];return e}var e=a.element,f=a.width||300,g={placeholders:a.placeholders||"Gray",digits:a.digits||"Gray"},h=a.xScale||.6,i=a.yScale||.8,j=TBE.GetElement2DContext(e),k=[119,36,93,109,46,107,123,37,127,111];this.clear=function(){TBE.ClearCanvas(e)},this.drawNumber=function(a,d,e,i){var l=c(i),m=Math.round(a);j.fillStyle=g.placeholders,j.globalAlpha=.15;for(var n=i*h,o=(f-n*d)/2,p=0;p<d;p++)b(l,127,o,e),o+=n;j.fillStyle=g.digits,j.globalAlpha=.8;for(var p=0;p<d&&(o-=n,b(l,k[m%10],o,e),0!=(m=Math.floor(m/10)));p++);}}function incrementalUpdate(){var a=speedometer.value()<speedometer.max()?speedometer.max():speedometer.min();speedometer.animatedUpdate(a,5e3)}function randomUpdate(){var a=Math.random()*speedometer.max(),b=5e3*Math.random();speedometer.animatedUpdate(a,b)}function stopAnimation(){speedometer.stopAnimation()}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function cutHex(a){return"#"==a.charAt(0)?a.substring(1,7):a}function getStyle(a,b){var c="";return document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b):a.currentStyle&&(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b]),c}function onCreateElementNsReady(a){void 0!=document.createElementNS?a():setTimeout(function(){onCreateElementNsReady(a)},100)}function Speedometer(a){function b(a){return a>=j?j:a<=h?h:a}function c(){var a=document.createEvent("UIEvent");a.initUIEvent("speedometer:animateend",!1,!1,window,k),e.dispatchEvent(a)}var d=arguments[1]||{},e=document.getElementById(a||"speedometer");if(!e)throw"No container found!";var f=TBE.GetElementComputedStyle(e),g=Math.min(parseInt(f.width),parseInt(f.height));if(!g)throw"Cannot get container dimensions!";var h=d.min||0,j=d.max||100,k=d.value||h,l=d.threshold||50,m=d.thresholdPivot||35,n=(d.meterFromAngle||-135)-90,o=(d.meterToAngle||135)-90,p=o-n,q=d.meterTicksCount||10,r=d.meterMarksCount||3,s=(d.meterGapScale||10)/100;s>1&&(s=1);var t=void 0==d.glossy||Boolean(d.glossy),u=void 0==d.display||Boolean(d.display),v=void 0==d.centerRimScale?.3:Float(d.centerRimScale),w=void 0==d.center?.25:Float(d.centerScale);if(!Speedometer.themes.default)throw"Default theme missing! Please load themes/default.js";var x=Speedometer.themes[d.theme]||Speedometer.themes.default;for(key in Speedometer.themes.default)void 0==x[key]&&(x[key]=Speedometer.themes.default[key]);var y={dial:x.dial,rim:x.rim,rimArc:x.rimArc,thresh:x.thresh,center:x.center,nose:x.nose,hand:{main:x.hand,shine:x.handShine,shineTo:x.handShineTo},meter:{ticks:x.ticks,marks:x.marks,strings:x.strings,font:x.font},digits:x.digits},z={background:TBE.CreateSquareCanvasElement(g),foreground:TBE.CreateSquareCanvasElement(g),hand:TBE.CreateSquareCanvasElement(g),meter:TBE.CreateSquareCanvasElement(g),digits:TBE.CreateSquareCanvasElement(g)},A={background:TBE.GetElement2DContext(z.background),foreground:TBE.GetElement2DContext(z.foreground),hand:TBE.GetElement2DContext(z.hand),meter:TBE.GetElement2DContext(z.meter)},B=function(a){return this.x=.05*g,this.y=.05*g,this.w=g-2*this.x,this.h=g-2*this.y,this.cx=this.w/2+this.x,this.cy=this.h/2+this.y,this}.apply({});u&&(u=new DigitalDisplay({element:z.digits,placeholders:y.dial,digits:y.digits,width:g})),e.appendChild(z.background),e.appendChild(z.meter),e.appendChild(z.digits),e.appendChild(z.hand),e.appendChild(z.foreground),this.draw=function(){A.background&&A.foreground&&A.hand&&(this.drawBackground(),this.drawCenter(),this.drawGloss(),this.drawMeter(),this.drawHand(),u&&u.drawNumber(k,j.toString().length,B.h/1.2,g/9))},this.update=function(a){return k=b(a),A.hand&&(TBE.ClearCanvas(z.hand),this.drawHand()),u&&(u.clear(),u.drawNumber(k,j.toString().length,B.h/1.2,g/9)),k},this.rescale=function(a){j=a,A.meter&&(TBE.ClearCanvas(z.meter),this.drawMeter()),this.update(k)};var C={};this.addEventListener=function(a,b){return void 0==C[b]&&(e.addEventListener(a,b,!1),C[b]=a,!0)},this.removeEventListener=function(a,b){return!!C[b]&&(e.removeEventListener(a,b,!1),delete C[b],!0)},this.removeAllListeners=function(){for(func in C)this.removeEventListener(C[func],func)};var D=null;this.animatedUpdate=function(a,d,e){var f,g=25,h=this;if(D)throw"Animation already running!";if((a=b(a))==k||d<=0)throw"Invalid parameters (value: "+a+", time: "+d+")";e&&this.addEventListener("speedometer:animateend",e,!1),f=(a-k)/g/(d/1e3),D=function(){var b=Math.abs(k-a)<Math.abs(f);!D||b?(h.stopAnimation(),b&&(h.update(a),c())):(h.update(k+f),setTimeout(D,1e3/g))},D.call()},this.animatedRescale=function(a,b,d){var e,f=25,g=this;if(D)throw"Animation already running!";if(a==j||a<=h||b<=0)throw"Invalid parameters (value: "+a+", time: "+b+")";d&&this.addEventListener("speedometer:animateend",d,!1),e=(a-j)/f/(b/1e3),D=function(){var b=Math.abs(j-a)<Math.abs(e);!D||b?(g.stopAnimation(),b&&(g.rescale(a),c())):(g.rescale(j+e),setTimeout(D,1e3/f))},D.call()},this.stopAnimation=function(){D=null},this.value=function(){return k},this.min=function(){return h},this.max=function(){return j},this.drawMeter=function(){function a(a,b){var c=e+m*Math.cos(a),d=f+m*Math.sin(a),g=e+(m-b.size)*Math.cos(a),h=f+(m-b.size)*Math.sin(a);k.strokeStyle=b.color,k.lineWidth=b.width,k.moveTo(c,d),k.lineTo(g,h)}function b(a,b){tx=e+(m-b.offset)*Math.cos(b.angle),ty=f+l/2+(m-b.offset)*Math.sin(b.angle),k.fillStyle=b.color,k.textAlign="center",k.font=Math.round(b.size)+"pt "+y.meter.font,k.textAlignment="center",k.fillText(a,tx,ty)}var c,d,e=B.cx,f=B.cy,k=A.meter,l=g*(s+.5)*.03,m=(g-l)/2-5*l,p=o-n,t=(j-h)/q;for(d=TBE.Deg2Rad(p/q),c=TBE.Deg2Rad(n),k.beginPath(),i=0;i<=q;i++)a(c,{size:g/20,width:g/50,color:y.meter.ticks}),b(h+Math.round(t*i),{angle:c,color:y.meter.strings,offset:g/10,size:g/23}),c+=d;for(k.stroke(),d=TBE.Deg2Rad(p/q/(r+1)),c=TBE.Deg2Rad(n),k.beginPath(),i=0;i<(r+1)*q;i++)i%(r+1)!=0&&a(c,{size:g/50,width:g/100,color:y.meter.marks}),c+=d;k.stroke()},this.drawGloss=function(){if(t){var a=A.foreground,b=.15*g,c=B.y+.07*g,d=.7*g,e=.65*g,f=a.createLinearGradient(0,0,0,c+e);if(f.addColorStop(0,"rgba(255,255,255,1.0)"),f.addColorStop(1,"rgba(255,255,255, 0.0)"),a.fillStyle=f,a.fillEllipse(b,c,d,e),u){b=.3*g,c=B.y+.7*g,d=.4*g,e=.15*g;var h=a.createLinearGradient(0,c,0,c+e);h.addColorStop(0,"rgba(255,255,255,0.0)"),h.addColorStop(.25,"rgba(255,255,255,0.0)"),h.addColorStop(1,"rgba(255,255,255,1.0)"),a.fillStyle=h,a.fillEllipse(b,c,d,e)}}},this.drawCenter=function(){var a,b=B.cx,c=B.cy,d=A.foreground;if(v>0&&v>w){a=v*(g/2);var e=b-a/2,f=c-a/2,h=a,i=a,j=d.createLinearGradient(0,f,0,f+i);j.addColorStop(0,y.center),j.addColorStop(.5,y.center),j.addColorStop(1,y.dial),d.fillStyle=j,d.fillEllipse(e,f,h,i)}if(w>0){a=w*(g/2),e=b-a/2,f=c-a/2,h=a,i=a;var k=d.createLinearGradient(e,f,h+e,f+i);k.addColorStop(0,y.nose),k.addColorStop(1,y.center),d.fillStyle=k,d.fillEllipse(e,f,h,i)}},this.drawHand=function(){var a=B.cx,b=B.cy,c=A.hand,d=g/2-.12*g,e=j-h;e=j*(k-h)/e,e=(o-n)*e/j,e+=n;var f=TBE.Deg2Rad(e),i=new Array(10);i[0]=a+d*Math.cos(f),i[1]=b+d*Math.sin(f),i[8]=a+d*Math.cos(f-.02),i[9]=b+d*Math.sin(f-.02),f=TBE.Deg2Rad(e+20),i[2]=a+.09*g*Math.cos(f),i[3]=b+.09*g*Math.sin(f),i[4]=a,i[5]=b,f=TBE.Deg2Rad(e-20),i[6]=a+.09*g*Math.cos(f),i[7]=b+.09*g*Math.sin(f),c.fillStyle=y.hand.main,c.fillPolygon(i),i=new Array(6),f=TBE.Deg2Rad(e),i[0]=a+d*Math.cos(f),i[1]=b+d*Math.sin(f),f=TBE.Deg2Rad(e+20),i[2]=a+.09*g*Math.cos(f),i[3]=b+.09*g*Math.sin(f),i[4]=a,i[5]=b;var l=c.createLinearGradient(0,0,a,b);l.addColorStop(0,y.hand.shine),l.addColorStop(1,y.hand.shineTo),c.fillStyle=l,c.fillPolygon(i)},this.drawBackground=function(){var a=B.x,b=B.y,c=B.w,d=B.h,e=A.background;e.fillStyle=y.dial,e.ellipse(a,b,c,d),e.globalAlpha=.45,e.fill(),e.strokeStyle=y.rim,e.lineWidth=.03*c,e.ellipse(a,b,c,d),e.globalAlpha=1,e.stroke(),e.strokeStyle=y.rimArc,e.lineWidth=g/40;var f=.03*g;e.strokeBoxedArc(a+f,b+f,c-2*f,d-2*f,TBE.Deg2Rad(n),TBE.Deg2Rad(p),!1),e.strokeStyle=y.thresh,e.lineWidth=g/50;var i=j-h;i=j*(m-h)/i,i=(o-n)*i/j,i+=n;var k=i-p*l/j/2;k<=n&&(k=n);var q=p*l/j;k+q>o&&(q=o-k),e.strokeBoxedArc(a+f,b+f,c-2*f,d-2*f,TBE.Deg2Rad(k),TBE.Deg2Rad(q),!1)}}!function(){var a=function(a,b){function c(a){e&&clearInterval(e),e=setInterval(function(){d.updateNow()},a)}var d=this,e=null,f=a,g=0,h=!1;c(1e3*f.refresh),this.updateNow=function(){if(!(g>1&&!f.use_thingproxy||g>2)){var a=f.url;2==g&&f.use_thingproxy&&(a=("https:"==location.protocol?"https:":"http:")+"//thingproxy.freeboard.io/fetch/"+encodeURI(f.url));var c=f.body;if(c)try{c=JSON.parse(c)}catch(a){}$.ajax({url:a,dataType:1==g?"JSONP":"JSON",type:f.method||"GET",data:c,beforeSend:function(a){try{_.each(f.headers,function(b){var c=b.name,d=b.value;_.isUndefined(c)||_.isUndefined(d)||a.setRequestHeader(c,d)})}catch(a){}},success:function(a){h=!0,b(a)},error:function(a,b,c){h||(g++,d.updateNow())}})}},this.onDispose=function(){clearInterval(e),e=null},this.onSettingsChanged=function(a){h=!1,g=0,f=a,c(1e3*f.refresh),d.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"JSON",settings:[{name:"url",display_name:"URL",type:"text"},{name:"use_thingproxy",display_name:"Try thingproxy",description:'A direct JSON connection will be tried first, if that fails, a JSONP connection will be tried. If that fails, you can use thingproxy, which can solve many connection problems to APIs. <a href="https://github.com/Freeboard/thingproxy" target="_blank">More information</a>.',type:"boolean",default_value:!0},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"text",description:"The body of the request. Normally only used if method is POST"},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}]}],newInstance:function(b,c,d){c(new a(b,d))}});var b=function(a,b){function c(){e&&(clearTimeout(e),e=null)}function d(){c(),e=setInterval(f.updateNow,1e3*g.refresh)}var e,f=this,g=a;this.updateNow=function(){var a=new Date,c={numeric_value:a.getTime(),full_string_value:a.toLocaleString(),date_string_value:a.toLocaleDateString(),time_string_value:a.toLocaleTimeString(),date_object:a};b(c)},this.onDispose=function(){c()},this.onSettingsChanged=function(a){g=a,d()},d()};freeboard.loadDatasourcePlugin({type_name:"clock",display_name:"Clock",settings:[{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:1}],newInstance:function(a,c,d){c(new b(a,d))}})}(),function(){function a(a,b,c){var d=$(b).text();if(d!=a)if($.isNumeric(a)&&$.isNumeric(d)){var e=a.toString().split("."),f=0;e.length>1&&(f=e[1].length),e=d.toString().split(".");var g=0;e.length>1&&(g=e[1].length),jQuery({transitionValue:Number(d),precisionValue:g}).animate({transitionValue:Number(a),precisionValue:f},{duration:c,step:function(){$(b).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(b).text(a)}})}else $(b).text(a)}function b(a,b){for(var c=$("<div class='sparkline-legend'></div>"),d=0;d<b.length;d++){var f=e[d%e.length],g=b[d];c.append("<div class='sparkline-legend-value'><span style='color:"+f+"'>&#9679;</span>"+g+"</div>")}a.empty().append(c),freeboard.addStyle(".sparkline-legend","margin:5px;"),freeboard.addStyle(".sparkline-legend-value","color:white; font:10px arial,san serif; float:left; overflow:hidden; width:50%;"),freeboard.addStyle(".sparkline-legend-value span","font-weight:bold; padding-right:5px;")}function c(a,b,c){var f=$(a).data().values,g=$(a).data().valueMin,h=$(a).data().valueMax;f||(f=[],g=void 0,h=void 0);var i=function(a,b){f[b]||(f[b]=[]),f[b].length>=d&&f[b].shift(),f[b].push(Number(a)),(void 0===g||a<g)&&(g=a),(void 0===h||a>h)&&(h=a)};_.isArray(b)?_.each(b,i):i(b,0),$(a).data().values=f,$(a).data().valueMin=g,$(a).data().valueMax=h;var j='<span style="color: {{color}}">&#9679;</span> {{y}}',k=!1;_.each(f,function(b,d){$(a).sparkline(b,{type:"line",composite:k,height:"100%",width:"100%",fillColor:!1,lineColor:e[d%e.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:g,chartRangeMax:h,tooltipFormat:c&&c[d]?j+" ("+c[d]+")":j}),k=!0})}var d=100,e=["#FF9933","#FF0000","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"],f=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",f+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",f+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;");var g=function(b){function d(){_.isUndefined(f.units)||""==f.units?j.css("max-width","100%"):j.css("max-width",g.innerWidth()-k.outerWidth(!0)+"px")}var e=this,f=b,g=$('<div class="tw-display"></div>'),h=$('<h2 class="section-title tw-title tw-td"></h2>'),i=$('<div class="tw-value-wrapper tw-td"></div>'),j=$('<div class="tw-value"></div>'),k=$('<div class="tw-unit"></div>'),l=$('<div class="tw-sparkline tw-td"></div>');this.render=function(a){$(a).empty(),d(),$(g).append($('<div class="tw-tr"></div>').append(h)).append($('<div class="tw-tr"></div>').append(i.append(j).append(k))).append($('<div class="tw-tr"></div>').append(l)),$(a).append(g),d()},this.onSettingsChanged=function(a){f=a;var b=!_.isUndefined(a.title)&&""!=a.title,c=!_.isUndefined(a.units)&&""!=a.units;a.sparkline?l.attr("style",null):(delete l.data().values,l.empty(),l.hide()),b?(h.html(_.isUndefined(a.title)?"":a.title),h.attr("style",null)):(h.empty(),h.hide()),c?(k.html(_.isUndefined(a.units)?"":a.units),k.attr("style",null)):(k.empty(),k.hide());var e=a.size;a.sparkline&&(e-=15);var g,m;g=f.italic?"italic":"normal",m=f.bold?"bold":"normal",i.css({"text-align":a.text_alignment,"white-space":"normal"}),j.css({"font-size":e+"px","font-family":f.disp_font,"font-weight":m,"font-style":g,color:a.font_color}),d()},this.onSizeChanged=function(){d()},this.onCalculatedValueChanged=function(b,d){f.animate?a(d,j,500):j.text(d),f.sparkline&&c(l,d)},this.onDispose=function(){},e.getValue=function(){},this.getHeight=function(){return utils.widget.calculateHeight(f.sizeInBlocks)},this.onSettingsChanged(b)};freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",external_scripts:["plugins/thirdparty/jquery.sparkline.min.js"],settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Font size",type:"number",default_value:30},{name:"disp_font",display_name:"Font",type:"option",options:[{name:"Georgia",value:'"Georgia",serif'},{name:"Palatino Linotype",value:'"Palatino Linotype", "Book Antiqua", Palatino, serif'},{name:"Time New Roman",value:'"Times New Roman", Times, serif'},{name:"Helvetica Neue",value:'"Helvetica Neue",Helvetica,Arial,sans-serif'},{name:"Arial",value:"Arial, Helvetica, sans-serif"},{name:"Arial Black",value:'"Arial Black", Gadget, sans-serif'},{name:"Comic Sans MS",value:'"Comic Sans MS", cursive, sans-serif'},{name:"Impact",value:"Impact, Charcoal, sans-serif"},{name:"Lucida Sans Unicode",value:'"Lucida Sans Unicode", "Lucida Grande", sans-serif'},{name:"Tahoma",value:"Tahoma, Geneva, sans-serif"},{name:"Trebuchet MS",value:'"Trebuchet MS", Helvetica, sans-serif'},{name:"Verdana",value:"Verdana, Geneva, sans-serif"},{name:"Courier New",value:'"Courier New", Courier, monospace'},{name:"Lucida Console",value:'"Lucida Console", Monaco, monospace'}]},{name:"font_color",display_name:"Font color",type:"text",default_value:"inherit"},{name:"text_alignment",display_name:"Alignment",type:"text",default_value:"left"},{name:"italic",display_name:"italic",type:"boolean",default_value:!1},{name:"bold",display_name:"Bold",type:"boolean",default_value:!1},{name:"textContent",display_name:"Content",type:"data",multi_input:!0,incoming_parser:!0},{name:"sizeInBlocks",display_name:"Size in Blocks",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:1},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new g(a))}}),freeboard.addStyle(".sparkline","width:100%;height: 75px;");var h=function(a){var d=this,e=$('<h2 class="section-title"></h2>').css("text-align","center"),f=$('<div class="sparkline"></div>'),g=$("<div></div>"),h=a;this.render=function(a){$(a).append(e).append(f).append(g)},this.onSettingsChanged=function(a){h=a,e.html(_.isUndefined(a.title)?"":a.title),a.include_legend&&b(g,a.legend.split(","))},this.onCalculatedValueChanged=function(a,b){h.legend?c(f,b,h.legend.split(",")):c(f,b)},this.onDispose=function(){},d.getValue=function(){},this.getHeight=function(){var a=0;if(h.include_legend&&h.legend){var b=h.legend.split(",").length;b>4?a=.5*Math.floor((b-1)/4):b&&(a=.5)}return utils.widget.calculateHeight(2+a)},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"sparkline",display_name:"Sparkline",external_scripts:["plugins/thirdparty/jquery.sparkline.min.js"],settings:[{name:"title",display_name:"Title",type:"text"},{name:"sources",display_name:"Sources",type:"data",multi_input:!0,incoming_parser:!0},{name:"include_legend",display_name:"Include Legend",type:"boolean"},{name:"legend",display_name:"Legend",type:"text",description:"Comma-separated for multiple sparklines"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new h(a))}}),freeboard.addStyle("div.pointer-value","position:absolute;height:95px;margin: auto;top: 0px;bottom: 0px;width: 100%;text-align:center;");var i=function(a){function b(a){if(!a||a.length<2)return[];var b=[];b.push(["m",a[0],a[1]]);for(var c=2;c<a.length;c+=2)b.push(["l",a[c],a[c+1]]);return b.push(["z"]),b}var c,d,e,f,g=this,h=3,i=0,j=$('<div class="widget-big-text"></div>'),k=$("<div></div>");this.render=function(a){e=$(a).width(),f=$(a).height();var g=Math.min(e,f)/2-2*h;c=Raphael($(a).get()[0],e,f);var i=c.circle(e/2,f/2,g);i.attr("stroke","#FF9900"),i.attr("stroke-width",h),d=c.path(b([e/2,f/2-g+h,15,20,-30,0])),d.attr("stroke-width",0),d.attr("fill","#fff"),$(a).append($('<div class="pointer-value"></div>').append(j).append(k))},this.onSettingsChanged=function(a){k.html(a.units)},this.onCalculatedValueChanged=function(a,b){if("direction"==a){if(!_.isUndefined(d)){d.animate({transform:"r"+b+","+e/2+","+f/2},250,"bounce")}i=b}else"value_text"==a&&j.html(b)},this.onDispose=function(){},g.getValue=function(){},this.getHeight=function(){return utils.widget.calculateHeight(4)},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"pointer",display_name:"Pointer",external_scripts:["plugins/thirdparty/raphael.2.1.0.min.js"],settings:[{name:"direction",display_name:"Direction",type:"calculated",description:"In degrees"},{name:"value_text",display_name:"Value Text",type:"calculated"},{name:"units",display_name:"Units",type:"text"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new i(a))}});var j=function(a){function b(){e&&(clearInterval(e),e=null)}function c(){if(d&&f){var a=f+(-1==f.indexOf("?")?"?":"&")+Date.now();$(d).css({"background-image":"url("+a+")"})}}var d,e,f,g=a;this.render=function(a){$(a).css({width:"100%",height:"100%","background-size":g.format_type,"background-position":"center","background-repeat":"no-repeat"}),d=a},this.onSettingsChanged=function(a){b(),g=a,a.refresh&&a.refresh>0&&(e=setInterval(c,1e3*Number(a.refresh))),this.render(d)},this.onCalculatedValueChanged=function(a,b){f=b,c()},this.onDispose=function(){b()},this.getHeight=function(){return utils.widget.calculateHeight(g.blockHeight)},this.getValue=function(){return f},this.onSizeChanged=function(){},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"picture",display_name:"Picture",fill_size:!0,settings:[{name:"imgUrl",display_name:"Image URL",type:"data",multi_input:!0,incoming_parser:!0},{name:"format_type",display_name:"Format View",type:"option",options:[{name:"Fit",value:"contain"},{name:"Fill",value:"cover"}]},{type:"number",display_name:"Block Height",name:"blockHeight",suffix:"blocks",default_value:4},{type:"number",display_name:"Refresh every",name:"refresh",suffix:"seconds",description:"Set to zero if the image doesn't need to be refreshed",default_value:0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new j(a))}}),freeboard.addStyle(".indicator-light","border-radius:50%;width:22px;height:22px;border:2px solid #3d3d3d;margin-top:5px;float:left;background-color:#222;margin-right:10px;"),freeboard.addStyle(".indicator-light.on","background-color:#FFC773;box-shadow: 0px 0px 15px #FF9900;border-color:#FDF1DF;"),freeboard.addStyle(".indicator-text","margin-top:10px;");var k=function(a){function b(){g.toggleClass("on",i),i?f.text(h.indicatorTextOn):f.text(h.indicatorTextOff)}var c,d,e=$('<h2 class="section-title"></h2>'),f=$('<div class="indicator-text"></div>'),g=$('<div class="indicator-light"></div>'),h=a,i=!1;this.render=function(a){$(a).append(e).append(g).append(f)},this.getValue=function(){return i},this.onSettingsChanged=function(a){c=h.indicatorTextOn,d=h.indicatorTextOff,h=a,h.indicatorTextOn=c,h.indicatorTextOff=d,e.html(_.isUndefined(a.title)?"":a.title),b()},this.onCalculatedValueChanged=function(a,c){"true"!=c&&1!=c||(i=!0),"false"!=c&&0!=c||(i=!1),b()},this.onDispose=function(){},this.getHeight=function(){return utils.widget.calculateHeight(utils.widget.minBlocks)},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"indicator",display_name:"Indicator Light",settings:[{name:"title",display_name:"Title",type:"text"},{name:"indicatorTextOff",display_name:"Indicator Text Off",type:"data",force_data:"static"},{name:"indicatorTextOn",display_name:"Indicator Text On",type:"data",force_data:"static"},{name:"lightStatus",display_name:"Light Status",type:"data",multi_input:!0,incoming_parser:!0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new k(a))}}),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");var l=function(a){var b=this,c=$('<div class="html-widget"></div>'),d=a;this.render=function(a){$(a).append(c)},this.onSettingsChanged=function(a){d=a,d.height=utils.widget.calculateHeight(d.height)},this.onCalculatedValueChanged=function(a,b){c.html(b)},this.onDispose=function(){},this.getHeight=function(){return utils.widget.calculateHeight(d.height)},b.getValue=function(){},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"html",display_name:"HTML",fill_size:!0,settings:[{name:"widgetContent",display_name:"Content",type:"data",multi_input:!0,incoming_parser:!0},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new l(a))}})}();var urlStor={},callStore=[],loaded=!1,mapLoader=function(a,b){function c(){loaded=!0;for(var a=callStore.length,b=0;b<a;b++)callStore[b]()}void 0==urlStor[a]?(urlStor[a]=!0,callStore.push(b),window.gmap_initialize=c,a+="&callback=gmap_initialize",head.js(a)):1==loaded?b():callStore.push(b)},RbDisplayMessageContainer=function(a){function b(b){return this.config=b,this.element=a("<div></div>").attr("class","rbDisplayMessageContainer"),this.render(),this.element}return b.prototype={render:function(){this.renderMessageContainer(this.config)},renderMessageContainer:function(b){this.element.append(a("<h4>"+b.message+"</h4>")),this.element.append(a("<h4>"+b.messageDetail+"</h4>"))},onOkClicked:function(a){RuleBuilderUtils.closeDialog()}},b}(jQuery),RbRuleAlertContainer=function(a){function b(b){return this.rule=b.rule.rulename?b.rule:{},this.widgetId=b.widgetId,this.allowEdit=b.allowEdit,this.rule.alerts||(this.rule.alerts=[]),this.readOnly=b.readOnly||!1,this.element=a("<div></div>").attr("class","RbRuleAlertContainer"),this.render(),this.element}return b.prototype={render:function(){this.element.empty(),this.element.append(this.constructThenContainer())},getAlertText:function(){for(var a=[],b=0;b<this.rule.alerts.length;b++)switch(this.rule.alerts[b].type){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:a.push(this.getSMSAlertText(this.rule.alerts[b]));break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:a.push(this.getEmailAlertText(this.rule.alerts[b]));break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:a.push(this.getServiceAlertText(this.rule.alerts[b]))}return a},getSMSAlertText:function(a){var b=a.provider[0].toUpperCase()+a.provider.substring(1)+" ";return b+=a.type.toUpperCase()+" FROM ",b+=a.options.smsFrom},getEmailAlertText:function(a){var b=a.provider[0].toUpperCase()+a.provider.substring(1)+" ";return b+=a.type[0].toUpperCase()+a.type.substring(1)+" FROM ",b+=a.options.emailFrom},getServiceAlertText:function(a){var b="Invoke "+a.type[0].toUpperCase()+a.type.substring(1)+" ";return b+=a.options.serviceName},constructThenContainer:function(){var b=a("<div></div>").attr("class",".RbRuleThenContainer"),c=a("<fieldset><legend>Then</legend></fieldset>");if(this.readOnly)c.append(this.constructReadOnlyAlerts());else{if(0===this.rule.alerts.length)c.append(this.getNewAlert(0));else for(var d=0;d<this.rule.alerts.length;d++)c.append(this.getNewAlert(d));c.append(this.constructThenButtonContainer())}return b.append(c),b},constructReadOnlyAlerts:function(){for(var b=a("<div></div>").attr("class",".RbRuleAlertReadOnly"),c=this.getAlertText(),d=a("<ul></ul>").attr("class",".RbRuleAlertList"),e=0;e<c.length;e++)d.append(a("<li>"+c[e]+"</li>").attr("class",".RbRuleAlertReadOnly"));return b.append(d),this.allowEdit&&b.append(a("<button>Edit</button>").attr("class","editLink clickable").on("click",a.proxy(this.onEditClick,this))),b},constructThenButtonContainer:function(){return a("<div></div>").attr("class","then-btn-container btn-container ").append(a('<input type= "button" value="+ Add THEN">').attr("class","addConditionBtn btn").on("click",a.proxy(this.onAddThen,this))).append(a('<input type= "button" value="Next">').attr("class","nextBtn btn").on("click",a.proxy(this.onNextClick,this)))},onAddThen:function(b){this.displayedFormsAreValid()&&(this.getNewAlert().insertBefore(this.element.find(".then-btn-container")),a("body").trigger(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.RESIZE_DIALOG))},onNextClick:function(a){this.displayedFormsAreValid()&&this.saveRuleAlerts()},getNewAlert:function(b){var b=b||this.element.find(".RbRuleAlertForm").length,c=a('<div class ="RbRuleAlertItemContainer"></div>'),d=a('<div class ="icon-container"><i class ="icon-trash"></i></div>').on("click",a.proxy(this.deleteAlert,this)),e=new RbRuleAlertItem({alert:this.rule.alerts[b]||{},readOnly:this.readOnly});return c.append(e),c.append(d),c},deleteAlert:function(b){a(b.currentTarget.parentElement).remove()},displayedFormsAreValid:function(){for(var b=this.element.find(".RbRuleAlertForm"),c=0;c<b.length;c++){var d=a(b[c]);d.removeData("validator"),d.removeData("unobtrusiveValidation");var e=d.find(".alert-select").val(),f=d.find(".provider-select").val(),g=RuleBuilderUtils.getAlertFields(e,f);e===RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE&&(g=g.concat(this.buildServiceFieldsForValidation(b[c])));var h=RuleBuilderUtils.getFormValidationOptions(g);if(d.validate(h),!d.valid())return!1}return!0},saveRuleAlerts:function(){var b=this.extractAlertsFromDOM();this.element.closest(a(".RbRuleContainer")).trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_ALERT,this.widgetId),[b])},extractAlertsFromDOM:function(){for(var a=[],b=this.element.find(".RbRuleAlertForm"),c=0;c<b.length;c++)a.push(this.extractAlertFromDOM(b[c]));return a},extractAlertFromDOM:function(b){var c={},d=a(b);c.options={},c.type=d.find(".alert-select").val(),c.provider=d.find(".provider-select").val()||"";for(var e=d.find(":text, textarea"),f=0;f<e.length;f++)c.options[e[f].name]=e[f].value;return c},onEditClick:function(){this.readOnly=!1,this.render(),this.element.closest(".RbRuleContainer").trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.EDIT_RULE,this.widgetId))},buildServiceFieldsForValidation:function(a){for(var b=[],c=this.getServiceParmDOMFields(a),d=0;d<c.length;d++){var e={};e.fieldName=c[d].name,e.fieldLabel=c[d].placeholder,e.validationOptions={},e.validationOptions.rules={},e.validationOptions.rules.required=!0,e.validationOptions.message={},e.validationOptions.message.required=e.fieldLabel+" is required",b.push(e)}return b},getServiceParmDOMFields:function(b){for(var c=[],d=a(b).find(".svcparm-container",b),e=0;e<d.length;e++)for(var f=a(d[e]).find("input",d[e]),g=0;g<f.length;g++)c.push(f[g]);return c}},b}(jQuery),RbRuleAlertItem=function(a){function b(b){return this.alert=b.alert||{},this.alert.options||(this.alert.options={}),this.element=a("<form></form>").attr("class","rbForm RbRuleAlertForm"),this.render(),this.element}return b.prototype={render:function(){this.element.append(this.constructAlertSelect()),this.element.append(this.constructProviderSelect()),(this.alert.provider||this.alert.type===RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE)&&this.element.append(this.constructFormFields())},constructAlertSelect:function(){var b=a('<div class=""></div>').attr("class","form-field-container alert-select-container");return b.append(a('<label class="form-field-label" for="alerttype">Trigger</label>')).append(a('<select name="alerttype"></select>').attr("class","styled-select form-field alert-select").append('<option value="">Select Alert Type</option>').append('<option value="sms">SMS</option>').append('<option value="email">E-Mail</option>').append('<option value="service">Service</option>').val(this.alert.type||"").on("change",a.proxy(this.onAlertChange,this))),b},constructProviderSelect:function(){var b=a('<div class="form-field-container provider-select-container"></div>').append(a('<label class="form-field-label" for="alerttype">Service</label>')),c=a('<select name="providers"></select>').attr("class","styled-select form-field provider-select").on("change",a.proxy(this.onProviderChange,this));return b.append(c),this.setProviderOptions(c),this.alert.type!==RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE&&b.hide(),b},setProviderOptions:function(a){a.find("option").remove(),a.append('<option value="" default selected>Select Alert Service</option>');for(var b=this.getProviders(this.alert.type),c=0;c<b.length;c++)a.append('<option value="'+b[c].providerName+'">'+b[c].providerLabel+"</option>");0===b.length?a.parent().hide():1===b.length&&(a.val(b[0].providerName),this.alert.provider=b[0].providerName,this.constructFormFields())},onAlertChange:function(a){var b=this.element.find(".provider-select-container");this.alert.type=a.currentTarget.value,this.alert.type!==RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE&&""!==this.alert.type?(b.show(),this.setProviderOptions(this.element.find(".provider-select"))):(this.alert.provider="",b.hide(),this.constructFormFields())},onProviderChange:function(a){this.alert.provider=a.currentTarget.value,this.constructFormFields()},constructFormFields:function(){this.element.find(".alert-fields").remove(),""!==this.alert.type&&(this.element.append(this.constructAlertFields()),this.alert.type===RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE&&this.renderServiceAlertFields())},constructAlertFields:function(){for(var b=a('<div class=""></div>').attr("class","alert-fields"),c=RuleBuilderUtils.getAlertFields(this.alert.type,this.alert.provider),d=0;d<c.length;d++){var e=a('<div class=""></div>').attr("class","alert-field");e.append(RuleBuilderUtils.createFormFields(c[d],!0,this.alert.options[c[d].fieldName]||"")),b.append(e)}if(this.alert.type===RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE){b.find("label[for='addServiceParm']").parent().addClass("addServiceParmContainer"),b.find("label[for='addServiceParm']").hide(),b.find(".addServiceParm").on("click",a.proxy(this.addServiceParm,this))}return b},getProviders:function(a){switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:return rbEmailAlertImpl.getProviders();case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:return rbSmsAlertImpl.getProviders();case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:return rbServiceAlertImpl.getProviders();default:return[]}},renderServiceAlertFields:function(a,b){for(var c=Object.keys(this.alert.options).filter(function(a){return a.indexOf("serviceParmName")>-1}),d=0;d<c.length;d+=1){var e=[{fieldName:c[d],fieldLabel:"Parameter Name",fieldTag:"input",fieldType:"text"},{fieldName:"serviceParmValue_"+c[d].split("_")[1],fieldLabel:"Parameter Value",fieldTag:"input",fieldType:"text"}];this.renderServiceParm(a,e)}},addServiceParm:function(a){var b=(new Date).getUTCMilliseconds();fields=[{fieldName:"serviceParmName_"+b,fieldLabel:"Parameter Name",fieldTag:"input",fieldType:"text"},{fieldName:"serviceParmValue_"+b,fieldLabel:"Parameter Value",fieldTag:"input",fieldType:"text"}],this.renderServiceParm(a.target.parentNode,fields)},renderServiceParm:function(b,c){var d=a('<div class="svcparm-container"></div>'),e=RuleBuilderUtils.createFormFields(c[0],!0,this.alert.options[c[0].fieldName]||""),f=RuleBuilderUtils.createFormFields(c[1],!0,this.alert.options[c[1].fieldName]||"");a(e).find(".form-field").addClass("serviceParmNameValue"),a(f).find(".form-field").addClass("serviceParmValueValue"),d.append(e,f),d.append(a('<div class="icon-container"></div>').append(a('<i class ="icon-trash"></i>')).on("click",a.proxy(this.deleteServiceParm,this))),this.element.find(".addServiceParmContainer").before(d)},deleteServiceParm:function(a){a.target.parentNode.parentNode.remove()}},b}(jQuery),RbRuleContainer=function(a){function b(b){return this.config=b,this.rule=this.config.rule||{},this.element=a("<div></div>").attr("class","RbRuleContainer"),this.render(),this.element}return b.prototype={render:function(){this.rule.rulename&&""!=this.rule.rulename?(this.renderEventContainer(!0),this.renderAlertContainer(!0),setTimeout(a.proxy(this.showOrHideButtons,this),500)):this.renderEventContainer(!1),this.bindEvents()},bindEvents:function(){this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_EVENT,this.config.widgetId),a.proxy(this.onEventSaved,this)),this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_ALERT,this.config.widgetId),a.proxy(this.onAlertSaved,this)),this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.EDIT_RULE,this.config.widgetId),a.proxy(this.showOrHideButtons,this)),this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.CLOSE_DIALOG,this.config.widgetId),a.proxy(this.onRuleDone,this))},renderEventContainer:function(a){this.element.empty(),this.element.append(new RbRuleEventContainer({rule:this.rule,widgetId:this.config.widgetId,readOnly:a,allowEdit:this.config.allowEdit}))},renderAlertContainer:function(a){this.element.find(".RbRuleAlertContainer").remove(),this.element.find(".rule-btn-container").remove(),this.element.append(new RbRuleAlertContainer({rule:this.rule,widgetId:this.config.widgetId,readOnly:a,allowEdit:this.config.allowEdit}))},showOrHideButtons:function(b){b||!this.rule.event.eventSource||0===this.rule.alerts.length?a("#dialog-ok").hide():a("#dialog-ok").show()},onRuleDone:function(b){this.config.allowEdit&&a("#"+this.config.widgetId+"> .rbRuleListContainer").trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_RULE,this.config.widgetId),[{rule:this.rule,ruleIndex:this.config.ruleIndex}])},onEventSaved:function(a,b){this.rule.rulename=b.rulename,this.rule.event=b.event,this.renderEventContainer(!0),this.renderAlertContainer(!!this.rule.alerts&&this.rule.alerts.length>0),this.showOrHideButtons()},onAlertSaved:function(a,b){for(var c=b,d=0;d<c.length;d++){for(var e=0;e<this.rule.alerts.length;e++)if(c[d].type===this.rule.alerts[e].type){this.rule.alerts[e].isCreated&&(c[d].isCreated=this.rule.alerts[e].isCreated),this.rule.alerts[e].serviceName&&(c[d].serviceName=this.rule.alerts[e].serviceName),this.rule.alerts[e].isCreated&&(c[d].triggerName=this.rule.alerts[e].triggerName),this.rule.alerts.splice(e,1);break}c[d].isCreated||(c[d].isCreated=!1)}this.rule.alerts=c,this.renderAlertContainer(!0),this.showOrHideButtons()}},b}(jQuery),RbRuleEventConditionItem=function(a){function b(b){return this.condition=b.condition||{},this.eventType=b.eventType,this.readOnly=b.readOnly||!1,this.conditionIndex=b.conditionIndex,this.element=a("<form></form>").attr("class","rbForm RbRuleEventConditionForm"),this.render(),this.element}return b.prototype={render:function(){this.readOnly?this.element.append(this.constructReadOnlyInterface()):(this.conditionIndex>0&&this.element.append(this.constructLogicalCondition()),this.element.append(this.constructFormFields())),this.bindEvents()},bindEvents:function(){},constructLogicalCondition:function(){return cond=a('<div class="form-field-container logical-condition-container"></div>').append(a('<label class="form-field-label" for="logical">Operator</label>')).append(a('<select name="logical"></select>').attr("class","styled-select logical-condition-select form-field").append('<option value="AND" default>AND</option>').append('<option value="OR">OR</option>').val(this.condition.logical||"AND").on("change",a.proxy(this.onSelectChange,this)))},onSelectChange:function(a){this.condition.logical=a.currentTarget.value},constructFormFields:function(){for(var b=a('<div class=""></div>').attr("class","condition-fields"),c=RuleBuilderUtils.getEventSpecificFields(this.eventType),d=0;d<c.length;d++){var e=a('<div class=""></div>').attr("class","condition-field");"operator"===c[d].fieldName?(e.append(this.constructOperator()),b.append(e)):!0===c[d].isConditionField&&(e.append(RuleBuilderUtils.createFormFields(c[d],!0,this.condition[c[d].fieldName])),b.append(e))}return b},constructOperator:function(){var b=a('<div class="form-field-container"></div>');return b.append(a('<label class="form-field-label" for="operator">Operator</label>')),b.append(a('<select name="operator"></select>').attr("class","styled-select form-field condition-operator").append(a('<option value="" default selected>Select Operator Type</option>')).append(a('<option value="GREATER_THAN">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.GREATER_THAN+"</option>")).append(a('<option value="LESS_THAN">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.LESS_THAN+"</option>")).append(a('<option value="GREATER_THAN_EQUAL_TO">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.GREATER_THAN_EQUAL_TO+"</option>")).append(a('<option value="LESS_THAN_EQUAL_TO">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.LESS_THAN_EQUAL_TO+"</option>")).append(a('<option value="EQUAL_TO">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.EQUAL_TO+"</option>")).append(a('<option value="NOT_EQUAL_TO">'+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS.NOT_EQUAL_TO+"</option>")).val(this.condition.operator||"")),b}},b}(jQuery),RbRuleEventContainer=function(a){function b(b){return this.rule=b.rule.rulename?b.rule:{event:{conditions:[],options:{}}},this.widgetId=b.widgetId,this.readOnly=b.readOnly||!1,this.allowEdit=b.allowEdit,this.element=a("<div></div>").attr("class","RbRuleEventContainer"),this.render(),this.element}return b.prototype={render:function(){this.element.empty(),this.element.append(this.constructRuleName()),this.element.append(this.constructIfContainer())},getRuleText:function(){for(var a=[],b=0;b<this.rule.event.conditions.length;b++){var c="";b>0&&(c+=this.rule.event.conditions[b].logical+" "),c+=this.rule.event.eventSource[0].toUpperCase()+this.rule.event.eventSource.substring(1)+" ",c+=this.rule.event.conditions[b].variable+" ",c+=RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS[this.rule.event.conditions[b].operator]+" ",c+=isNaN(this.rule.event.conditions[b].value)?'"'+this.rule.event.conditions[b].value+'" ':this.rule.event.conditions[b].value,a.push(c)}return a},constructRuleName:function(){if(!this.rule.rulename)var b=RuleBuilderUtils.createFormFields({fieldName:"rulename",fieldLabel:"Rule Name",fieldTag:"input",fieldType:"text",isConditionField:!1,renderLabelField:!1,events:[{eventName:"onfocus",eventValue:"this.placeholder=''"},{eventName:"onblur",eventValue:"this.placeholder='Rule Name (Required)'"}]},!1,this.rule.rulename||"");return form=a('<form method="post"></form>').attr("class","rbForm rulename-form").append(b)},constructIfContainer:function(){var b=a("<div></div>").attr("class",".RbRuleIfContainer"),c=a("<fieldset><legend>IF</legend></fieldset>");if(this.readOnly)c.append(this.constructReadOnlyEvent());else{c.append(this.constructEditableEvent());for(var d=0;d<this.rule.event.conditions.length;d++)c.append(this.getNewCondition(d));c.append(this.constructIfButtonContainer())}return b.append(c),b},constructReadOnlyEvent:function(){for(var b=a("<div></div>").attr("class",".RbRuleEventReadOnly"),c=this.getRuleText(),d=a("<ul></ul>").attr("class",".RbRuleEventList"),e=0;e<c.length;e++)d.append(a("<li>"+c[e]+"</li>").attr("class",".RbRuleConditionReadOnly"));return b.append(d),this.allowEdit&&b.append(a("<button>Edit</button>").attr("class","editLink clickable").on("click",a.proxy(this.onEditClick,this))),b},constructEditableEvent:function(){var b=a('<div class=""></div>').attr("class","event-fields-container"),c=a('<form method="post"></form>').attr("class","rbForm select-form");return b.append(a('<div class="form-field-container"></div>').append(a('<label class="form-field-label" for="eventsource">Datasource</label>')).append(a('<select name="eventsource"></select>').attr("class","styled-select form-field source-select").append('<option value="" default>Select Source Type</option>').append('<option value="message">message</option>').val(this.rule.event.eventSource||"").on("change",a.proxy(this.onSelectChange,this)))),b.append(this.renderEventSpecificFields()),c.append(b),c},constructIfButtonContainer:function(){var b=a("<div></div>").attr("class","if-btn-container btn-container ").append(a('<input type= "button" value="+ Add Condition">').attr("class","addConditionBtn btn").on("click",a.proxy(this.onAddCondition,this))).append(a('<input type= "button" value="Next">').attr("class","nextBtn btn").on("click",a.proxy(this.validateForms,this)));return this.rule.event.eventSource||b.hide(),b},renderEventSpecificFields:function(){var b=a("<div></div>").attr("class","event-fields");if(this.rule.event.eventSource)for(var c=RuleBuilderUtils.getEventSpecificFields(this.rule.event.eventSource),b=a("<div></div>").attr("class","event-fields"),d=0;d<c.length;d++)!1===c[d].isConditionField&&b.append(RuleBuilderUtils.createFormFields(c[d],!0,this.rule.event.options[c[d].fieldName]||""));return b},onAddCondition:function(b){this.getNewCondition().insertBefore(this.element.find(".if-btn-container")),a("body").trigger(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.RESIZE_DIALOG)},getNewCondition:function(b){var b=b||this.element.find(".RbRuleEventConditionForm").length,c=a('<div class ="icon-container"><i class ="icon-trash"></i></div>').on("click",a.proxy(this.deleteCondition,this)),d=new RbRuleEventConditionItem({condition:this.rule.event.conditions[b]||{},eventType:this.rule.event.eventSource,readOnly:this.readOnly,conditionIndex:b});return d.append(c),d},deleteCondition:function(b){a(b.currentTarget.parentElement).remove();var c=this.element.find(".RbRuleEventConditionForm");c.length>0&&a(c[0]).find(".logical-condition-container").remove()},validateForms:function(b){var c=!0,d=RuleBuilderUtils.getFormValidationOptions(""!==this.rule.event.eventSource?RuleBuilderUtils.getEventSpecificFields(this.rule.event.eventSource):[]);if(!this.rule.rulename){var e=a(this.element.find(".rulename-form"));e.length>0&&(e.validate(d),e.valid()||(c=!1))}var f=a(this.element.find(".select-form"));f.validate(d),f.valid()||(c=!1);for(var g=this.element.find(".RbRuleEventConditionForm"),h=0;h<g.length;h++){var i=a(g[h]);i.validate(d),i.valid()||(c=!1)}c&&this.saveRuleEvent()},onSelectChange:function(a){this.rule.event.eventSource=a.currentTarget.value,this.rule.event.conditions=[];var b=this.element.find(".if-btn-container");this.element.find(".event-fields").remove(),this.element.find(".RbRuleEventConditionForm").remove();this.element.find(".event-fields-container").append(this.renderEventSpecificFields());""!=this.rule.event.eventSource?(this.onAddCondition(a),b.show()):b.hide()},saveRuleEvent:function(){var b=this.extractEventFromDOM();a(".modal .title").text(b.rulename),this.element.closest(a(".RbRuleContainer")).trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_EVENT,this.widgetId),[b])},extractEventFromDOM:function(){var b=this.rule,c={},d={},e=[];this.rule.rulename||(b.rulename=this.element.find(a(".rulename"))[0].value),c.eventSource=this.rule.event.eventSource;for(var f=this.element.find(a(".event-fields .form-field")),g=0;g<f.length;g++)d[f[g].name]=f[g].value;for(var h=this.element.find(a(".RbRuleEventConditionForm")),i=0;i<h.length;i++){for(var j=a(h[i]).find(a(".form-field")),k={},l=0;l<j.length;l++)switch(j[l].name){case"value":isNaN(j[l].value)?k[j[l].name]=j[l].value:k[j[l].name]=Number(j[l].value);break;case"logical":k[j[l].name]=i>0?j[l].value:"";break;default:k[j[l].name]=j[l].value}e.push(k)}return c.options=d,c.conditions=e,b.event=c,b},onEditClick:function(){this.readOnly=!1,this.render(),this.element.closest(".RbRuleContainer").trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.EDIT_RULE,this.widgetId))}},b}(jQuery),RbRuleList=function(a){function b(b){return this.config=JSON.parse(JSON.stringify(b))||{},b.rules||(b.rules=[]),this.element=a("<div></div>").attr("class","rbRuleListContainer"),this.render(),this.element}return b.prototype={render:function(){this.element.empty(),this.element.off();var b=a("<fieldset></fieldset>").append(a("<legend>"+this.config.widgetName+"</legend>"));if(this.config.rules.length>0){for(var c=a("<div class='rbRuleListScroll'></div>"),d=a("<ul></ul>").attr("class","rbRuleList"),e=0;e<this.config.rules.length;e++){var f=JSON.parse(JSON.stringify(this.config));f.rule=this.config.rules[e],f.ruleIndex=e,delete f.rules,d.append(new RbRuleListItem(f))}c.append(d),b.append(c)}else b.append(a('<div class="NoRulesContainer"></div>').append(a("<h4>No Rules</h4>").attr("class","rbRuleListItem")));this.config.allowCreate&&b.append(a("<div></div>").append(a("<i class='icon-plus'></i>")).attr("id","addNewRuleLink_"+this.config.widgetId).attr("class","addNewRuleLink clickable").append("<span>Add New Rule</span>")),this.element.append(b),this.bindEvents()},bindEvents:function(){this.element.find("#addNewRuleLink_"+this.config.widgetId).on("click",a.proxy(this.addNewRule,this)),this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.DELETE_RULE,this.config.widgetId),a.proxy(this.onRuleDeleted,this)),this.element.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.SAVE_RULE,this.config.widgetId),a.proxy(this.onRuleSaved,this))},addNewRule:function(){RuleBuilderUtils.openRuleDialog({widgetId:this.config.widgetId,ruleIndex:-1,allowEdit:this.config.allowEdit})},onRuleSaved:function(a,b){-1!==b.ruleIndex?(this.config.rules[b.ruleIndex]=b.rule,this.element.trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.MODIFY_RULE,this.config.widgetId),[{rule:b.rule,ruleIndex:b.ruleIndex}])):(this.config.rules.push(b.rule),this.element.trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.CREATE_RULE,this.config.widgetId),[{rule:b.rule,ruleIndex:b.ruleIndex+1}])),this.render()},onRuleDeleted:function(a,b){this.config.rules.splice(b.ruleIndex,1),this.render()}},b}(jQuery),RbRuleListItem=function(a){function b(b){return this.config=b,this.element=a("<li></li>").attr("class","rbRuleListItem"),this.render(),this.bindEvents(),this.element}return b.prototype={render:function(){this.config.allowDelete&&this.element.append(a('<div class ="icon-container"><i class ="icon-trash"></i></div>')),this.element.append(a("<div></div>").attr("class","rbRuleListItemNameContainer").append(a("<button>"+this.config.rule.rulename+"</button>").attr("class","rbRuleListItemName"))),this.config.allowOnOff&&this.element.append(a("<div></div>").attr("class","onoffswitch-container").append(a("<div></div>").attr("class","onoffswitch").append(a("<input>").attr("class","onoffswitch-checkbox").attr("id",this.config.rule.rulename+"-onoff").attr("type","checkbox").attr("name","onoffswitch").attr("checked",this.config.rule.enabled)).append(a("<label>").attr("class","onoffswitch-label").attr("for",this.config.rule.rulename+"-onoff").append(a("<div></div>").attr("class","onoffswitch-inner").append(a('<span class="on">on</span>')).append(a('<span class="off">off</span>')).append(a("<div></div>").attr("class","onoffswitch-switch"))))))},bindEvents:function(){this.element.find(".onoffswitch-checkbox").on("change",a.proxy(this.onToggle,this)),this.element.find(".icon-trash").on("click",a.proxy(this.deleteRule,this)),this.element.find(".rbRuleListItemName").on("click",a.proxy(this.editRule,this))},getLastRun:function(){},onToggle:function(a){a.currentTarget.checked?this.element.trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.ENABLE_RULE,this.config.widgetId),[{ruleIndex:this.config.ruleIndex}]):this.element.trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.DISABLE_RULE,this.config.widgetId),[{ruleIndex:this.config.ruleIndex}])},deleteRule:function(a){this.element.trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.DELETE_RULE,this.config.widgetId),[{rule:this.config.rule,ruleIndex:this.config.ruleIndex}])},editRule:function(a){RuleBuilderUtils.openRuleDialog(this.config)}},b}(jQuery),RuleBuilderUtils={createEventName:function(a,b){return b+":"+a},displayMessage:function(a){freeboard.showDialog(new RbDisplayMessageContainer(a),"Error","OK",null,function(){})},openRuleDialog:function(a){function b(){$(".modal .RbRuleContainer").trigger(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.CLOSE_DIALOG,a.widgetId))}freeboard.showDialog(new RbRuleContainer(a),a.rule&&a.rule.rulename?a.rule.rulename:"New Rule","Done","Cancel",b),a.rule&&a.rule.event&&!a.rule.event.eventSource&&0!==a.rule.alerts.length||$("#dialog-ok").hide()},closeDialog:function(){$("body").trigger(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.CLOSE_DIALOG)},buildServiceFieldsForValidation:function(a){for(var b=[],c=self._getServiceParmDOMFields(a),d=0;d<c.length;d++){var e={};e.fieldName=c[d].name,e.fieldLabel=c[d].placeholder,e.validationOptions={},e.validationOptions.rules={},e.validationOptions.rules.required=!0,e.validationOptions.message={},e.validationOptions.message.required=e.fieldLabel+" is required",b.push(e)}return b},getFormValidationOptions:function(a){for(var b={rules:{rulename:{required:!0},operator:{required:!0},alerttype:{required:!0},providers:{required:!0}},messages:{rulename:"Rule Name is required",operator:"Operator type is required.",alerttype:"Alert type is required",providers:"Provider is required"},errorPlacement:function(a,b){a.addClass("validation-error"),a.insertAfter(b)},wrapper:"div"},c=0;c<a.length;c++)"operator"!==a[c].fieldName&&(b.rules[a[c].fieldName]=a[c].validationOptions.rules,b.messages[a[c].fieldName]=a[c].validationOptions.message);return b},createFormFields:function(a,b,c){var d=$('<div class="form-field-container"></div>'),e={};if(b){var f=$('<label class="form-field-label" for="'+a.fieldName+'">'+a.fieldLabel+"</label>");d.append(f)}switch(a.fieldType){case"button":e=$("<"+a.fieldTag+' type="'+a.fieldType+'" name="'+a.fieldName+'" value="'+a.fieldLabel+'"/>'),e.attr("class",a.fieldName+" form-field "+a.fieldTag);break;default:e=$("<"+a.fieldTag+' type="'+a.fieldType+'" placeholder="'+a.fieldLabel+'" name="'+a.fieldName+'"/>'),e.attr("class",a.fieldName+" form-field "+a.fieldTag),e.val(c||"")}if(a.events&&a.events.length>0)for(var g=0;g<a.events.length;g++)e.on(a.events[g].eventName,self[a.events[g].eventValue]);return d.append(e),d},getEventSpecificFields:function(a){switch(a){case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DATA:return rbDataSourceImpl.getFieldsToRender();case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DEVICE:return rbDeviceSourceImpl.getFieldsToRender();case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_MESSAGE:return rbMessageSourceImpl.getFieldsToRender();case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_USER:return rbUserSourceImpl.getFieldsToRender()}},getAlertFields:function(a,b){var c=[];switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:return rbEmailAlertImpl.setProvider(b),c.concat(rbEmailAlertImpl.getFieldsToRender());case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:return rbSmsAlertImpl.setProvider(b),c.concat(rbSmsAlertImpl.getFieldsToRender());case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:return c.concat(rbServiceAlertImpl.getFieldsToRender());default:return c}},createTrigger:function(a,b,c,d,e){var f=$.Deferred();return ruleBuilderTrigger.getInstance(e).createTrigger(a,b,c,d,e).then(function(){f.resolve()},function(a){console.log("RuleBuilderUtils.createTrigger - Failed to create trigger: ",a.msg),f.reject(a.msg)}),f.promise()},deleteTrigger:function(a,b,c,d){var e=$.Deferred();return ruleBuilderTrigger.getInstance(d).deleteTrigger(a,b,c,d).then(function(){e.resolve()},function(a){500===!a.code?(console.log("RuleBuilderUtils.deleteTrigger - Failed to delete trigger: ",a.msg),e.reject(a.msg)):e.resolve()}),e.promise()}},rbEmailAlertImpl=function(){function a(){var a=$.Deferred();return""!==k?a.resolve(k):$.get("templates/"+i).done(function(b){k=b,a.resolve(b)}).fail(function(b){a.reject(b)}),a.promise()}function b(a){var b=e(a);return l.getTemplate&&(b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.PROVIDER]=rbTokenReplacer.replaceTokens(b,l.getTemplate(a))),rbTokenReplacer.replaceTokens(b,k)}function c(){return n}function d(a){switch(a){case"sendGrid":l=rbSendGridEmailImpl;break;default:l={}}}function e(a){var b={};return b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.EMAIL_SUBJ]=rbTokenReplacer.parseToken(a.alert.options.emailSubject),b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.EMAIL_BODY]=rbTokenReplacer.parseToken(a.alert.options.emailBody),b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.EMAIL_TO]=g(a.alert.options.emailTo),b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.EMAIL_FROM]=a.alert.options.emailFrom,b}function f(){return l.getFieldsToRender?l.getFieldsToRender().concat(m):m}function g(a){for(var b=a.split(/[;,]+/),c=0;c<b.length;c++)b[c]=b[c].trim();return JSON.stringify(b)}function h(){return j}var i="message/emailService.txt",j="http",k="",l={},m=[{fieldName:"emailFrom",fieldLabel:"From E-mail",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0,email:!0},message:{required:"Sender's email is required.",email:"Please enter a valid email address"}}},{fieldName:"emailTo",fieldLabel:"To E-mail",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0,email:!0},message:{required:"Recipient's email is required.",email:"Please enter a valid email address"}}},{fieldName:"emailSubject",fieldLabel:"Subject",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:"The Email subject is required."}},{fieldName:"emailBody",fieldLabel:"Message",fieldTag:"textarea",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:"The Email body is required."}}],n=[{providerName:"sendGrid",providerLabel:"SendGrid"}];return a(),{getTemplate:b,getTokens:e,getFieldsToRender:f,setProvider:d,getProviders:c,getServiceDependencies:h}}(),rbServiceAlertImpl=function(){function a(){var a=$.Deferred();return""!==j?a.resolve(j):$.get("templates/"+h).done(function(b){j=b,a.resolve(b)}).fail(function(b){a.reject(b)}),a.promise()}function b(a){var b=e(a);return rbTokenReplacer.replaceTokens(b,j)}function c(){return m}function d(a){k={}}function e(a){for(var b={},c={},d=Object.keys(a.alert.options).filter(function(a){return a.indexOf("parmName")>-1}),e=0;e<d.length;e+=1)c[a.alert.options[d[e]]]=a.alert.options["parmValue_"+d[e].split("_")[1]];return b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SVC_SERVICE]=a.alert.options.serviceName,b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SVC_PARAMS]=JSON.stringify(c),b}function f(){return k.getFieldsToRender?k.getFieldsToRender().concat(l):l}function g(){return i}var h="message/serviceService.txt",i="clearblade, log",j="",k={},l=[{fieldName:"serviceName",fieldLabel:"Service Name",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:{required:"Service name is required."}}},{fieldName:"addServiceParm",fieldLabel:"Add Parameter",fieldTag:"input",fieldType:"button",events:[],validationOptions:{rules:{},message:{}}}],m=[];return a(),{getTemplate:b,getTokens:e,getFieldsToRender:f,setProvider:d,getProviders:c,getServiceDependencies:g}}(),rbSmsAlertImpl=function(){function a(){var a=$.Deferred();return""!==k?a.resolve(k):$.get("templates/"+i).done(function(b){k=b,a.resolve(b)}).fail(function(b){a.reject(b)}),a.promise()}function b(a){var b=e(a);return l.getTemplate&&(b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.PROVIDER]=rbTokenReplacer.replaceTokens(b,l.getTemplate(a))),rbTokenReplacer.replaceTokens(b,k)}function c(){return n}function d(a){switch(a){case"twilio":l=rbTwilioSmsImpl;break;default:l={}}}function e(a){var b={};return b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SMS_MSG]=rbTokenReplacer.parseToken(a.alert.options.smsBody),b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SMS_TO]=g(a.alert.options.smsTo),b[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SMS_FROM]=a.alert.options.smsFrom,b}function f(){return l.getFieldsToRender?l.getFieldsToRender().concat(m):m}function g(a){for(var b=a.split(/[;,]+/),c=0;c<b.length;c++)b[c]=b[c].trim();return JSON.stringify(b)}function h(){return j}var i="message/smsService.txt",j="http",k="",l={},m=[{fieldName:"smsFrom",fieldLabel:"From Phone #",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0,phoneList:!0},message:{required:"The SMS (From) phone number is required.",phoneList:"Please enter a valid SMS (From) mobile phone number"}}},{fieldName:"smsTo",fieldLabel:"To Phone #",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0,phoneList:!0},message:{required:"Mobile number is required.",phoneList:"Please enter a valid list of mobile phone numbers"}}},{fieldName:"smsBody",fieldLabel:"Message",fieldTag:"textarea",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:{required:"Message is required."}}}],n=[{providerName:"twilio",providerLabel:"Twilio"}];return a(),{getTemplate:b,getTokens:e,getFieldsToRender:f,setProvider:d,getProviders:c,getServiceDependencies:h}}(),rbDataSourceImpl=function(){function a(a,c){return rbTokenReplacer.replaceTokens(b(a,c),g.getTemplate(c))}function b(a,b){return{}}function c(a){switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:g=rbEmailAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:g=rbSmsAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:g=rbServiceAlertImpl}}function d(){return g}function e(){return h}function f(){return g.getServiceDependencies()}var g,h=[{fieldName:"variable",fieldLabel:"Variable",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable name is required."}}},{fieldName:"operator"},{fieldName:"value",fieldLabel:"value",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable value is required."}}}];return{getAlert:d,setAlert:c,getServiceTemplate:a,getServiceTokens:b,getFieldsToRender:e,getServiceDependencies:f}}(),rbDataTriggerImpl=function(){function a(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.DATA.MODULE_NAME}function b(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.DATA.ACTIONS.COLLECTION.CREATED}function c(a){return{}}return{getSystemModule:a,getTriggerAction:b,getTriggerActionData:c}}(),rbDeviceSourceImpl=function(){function a(a,c){return rbTokenReplacer.replaceTokens(b(a,c),g.getTemplate(c))}function b(a,b){return{}}function c(a){switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:g=rbEmailAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:g=rbSmsAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:g=rbServiceAlertImpl}}function d(){return g}function e(){return h}function f(){return g.getServiceDependencies()}var g,h=[{fieldName:"variable",fieldLabel:"Variable",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable name is required."}}},{fieldName:"operator"},{fieldName:"value",fieldLabel:"value",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable value is required."}}}];return{getAlert:d,setAlert:c,getServiceTemplate:a,getServiceTokens:b,getFieldsToRender:e,getServiceDependencies:f}}(),rbDeviceTriggerImpl=function(){function a(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.DEVICE.MODULE_NAME}function b(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.DEVICE.ACTIONS.CREATED}function c(a){return{}}return{getSystemModule:a,getTriggerAction:b,getTriggerActionData:c}}(),rbMessageSourceImpl=function(){function a(a,c){return rbTokenReplacer.replaceTokens(b(a,c),g.getTemplate(c))}function b(a,b){var c={};c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.SVC_NAME]=a,c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.CONDITION_TEXT]="";for(var d=0;d<b.event.conditions.length;d++)b.event.conditions[d].logical&&(c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.CONDITION_TEXT]+=" "+b.event.conditions[d].logical+" "),c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.CONDITION_TEXT]+=b.event.conditions[d].variable+" "+b.event.conditions[d].operator+" "+b.event.conditions[d].value;return c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.CONDITION]=conditionBuilder.getInstance().createCondition(b.event.conditions),c[RULE_BUILDER_CONSTANTS.SERVICE_TOKENS.MSG_TOPIC]=b.event.options.topic,c}function c(a){switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:g=rbEmailAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:g=rbSmsAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:g=rbServiceAlertImpl;break;default:g={}}}function d(){return g}function e(){return h}function f(){return g.getServiceDependencies()}var g,h=[{fieldName:"topic",fieldLabel:"Topic",fieldTag:"input",fieldType:"text",isConditionField:!1,events:[{eventName:"onfocus",eventValue:"this.placeholder=''"},{eventName:"onblur",eventValue:"this.placeholder='Topic (Required)'"}],validationOptions:{rules:{required:!0},message:{required:"Topic name is required."}}},{fieldName:"variable",fieldLabel:"Variable",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable name is required."}}},{fieldName:"operator"},{fieldName:"value",fieldLabel:"value",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable value is required."}}}];return{getAlert:d,setAlert:c,getServiceTemplate:a,getServiceTokens:b,getFieldsToRender:e,getServiceDependencies:f}}(),rbMessageTriggerImpl=function(){function a(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.MESSAGE.MODULE_NAME}function b(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.MESSAGE.ACTIONS.PUBLISH}function c(a){return{topic:a.event.options.topic}}return{getSystemModule:a,getTriggerAction:b,getTriggerActionData:c}}(),rbSendGridEmailImpl=function(){function a(){var a=$.Deferred();return""!==g?a.resolve(g):$.get("templates/"+f).done(function(b){g=b,a.resolve(b)}).fail(function(b){a.reject(b)}),a.promise()}function b(a){return rbTokenReplacer.replaceTokens(c(a),g)}function c(a){var b={};return b[e]=a.alert.options.sendGridApiKey,b}function d(){return h}var e="SENDGRID_APIKEY",f="providers/email/sendgrid.txt",g="",h=[{fieldName:"sendGridApiKey",fieldLabel:"Key",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:{required:"sendGrid key is required."}}}];return a(),{getTemplate:b,getFieldsToRender:d}}(),rbTwilioSmsImpl=function(){function a(){var a=$.Deferred();return""!==h?a.resolve(h):$.get("templates/"+g).done(function(b){h=b,a.resolve(b)}).fail(function(b){a.reject(b)}),a.promise()}function b(a){return rbTokenReplacer.replaceTokens(c(a),h)}function c(a){var b={};return b[e]=a.alert.options.twilioApiKey,b[f]=a.alert.options.twilioApiSecret,b}function d(){return i}var e="TWILIO_APIKEY",f="TWILIO_APISECRET",g="providers/sms/twilio.txt",h="",i=[{fieldName:"twilioApiKey",fieldLabel:"Key",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:{required:"Twilio API key is required."}}},{fieldName:"twilioApiSecret",fieldLabel:"Secret",fieldTag:"input",fieldType:"text",events:[],validationOptions:{rules:{required:!0},message:{required:"Twilio API secret is required."}}}];return a(),{getTemplate:b,getFieldsToRender:d}}(),rbUserSourceImpl=function(){function a(a,c){return rbTokenReplacer.replaceTokens(b(a,c),g.getTemplate(c))}function b(a,b){return{}}function c(a){switch(a){case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_EMAIL:g=rbEmailAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SMS:g=rbSmsAlertImpl;break;case RULE_BUILDER_CONSTANTS.ALERT_TYPES.ALERT_SERVICE:g=rbServiceAlertImpl}}function d(){return g}function e(){return h}function f(){return g.getServiceDependencies()}var g,h=[{fieldName:"variable",fieldLabel:"Variable",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable name is required."}}},{fieldName:"operator"},{fieldName:"value",fieldLabel:"value",fieldTag:"input",fieldType:"text",isConditionField:!0,events:[],validationOptions:{rules:{required:!0},message:{required:"Variable value is required."}}}];return{getAlert:d,setAlert:c,getServiceTemplate:a,getServiceTokens:b,getFieldsToRender:e,getServiceDependencies:f}}(),rbUserTriggerImpl=function(){function a(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.USER.MODULE_NAME}function b(){return RULE_BUILDER_CONSTANTS.TRIGGERS.MODULES.USER.ACTIONS.CREATED}function c(a){return{}}return{getSystemModule:a,getTriggerAction:b,getTriggerActionData:c}}(),conditionBuilder=function(){function a(){function a(a){for(var b="",c=0;c<a.length;c++){if(a[c].logical&&""!==a[c].logical)switch(a[c].logical){case RULE_BUILDER_CONSTANTS.LOGICAL_OPERATORS.AND:b+=" && ";break;case RULE_BUILDER_CONSTANTS.LOGICAL_OPERATORS.OR:b+=" || ";break;default:console.error("Logical operator not supported: "+a[c].operator)}b+="messageObject."+a[c].variable+" "+RULE_BUILDER_CONSTANTS.OPERATORS.SYMBOLS[a[c].operator]+" "+JSON.stringify(a[c].value)}return b}return{createCondition:a}}var b;return{getInstance:function(){return b||(b=a()),b}}}(),RULE_BUILDER_CONSTANTS={CUSTOM_DOM_EVENTS:{CREATE_RULE:"ruleBuilder:createRule",MODIFY_RULE:"ruleBuilder:modifyRule",DELETE_RULE:"ruleBuilder:deleteRule",SAVE_RULE:"ruleBuilder:saveRule",ENABLE_RULE:"ruleBuilder:enableRule",DISABLE_RULE:"ruleBuilder:disableRule",OPEN_DIALOG:"ruleBuilder:openDialog",CLOSE_DIALOG:"ruleBuilder:closeDialog",RESIZE_DIALOG:"ruleBuilder:resizeDialog",SAVE_EVENT:"ruleBuilder:saveEvent",SAVE_ALERT:"ruleBuilder:saveAlert",EDIT_RULE:"ruleBuilder:editRule",RULENAME_UPDATED:"ruleBuilder:ruleNameUpdated"},LOGICAL_OPERATORS:{AND:"AND",OR:"OR"},OPERATORS:{GREATER_THAN:"greater than",LESS_THAN:"less than",GREATER_THAN_EQUAL_TO:"greater than or equal to",LESS_THAN_EQUAL_TO:"less than or equal to",EQUAL_TO:"equal to",NOT_EQUAL_TO:"not equal to",SYMBOLS:{GREATER_THAN:">",LESS_THAN:"<",GREATER_THAN_EQUAL_TO:">=",LESS_THAN_EQUAL_TO:"<=",EQUAL_TO:"==",NOT_EQUAL_TO:"!="}},EVENT_SOURCES:{EVENT_DATA:"data",EVENT_DEVICE:"device",EVENT_MESSAGE:"message",EVENT_USER:"user"},ALERT_TYPES:{ALERT_SMS:"sms",ALERT_EMAIL:"email",ALERT_SERVICE:"service"},PROVIDERS:{EMAIL:{SENDGRID:"sendGrid"},SMS:{TWILIO:"twilio"}},SERVICE_TOKENS:{SVC_NAME:"SERVICE_NAME",VARNAME:"VARIABLE_NAME",VARVALUE:"VARIABLE_VALUE",OPERATOR:"OPERATOR_TEXT",CONDITION:"CONDITION_TO_CHECK",CONDITION_TEXT:"CONDITION_TEXT",MSG_TOPIC:"MESSAGE_TOPIC",SMS_MSG:"SMS_MESSAGE",SMS_TO:"SMS_TO",SMS_FROM:"SMS_FROM",EMAIL_SUBJ:"EMAIL_SUBJECT",EMAIL_BODY:"EMAIL_BODY",EMAIL_TO:"EMAIL_TO",EMAIL_FROM:"EMAIL_FROM",PROVIDER:"PROVIDER_IMPL",SVC_SERVICE:"SERVICE_TO_INVOKE",SVC_PARAMS:"SERVICE_PARAMS"},TRIGGERS:{MODULES:{DEVICE:{MODULE_NAME:"Device",ACTIONS:{CREATED:"DeviceCreated",UPDATED:"DeviceUpdated",DELETED:"DeviceDeleted"}},DATA:{MODULE_NAME:"Data",ACTIONS:{COLLECTION:{CREATED:"CollectionCreated",UPDATED:"CollectionUpdated",DELETED:"CollectionDeleted"},ITEM:{CREATED:"ItemCreated",UPDATED:"ItemUpdated",DELETED:"ItemDeleted"}}},MESSAGE:{MODULE_NAME:"Messaging",ACTIONS:{PUBLISH:"Publish",SUBSCRIBE:"Subscribe",UNSUBSCRIBE:"Unsubscribe"}},USER:{MODULE_NAME:"User",ACTIONS:{CREATED:"UserCreated",UPDATED:"UserUpdated",DELETED:"UserDeleted"}}}}};freeboard.loadWidgetPlugin({type_name:"clearblade_RuleBuilder",display_name:"RuleBuilder",description:"Rule Builder Widget, which will allow users to create simple conditional statements, which will trigger other services such as SMS, Email etc.",external_scripts:["https://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js"],fill_size:!1,settings:[{name:"widgetName",display_name:"Name",type:"text",required:!0},{name:"allowCreate",display_name:"Allow Create",type:"boolean",required:!1},{name:"allowDelete",display_name:"Allow Delete",type:"boolean",required:!1},{name:"allowEdit",display_name:"Allow Edit",type:"boolean",required:!1},{name:"allowOnOff",display_name:"Allow On/Off",type:"boolean",required:!1},{name:"blockHeight",display_name:"Block Height",type:"number",default_value:3},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new RuleBuilderWidgetPlugin(a))}});var RuleBuilderWidgetPlugin=function(a){var b,c=this,d=platformConfig.url,e=a;void 0===e.widgetName?e.widgetId="":e.widgetId=e.widgetName.replace(/\s+/g,"_"),c._getParameterByName=function(a,b){var c="";b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var d=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),e=d.exec(b);return e&&e[2]&&(c="systemKey"===a?CryptoJS.AES.decrypt(decodeURIComponent(e[2]),"ClearBladeDashboards2016").toString(CryptoJS.enc.Utf8):e[2]),c},b=c._getParameterByName("systemKey"),c._saveDashboard=function(){saveDashboard(function(a,b){c.renderContent()})},c.render=function(a){c.addCustomValidators(),c.containerElement=a;var b=$('<div class="tw-display rbwidget"></div>').attr("id",e.widgetId);e.rules||(e.rules=[]),$(a).append(b),c.bindEvents(),c.renderContent()},c.addCustomValidators=function(){$.validator.methods.email=function(a,b){var c=/([a-zA-Z0-9_\-\.]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,5}[;,]?)+/g;return this.optional(b)||c.test(a)},$.validator.addMethod("phoneList",function(a,b){return this.optional(b)||/^(?:(?:\s*(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*[;,]\s*)?)+$/.test(a)},"Invalid phone number(s) specified")},c.renderContent=function(){var a=new RbRuleList({widgetId:e.widgetId,widgetName:e.widgetName,allowCreate:e.allowCreate,allowDelete:e.allowDelete,allowEdit:e.allowEdit,allowOnOff:e.allowOnOff,rules:e.rules}),b=$("#"+e.widgetId),c=utils.widget.blocksToPixels(e.blockHeight)-parseInt(b.css("padding-top"))-parseInt(b.css("padding-bottom"));$(a.children()[0]).height(c+"px");var d=c-.75*utils.widget.blockSize;a.find(".rbRuleListScroll").height(d+"px"),b.empty().append(a)},c.bindEvents=function(){var a=$(this.containerElement).find(".rbwidget");a.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.CREATE_RULE,a.attr("id")),$.proxy(c._onCreateRule,c)),a.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.MODIFY_RULE,a.attr("id")),$.proxy(c._onModifyRule,c)),a.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.DELETE_RULE,a.attr("id")),$.proxy(c._onDeleteRule,c)),a.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.ENABLE_RULE,a.attr("id")),$.proxy(c._onRuleEnabled,c)),a.on(RuleBuilderUtils.createEventName(RULE_BUILDER_CONSTANTS.CUSTOM_DOM_EVENTS.DISABLE_RULE,a.attr("id")),$.proxy(c._onRuleDisabled,c))},c._onCreateRule=function(a,b){$.when(c._saveRule(b.rule,b.ruleIndex)).then(function(){b.rule.enabled=!0,e.rules.push(b.rule),c._saveDashboard()})},c._onModifyRule=function(a,b){for(var d=[],f=e.rules[b.ruleIndex].alerts.length;f>0;f--)-1===c._findAlert(e.rules[b.ruleIndex].alerts[f-1],b.rule)&&d.push(c._deleteSingleAlert(e.rules[b.ruleIndex],f-1));$.when.apply(void 0,d).then(function(){$.when(c._saveRule(b.rule,b.ruleIndex)).then(function(){e.rules[b.ruleIndex]=b.rule,c._saveDashboard()})})},c._onDeleteRule=function(a,b){$.when(c._deleteRule(b.rule)).then(function(){e.rules.splice(b.ruleIndex,1),c._saveDashboard()})},c._onRuleEnabled=function(a,b){$.when(c.enableRule(b.ruleIndex)).then(function(){console.log("Rule enabled"),e.rules[b.ruleIndex].enabled=!0,c._saveDashboard()},function(a){console.log("Rule not enabled"),e.rules[b.ruleIndex].enabled=!1,c.displayError({message:"Unable to enable rule "+e.rules[b.ruleIndex].ruleName+". Please try again later.",messageDetail:""}),c._saveDashboard()})},c._onRuleDisabled=function(a,b){$.when(c.disableRule(b.ruleIndex)).then(function(){console.log("Rule disabled"),e.rules[b.ruleIndex].enabled=!1,c._saveDashboard()},function(a){console.log("Rule not disabled"),e.rules[b.ruleIndex].enabled=!0,c.displayError({message:"Unable to disable rule "+e.rules[b.ruleIndex].ruleName+". Please try again later.",messageDetail:""}),c._saveDashboard()})},c._objectsAreEqual=function(a,b){return JSON.stringify(a)===JSON.stringify(b)},c._saveRule=function(a,b){for(var d=[],f=0;f<a.alerts.length;f++)if(0===e.rules.length||b>e.rules.length-1||!1===a.alerts[f].isCreated)d.push(c._createAlert(a,f));else{var g=c._findAlert(a.alerts[f],e.rules[b]);-1!==g&&(c._objectsAreEqual(a.alerts[f],e.rules[b].alerts[g])&&c._objectsAreEqual(a.event,e.rules[b].event)||d.push(c._modifyAlert(a,f)))}return $.when.apply(void 0,d).promise()},c._findAlert=function(a,b){for(var c=0;c<b.alerts.length;c++)if(b.alerts[c].serviceName===a.serviceName)return c;return-1},c._setService=function(a,b){ruleBuilderService.setEventSource(a.event.eventSource),ruleBuilderService.getEventSource().setAlert(a.alerts[b].type),ruleBuilderService.getEventSource().getAlert().setProvider&&ruleBuilderService.getEventSource().getAlert().setProvider(a.alerts[b].provider)},c._createServiceName=function(a,b){return"RB_Service_"+e.widgetId+"_"+a.rulename.replace(/\s+/g,"")+"_"+a.alert.type+"_"+b},c._createTriggerName=function(a,b){return"RB_Trigger_"+e.widgetId+"_"+a.rulename+"_"+a.alert.type+"_"+b},c._createSettingsForService=function(a,b){var c=JSON.parse(JSON.stringify(a));return c.alert=c.alerts[b],delete c.alerts,c},c._createAlert=function(a,e){var f=$.Deferred();c._setService(a,e);var g=c._createSettingsForService(a,e),h=c._createServiceName(g,e);return ruleBuilderService.createService(d,b,h,g).then(function(){a.alerts[e].isCreated=!0,a.alerts[e].serviceName=h;var i=c._createTriggerName(g,e);RuleBuilderUtils.createTrigger(d,b,i,h,g).then(function(){a.alerts[e].triggerName=i,f.resolve()},function(b){console.log("Failed to create Trigger: ",b.msg),c._deleteSingleAlert(a,e).then(function(){f.reject(),c.displayError({message:"Unable to create trigger "+i,messageDetail:b.msg})},function(a){c.displayError({message:"Unable to create trigger "+i+".\nAn error occured while attempting to delete the created service.",messageDetail:b.msg+"\n"+a.msg})})})},function(b){console.log("Failed to create Service: ",b.msg),f.reject(b.msg),c.displayError({message:"Unable to create service "+h,messageDetail:b.msg}),a.alerts[e].isCreated=!1}),f.promise()},c._modifyAlert=function(a,e){var f=$.Deferred();c._setService(a,e);var g=c._createSettingsForService(a,e);return ruleBuilderService.modifyService(d,b,a.alerts[e].serviceName,g).then(function(){RuleBuilderUtils.deleteTrigger(d,b,a.alerts[e].triggerName,g).then(function(){RuleBuilderUtils.createTrigger(d,b,a.alerts[e].triggerName,a.alerts[e].serviceName,g).then(function(){f.resolve()},function(b){console.log("Failed to create trigger when updating service: ",b.msg),f.reject(b.msg),c.displayError({message:"Unable to create trigger "+a.alerts[e].triggerName,messageDetail:b.msg})})},function(b){console.log("Failed to delete trigger when updating service: ",b.msg),f.reject(b.msg),c.displayError({message:"Unable to delete trigger "+a.alerts[e].triggerName,messageDetail:b.msg})})},function(b){console.log("Failed to update Service: ",b.msg),f.reject(b.msg),c.displayError({message:"Unable to update service "+a.alerts[e].serviceName,messageDetail:b.msg})}),f.promise()},c._deleteRule=function(a,b){return b?c._deleteSingleAlert(a,b):c._deleteAllAlerts(a)},c._deleteSingleAlert=function(a,e){var f=$.Deferred();if(a.alerts&&a.alerts[e]){if(!0===a.alerts[e].isCreated){var g=c._createSettingsForService(a,e);return ruleBuilderService.deleteService(d,b,a.alerts[e].serviceName).then(function(){RuleBuilderUtils.deleteTrigger(d,b,a.alerts[e].triggerName,g).then(function(){a.alerts.splice(e,1),f.resolve()},function(b){console.log("Failed to delete Trigger: ",b.msg),c.displayError({message:"Unable to delete trigger "+a.alerts[e].triggerName,messageDetail:b.msg}),f.reject(b.msg)})},function(b){500===!b.code?(console.log("Failed to delete Service: ",b.msg),c.displayError({message:"Unable to delete service "+a.alerts[e].serviceName,messageDetail:b.msg}),f.reject(b.msg)):(a.alerts.splice(e,1),f.resolve())}),f.promise()}return void a.alerts.splice(e,1)}},c._deleteAllAlerts=function(a){var b=[];if(a.alerts&&a.alerts.length>0)for(var d=a.alerts.length;d>0;d--)b.push(c._deleteSingleAlert(a,d-1));return $.when.apply(void 0,b).promise()},c.displayError=function(a){RuleBuilderUtils.displayMessage(a)},c.enableRule=function(a){for(var f=[],g=e.rules[a],h=0;h<g.alerts.length;h++)f.push(RuleBuilderUtils.createTrigger(d,b,g.alerts[h].triggerName,g.alerts[h].serviceName,c._createSettingsForService(g,h)));return $.when.apply(void 0,f).promise()},c.disableRule=function(a){for(var f=[],g=e.rules[a],h=0;h<g.alerts.length;h++)f.push(RuleBuilderUtils.deleteTrigger(d,b,g.alerts[h].triggerName,c._createSettingsForService(g,h)));return $.when.apply(void 0,f).promise()},c.getHeight=function(){return e.rules&&0!==e.rules.length?e.blockHeight=e.blockHeight>=2?e.blockHeight:2:e.blockHeight=2,utils.widget.calculateHeight(e.blockHeight)},c.onSettingsChanged=function(a){a.rules=e.rules,a.widgetId=e.widgetId,e=a,freeboard.resize(),c._saveDashboard()},c.onCalculatedValueChanged=function(a,b){},c.onDispose=function(){}},ruleBuilderService=function(){function a(a){return g}function b(a){switch(a){case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DATA:g=rbDataSourceImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DEVICE:g=rbDeviceSourceImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_MESSAGE:g=rbMessageSourceImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_USER:g=rbUserSourceImpl;break;default:g={}}}function c(a,b,c,d){var e=$.Deferred(),h=a+"/api/v/3/code/"+b+"/service/"+c;return $.when(g.getServiceTemplate(c,d)).then(function(a){var d=JSON.stringify({code:a,parameters:[],systemID:b,name:c,dependencies:g.getServiceDependencies(),run_user:""});$.ajax({method:"POST",url:h,data:d,dataType:"json",contentType:"application/json",beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Create Service: %o",a),e.resolve(a)},error:function(a,b,c){console.log("Request failed Create Service: "+c),e.reject(f("create",a.status))}})}),e.promise()}function d(a,b,c){var d=$.Deferred(),e=a+"/api/v/3/code/"+b+"/service/"+c;return $.ajax({method:"DELETE",url:e,contentType:"application/json",beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Delete Service: %o",a),d.resolve(a)},error:function(a,b,c){console.log("Request failed Delete Service : "+c),d.reject(f("delete",a.status))}}),d.promise()}function e(a,b,c,d){var e=$.Deferred(),h=a+"/api/v/3/code/"+b+"/service/"+c;return $.when(g.getServiceTemplate(c,d)).then(function(a){var d=JSON.stringify({code:a,parameters:[],systemID:b,name:c,dependencies:g.getServiceDependencies(),run_user:""});$.ajax({method:"PUT",url:h,data:d,dataType:"json",contentType:"application/json",beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Update Service: %o",a),e.resolve(a)},error:function(a,b,c){console.log("Request failed Update Service: "+c),e.reject(f("modify",a.status))}})}),e.promise()}function f(a,b){var c={};switch(b){case 400:case 401:c.msg="You do not have the necessary permissions to "+a+" services.You need to be granted permission in the ClearBlade developers console (Roles > System Level) to do this.";break;case 404:switch(a){case"delete":c.msg="The service you are attempting to delete does not exist.";break;case"modify":c.msg="The service you are attempting to modify does not exist."}break;case 405:c.msg="Oops, something went wrong. Please open a support ticket with ClearBlade.";break;case 500:switch(a){case"create":c.msg="The service you are attempting to create already exists.";break;case"delete":c.msg="The service you are attempting to delete does not exist."}}return c.code=b,c}var g;return{createService:c,modifyService:e,deleteService:d,setEventSource:b,getEventSource:a}}(),rbTokenReplacer=function(){function a(a,b){var c=b;for(var d in a)c=c.replace(new RegExp("@"+d+"@","g"),a[d]);return c}function b(a,b){var c=a;if(c.length>0){"<"!=c[0]&&(c='"'+c),(">"!=c[c.length-1]||">"===c[c.length-1]&&"\\"===c[c.length-2])&&(c+='"');for(var d=/[^\\]([\<](.+?[^\\])[\>])/g,e=d.exec(c);null!=e;){var f="";e.index>0&&(f+='" + '),f+="messageObject."+e[2],e.index+e[0].length<c.length-1&&(f+=' + "'),c=c.replace(e[1],f),e=d.exec(c)}}return c}return{replaceTokens:a,parseToken:b}}(),ruleBuilderTrigger=function(){function a(){function a(a){switch(a.event.eventSource){case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DATA:g=rbDataTriggerImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_DEVICE:g=rbDeviceTriggerImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_MESSAGE:g=rbMessageTriggerImpl;break;case RULE_BUILDER_CONSTANTS.EVENT_SOURCES.EVENT_USER:g=rbUserTriggerImpl}}function c(a,b,c,d){return JSON.stringify({system_key:a,name:b,def_module:g.getSystemModule(),def_name:g.getTriggerAction(),service_name:c,key_value_pairs:g.getTriggerActionData(d)})}function d(a,d,e,f,g){var h=$.Deferred(),i=a+"/api/v/3/code/"+d+"/trigger/"+e;return $.ajax({method:"POST",url:i,data:c(d,e,f,g),dataType:"json",contentType:"application/json",beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Create Trigger : %o",a),h.resolve(a)},error:function(a,c,d){console.log("Request failed Create Trigger: "+d),h.reject(b("create",a.status))}}),h.promise()}function e(a,d,e,f,g){var h=$.Deferred(),i=a+"/api/v/3/code/"+d+"/trigger/"+e;return $.ajax({method:"PUT",url:i,data:c(d,e,f,g),dataType:"json",contentType:"application/json",beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Update Trigger: %o",a),h.resolve(a)},error:function(a,c,d){console.log("Request failed Update Trigger: "+d),h.reject(b("modify",a.status))}}),h.promise()}function f(a,c,d,e){var f=$.Deferred(),g=a+"/api/v/3/code/"+c+"/trigger/"+d;return $.ajax({method:"DELETE",url:g,beforeSend:function(a){a.setRequestHeader("ClearBlade-UserToken",cbsettings.authToken)},success:function(a){console.log("Got response Delete Trigger: %o",a),f.resolve(a)},error:function(a,c,d){console.log("Request failed Delete Trigger: "+d),f.reject(b("delete",a.status))}}),f.promise()}var g;return{setTriggerImpl:a,createTrigger:d,modifyTrigger:e,deleteTrigger:f}}function b(a,b){var c={};switch(b){case 400:case 401:c.msg="You do not have the necessary permissions to "+a+" triggers.You need to be granted permission in the ClearBlade developers console (Roles > System Level) to do this.";break;case 405:c.msg="Oops, something went wrong. Please open a support ticket with ClearBlade.";break;case 500:switch(a){case"create":c.msg="The trigger you are attempting to create already exists.";break;case"modify":c.msg="The trigger you are attempting to modify does not exist.";break;case"delete":c.msg="The trigger you are attempting to delete does not exist."}}return c.code=b,c}var c;return{getInstance:function(b){return c||(c=a()),c.setTriggerImpl(b),c}}}(),clearbladeAnalyticsDatasourcePlugin=function(a,b){var c=this,d=a;this.updateNow=function(){var a=JSON.parse(localStorage["ngStorage-cb_novi_dev_token"]),c=JSON.parse(localStorage["ngStorage-cb_platformURL"]),e=JSON.parse(localStorage["ngStorage-dev_info"]),f=e.email,g=c+'/api/v/2/analytics/eventtotals?query={"scope":{"developer":"'+f+'"},"filter":{"module":"'+d.module_name+'","action":"'+d.action+'","id":"'+d.id+'","interval":'+d.interval+"}}";window.XMLHttpRequest?client=new XMLHttpRequest:client=new ActiveXObject("Microsoft.XMLHTTP"),client.onreadystatechange=function(){4==client.readyState&&(200==client.status?b(client.responseText):(console.log(client.responseText),alert("error")))},client.open("GET",g,!0),client.setRequestHeader("Content-type","application/json"),client.setRequestHeader("ClearBlade-DevToken",a),client.send(null)},this.onDispose=function(){},this.onSettingsChanged=function(a){d=a,c.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"clearblade_analytics_event_totals",display_name:"Analytics: Event Totals",settings:[{name:"module_name",display_name:"Module",type:"text",description:"module: user | collection | messaging | service | push ",required:!0},{name:"id",display_name:"ID",type:"text",description:"id: collectionid|userid|topicid|service name| blank if push",required:!1},{name:"action",display_name:"Action",type:"text",description:"action: create|password reset|update|dev alter|dev password reset|dev delete|dev read|dev update|read|delete|dev create|execute|dev save|publish|recieve|ios|android|connection|login|logout|disconnect|sent ",required:!0},{name:"interval",display_name:"Time Interval",type:"text",description:"A time specified in seconds",required:!1}],newInstance:function(a,b,c){b(new clearbladeAnalyticsDatasourcePlugin(a,c))}});var clearbladeCollectionDatasourcePlugin=function(a,b){function c(){return cb.Query({collectionName:g.collection_name})}function d(a){e&&clearInterval(e),e=setInterval(function(){f.updateNow()},a)}var e,f=this,g=a,h=!1,i=c(),j=function(a){var d=$.Deferred(),e=void 0===a||void 0===a.query?c():a.query;return cb.Collection({collectionName:g.collection_name}).fetch(e,function(a,c){a?(h||(alertMessage("Error fetching collection datasource",c),h=!0),d.reject(c)):(b(c),d.resolve(c))}),d.promise()},k=function(a){var b=$.Deferred(),c=f.formatPayload(a.data,a.options.schema);return cb.Collection({collectionName:g.collection_name}).create(c,function(c,d){c?(alertMessage("Error inserting into collection datasource with name '"+g.collection_name+"': ",d),b.reject(d)):(delete a.query,j(a),b.resolve())}),b.promise()},l=function(a){var b=$.Deferred(),c=f.formatPayload(a.data,a.options.schema);if(a.query)try{cb.Collection({collectionName:g.collection_name}).update(a.query,c,function(c,d){c?(alertMessage("Error updating collection datasource with name '"+g.collection_name+"': ",d),b.reject(d)):(delete a.query,j(a),b.resolve())})}catch(a){console.error("Error: Unable to update collection. Please check the outgoing parser for "+g.collection_name),console.error(a),b.reject(a)}else console.warn("No query parameter supplied for updating a collection. Please check the outgoing parser for "+g.collection_name),b.reject();return b.promise()},m=function(a){var b=$.Deferred();if(a.query)try{cb.Collection({collectionName:g.collection_name}).remove(a.query,function(c,d){c?(alertMessage("Error deleting record in collection datasource with name '"+g.collection_name+"': ",d),b.reject(d)):(delete a.query,j(a),b.resolve())})}catch(a){console.error("Error: Unable to remove item from collection. Please check the outgoing parser for "+g.collection_name),console.error(a),b.reject(a)}else console.warn("No query parameter supplied for deleting a row in a collection. Please check the outgoing parser for "+g.collection_name),b.reject();return b.promise()};this.clearQuery=function(){i=c()},this.formatPayload=function(a,b){var c={};void 0!==a.item_id&&delete a.item_id;for(var d=0,e=b.length;d<e;d++)void 0!==a[b[d].name]&&""!==a[b[d].name]&&(c[b[d].name]=utils.convertString(a[b[d].name],b[d].type));return c},this.sendData=function(a){if(!a)return g.refresh_time>0?d(g.refresh_time):(clearInterval(e),e=void 0),$.when(j());if(a.method)switch(a.method){case utils.constants.INSERT_METHOD:return $.when(k(a));case utils.constants.UPDATE_METHOD:return $.when(l(a));case utils.constants.DELETE_METHOD:return $.when(m(a));case utils.constants.PAGE_METHOD:return $.when(j(a))}},this.updateNow=function(){f.sendData()},this.onDispose=function(){clearInterval(e),e=void 0},this.onSettingsChanged=function(a){g=a,f.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"clearblade_collection",display_name:"Collection",settings:[{name:"collection_name",display_name:"Collection Name",type:"text",description:"Name of collection",required:!0},{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",required:!1,default_value:5e3}],newInstance:function(a,b,c){b(new clearbladeCollectionDatasourcePlugin(a,c))}});var clearbladeCollectionColumnsDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1;this.sendData=function(){var a=cb.Collection({collectionName:f.collection_name}),e=function(a,c){a?(console.log(a),g||(alertMessage("Error fetching collection datasource: ",c),g=!0)):b(c)};a.columns(e),f.refresh_time>0?c(f.refresh_time):(clearInterval(d),d=void 0)},this.updateNow=function(){e.sendData()},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"clearblade_collection_columns",display_name:"Collection Columns",settings:[{name:"collection_name",display_name:"Collection Name",type:"text",description:"Name of collection",required:!0},{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",required:!1,default_value:0}],newInstance:function(a,b,c){b(new clearbladeCollectionColumnsDatasourcePlugin(a,c))}});var clearbladeCollectionItemCountDatasourcePlugin=function(a,b){var c,d=this,e=a,f=cb.Collection({collectionName:e.collection_name});this.sendData=function(){f.count(void 0,function(a,c){a?alertMessage("Error getting record count in collection '"+e.collection_name+"': ",c):b(c.count)})},this.updateNow=function(){d.sendData()},this.onDispose=function(){clearInterval(c),c=void 0},this.onSettingsChanged=function(a){e=a,d.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"clearblade_collection_count",display_name:"Collection Item Count",settings:[{name:"collection_name",display_name:"Collection Name",type:"text",description:"Name of collection",required:!0},{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",required:!1,default_value:0}],newInstance:function(a,b,c){b(new clearbladeCollectionItemCountDatasourcePlugin(a,c))}});var clearbladeCurrentUserDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1;this.updateNow=function(){var a=function(a,c){a?(console.log(a),g||(alertMessage("Error fetching current user: ",c),g=!0)):b(c)};cb.User().getUser(a)},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()},c(f.refresh_time)};freeboard.loadDatasourcePlugin({type_name:"clearblade_user",display_name:"Current User",settings:[{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3}],newInstance:function(a,b,c){b(new clearbladeCurrentUserDatasourcePlugin(a,c))}});var clearbladeDeviceDataPlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1,h={};this.updateNow=function(){cb.Device().getDeviceByName(f.device_name,function(a,c){a?g||(alertMessage("Error getting device: ",c),g=!0):(h=c,b(h))})},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()},this.sendData=function(a){"object"!=typeof a&&(a=JSON.parse(a)),cb.Device().updateDevice(f.device_name,a,!0,function(a,b){a&&(console.log("Error updating device "+f.device_name),console.log(JSON.stringify(b)),alertMessage("Error updating device: ",b))})},c(f.refresh_time)};freeboard.loadDatasourcePlugin({type_name:"clearblade_device",display_name:"ClearBlade Device",description:"Access a ClearBlade Device",settings:[{name:"device_name",display_name:"Device Name",type:"text",description:"Name of ClearBlade Device you would like to access",required:!0},{name:"refresh_time",display_name:"Refresh Time",description:"Data refresh time in milliseconds",required:!1,default_value:1e3}],newInstance:function(a,b,c){b(new clearbladeDeviceDataPlugin(a,c))}});var edgeMetricsDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1;this.edgeName="";"string"==typeof f.edge_name&&(this.edgeName=f.edge_name),this.updateNow=function(){function a(){var a=jQuery.Deferred();return h.getStatistics(function(b,c){b?a.reject(b):a.resolve(c.DATA)}),a.promise()}function c(){var a=jQuery.Deferred();return h.getStatisticsHistory(function(b,c){b?a.reject(b):a.resolve(c.DATA)}),a.promise()}function d(){var a=jQuery.Deferred();return h.getDBConnections(function(b,c){b?a.reject(b):a.resolve(c.DATA)}),a.promise()}function f(){var a=jQuery.Deferred();return h.getLogs(function(b,c){b?a.reject(b):a.resolve(c.DATA)}),a.promise()}if(""===this.edgeName)return void console.log("edge_name doesn't seem to be set, not doing anything");var h=cb.Metrics(),i=cb.Query();i.equalTo("name",this.edgeName),h.setQuery(i),$.when(a(),c(),d(),f()).then(function(a,c,d,e){var f=cb.systemKey+":"+this.edgeName,g={stats:a[f],history:c[f],dbconns:d[f],logs:e[f]};b(g)}.bind(e),function(a){g||(alertMessage("Error getting metrics: ",a),g=!0)})},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,"string"==typeof f.edge_name?this.edgeName=f.edge_name:this.edgeName="",e.updateNow()},this.onCalculatedValueChanged=function(a,b){this.edgeName=b,e.updateNow()},c(f.refresh_time)};freeboard.loadDatasourcePlugin({type_name:"edge_metrics",display_name:"Edge Metrics",settings:[{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3},{name:"edge_name",display_name:"Edge Name",type:"data",description:"Name of the edge you would like to access",incoming_parser:!0}],newInstance:function(a,b,c){b(new edgeMetricsDatasourcePlugin(a,c))}});var edgeListDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1;this.updateNow=function(){var a=function(a,c){a?(console.log("error: "+a),g||(alertMessage("Error fetching edge list: ",c),g=!0)):(console.log("Data :"+c),b(c))};cb.getEdges(a)},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()},c(f.refresh_time)};freeboard.loadDatasourcePlugin({type_name:"edge_list",display_name:"Edge List",settings:[{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3}],newInstance:function(a,b,c){b(new edgeListDatasourcePlugin(a,c))}});var clearbladeCollectionRowsDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1;this.updateNow=function(){var a=function(a,c){a?(console.log(a),g||(alertMessage("Error fetching item: ",c),g=!0)):(console.log(JSON.stringify(c)),b(c))},c=cb.Query({collectionName:f.collection_name});c.equalTo(f.field_name,f.field_value),c.fetch(a)},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()},c(f.refresh_time)};freeboard.loadDatasourcePlugin({type_name:"clearblade_fetch_row",display_name:"Item",settings:[{name:"collection_name",display_name:"Collection Name",type:"text",description:"Name of the collection stored in your system",required:!0},{name:"field_name",display_name:"Field Name",type:"text",description:"Name of the column from collection on the system",required:!0},{name:"field_value",display_name:"Field Value",type:"text",description:"Name of the item value to be retrieved",required:!0},{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3}],newInstance:function(a,b,c){b(new clearbladeCollectionRowsDatasourcePlugin(a,c))}});var default_start_time=-1;freeboard.loadDatasourcePlugin({type_name:"message_history",display_name:"Message History",description:"Retrieves messaging history for a topic",settings:[{name:"topic_name",display_name:"Message Topic",type:"text",default_value:"device/tool1",description:"Set your message topic",required:!0},{name:"message_count",display_name:"Message Count",type:"number",default_value:25,description:"Set your message count",required:!0},{name:"start_time",display_name:"Start Time",type:"number",description:"Start time in 'epoch timestamp milliseconds' format. Default to -1 in order to retrieve latest",default_value:default_start_time},{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3}],newInstance:function(a,b,c){b(new messageHistoryPlugin(a,c))}});var messageHistoryPlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=!1,h=function(a,b){a?console.log("Error connecting to messaging: "+JSON.stringify(b)):console.log("Connected to messaging")},i=cb.Messaging({useSSL:!1},h);console.log("Connecting to messaging"),e.onSettingsChanged=function(a){f=a,e.updateNow()},e.updateNow=function(){var a=f.topic_name,c=f.message_count,d=f.start_time===default_start_time?(new Date).getTime():f.start_time,e=function(a,c){a?g||(alertMessage("Error in retreiving messaging history: ",c),g=!0):(console.log("Retreived messaging history"),b(c))};i.getMessageHistory(a,d,c,e)},e.onDispose=function(){clearInterval(d),d=void 0},c(f.refresh_time)},dashboardEventPlugin=function(a,b){var c=this,d=a,e={};c.sendData=function(a){e=a,b(e)},c.onSettingsChanged=function(a){d=a},c.updateNow=function(a){e=a},c.onDispose=function(){}};freeboard.loadDatasourcePlugin({type_name:"dashboardEvent",display_name:"Local Variable",description:"A variable or object stored in the local portal scope",settings:[],newInstance:function(a,b,c){b(new dashboardEventPlugin(a,c))}});var clearbladeServiceDatasourcePlugin=function(a,b){var c,d=this,e=a,f=e.code_name,g=!1;d.onDispose=function(){clearInterval(c)},d.configure=function(){f=e.code_name,clearInterval(c),void 0!==e.refresh_interval&&e.refresh_interval>0&&(c=setInterval(function(){d.updateNow()},utils.secToMs(e.refresh_interval)))},d.onSettingsChanged=function(a){e=a,d.configure()},d.sendData=function(a){var c=$.Deferred(),d=cb.Code();return void 0===a&&(a={}),d.execute(f,a,function(a,d){a?(console.log(d),g||(alertMessage("Error calling code service: ",d),g=!0),c.reject(d)):(b(d),c.resolve(d))}),c.promise()},d.updateNow=function(){d.sendData(utils.parseJsonObject(e.default_payload))},d.configure()};freeboard.loadDatasourcePlugin({type_name:"clearblade_execute_code",display_name:"Code",description:'Call a ClearBlade service with parameters. Data payload must be a valid JSON object. ex: { "key" : "value" } ',settings:[{name:"code_name",display_name:"Code Name",type:"text",description:"Name of the code service which you wish to execute on your system",required:!0},{name:"refresh_interval",display_name:"Refresh Interval",type:"number",description:"Send default payload every X seconds. 0 for no interval",default_value:0},{name:"default_payload",display_name:"Default Payload",type:"String",default_value:"{}",description:'payload must be a valid JSON object. ex: { "parameter" : "value" } '}],newInstance:function(a,b,c){b(new clearbladeServiceDatasourcePlugin(a,c))}}),freeboard.loadDatasourcePlugin({type_name:"messageTopic",display_name:"Message Topic",description:"A topic streaming payloads over a websocket",settings:[{name:"topic_name",display_name:"Message Topic",type:"text",default_value:"device/tool1",description:"Set your message topic"}],newInstance:function(a,b,c){b(new messageTopicPlugin(a,c))}});var messageTopicPlugin=function(a,b){var c=this,d=a,e={},f=function(a,b){a?console.log("Error connecting to messaging: "+JSON.stringify(b)):(console.log("Connected to messaging"),h.subscribe(d.topic_name,{},m))},g="https:"===window.location.protocol,h=cb.Messaging({useSSL:g},f);console.log("Connecting to messaging");var i=1,j=(new Date).getTime(),k=function(a,c){a?c&&c.indexOf("not authorized")?alertMessage("You need to authorize this user in 'Auth > Roles > Message History > Edit' to read the messaging history"):alertMessage("Error fetching topic history for '"+d.topic_name+"'",c):(void 0!==c&&c.constructor===Array&&c.length>0&&(e=c[0].message),b(e))},l=function(){h.getMessageHistory(d.topic_name,j,i,k)},m=function(a){b(a)};c.sendData=function(a){try{h.publish(d.topic_name,a)}catch(a){console.log("ERROR PUBLISHING TO TOPIC"),console.log(a)}},c.onSettingsChanged=function(a){h.unsubscribe(d.topic_name,{}),d=a,h.subscribe(d.topic_name,{},m),l()},c.updateNow=function(){},c.onDispose=function(){h.unsubscribe(d.topic_name,{})},l()},clearbladeUsersDatasourcePlugin=function(a,b){function c(a){d&&clearInterval(d),d=setInterval(function(){e.updateNow()},a)}var d,e=this,f=a,g=(f.query_object,!1);this.updateNow=function(){var a=function(a,c){a?(console.log(a),g||(alertMessage("Error fetching users: ",c),g=!0)):(console.log("updatecallback bout to fire"),b(c))};cb.User().allUsers("",a),f.refresh_time>0?c(f.refresh_time):(clearInterval(d),d=void 0)},this.onDispose=function(){clearInterval(d),d=void 0},this.onSettingsChanged=function(a){f=a,e.updateNow()}};freeboard.loadDatasourcePlugin({type_name:"clearblade_users",display_name:"Users",settings:[{name:"refresh_time",display_name:"Refresh Time",type:"text",description:"In milliseconds",default_value:5e3}],newInstance:function(a,b,c){b(new clearbladeUsersDatasourcePlugin(a,c))}}),function(a,b,c){!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.sparkline&&a(jQuery)}(function(d){"use strict";var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J={},K=0;e=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:c,normalRangeMax:c,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:c,chartRangeMax:c,chartRangeMinX:c,chartRangeMaxX:c,tooltipFormat:new g('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:c,nullColor:c,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:c,chartRangeMin:c,chartRangeClip:!1,colorMap:c,tooltipFormat:new g('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new g('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:c,thresholdValue:0,chartRangeMax:c,chartRangeMin:c,chartRangeClip:!1,tooltipFormat:new g("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:c,tooltipFormat:new g("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new g('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:c,targetColor:"#4a2",chartRangeMax:c,chartRangeMin:c,tooltipFormat:new g("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},C='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',f=function(){var a,b;return a=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(a.prototype=d.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],arguments.length>2&&(b=Array.prototype.slice.call(arguments,1,-1),b.unshift(a.prototype),d.extend.apply(d,b))):a.prototype=arguments[0],a.prototype.cls=a,a},d.SPFormatClass=g=f({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(a,b){this.format=a,this.fclass=b},render:function(a,b,d){var e,f,g,h,i,j=this,k=a;return this.format.replace(this.fre,function(){var a;return f=arguments[1],g=arguments[3],e=j.precre.exec(f),e?(i=e[2],f=e[1]):i=!1,h=k[f],h===c?"":g&&b&&b[g]?(a=b[g],a.get?b[g].get(h)||h:b[g][h]||h):(m(h)&&(h=d.get("numberFormatter")?d.get("numberFormatter")(h):q(h,i,d.get("numberDigitGroupCount"),d.get("numberDigitGroupSep"),d.get("numberDecimalMark"))),h)})}}),d.spformat=function(a,b){return new g(a,b)},h=function(a,b,c){return a<b?b:a>c?c:a},i=function(a,c){var d;return 2===c?(d=b.floor(a.length/2),a.length%2?a[d]:(a[d-1]+a[d])/2):a.length%2?(d=(a.length*c+c)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1]):(d=(a.length*c+2)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1])},j=function(a){var b;switch(a){case"undefined":a=c;break;case"null":a=null;break;case"true":a=!0;break;case"false":a=!1;break;default:b=parseFloat(a),a==b&&(a=b)}return a},k=function(a){var b,c=[];for(b=a.length;b--;)c[b]=j(a[b]);return c},l=function(a,b){var c,d,e=[];for(c=0,d=a.length;c<d;c++)a[c]!==b&&e.push(a[c]);return e},m=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},q=function(a,b,c,e,f){var g,h;for(a=(!1===b?parseFloat(a).toString():a.toFixed(b)).split(""),(g=(g=d.inArray(".",a))<0?a.length:g)<a.length&&(a[g]=f),h=g-c;h>0;h-=c)a.splice(h,0,e);return a.join("")},n=function(a,b,c){var d;for(d=b.length;d--;)if((!c||null!==b[d])&&b[d]!==a)return!1;return!0},function(a){var b,c=0;for(b=a.length;b--;)c+="number"==typeof a[b]?a[b]:0;return c},p=function(a){return d.isArray(a)?a:[a]},o=function(b){var c;a.createStyleSheet?a.createStyleSheet().cssText=b:(c=a.createElement("style"),c.type="text/css",a.getElementsByTagName("head")[0].appendChild(c),c["string"==typeof a.body.style.WebkitAppearance?"innerText":"innerHTML"]=b)},d.fn.simpledraw=function(b,e,f,g){var h,i;if(f&&(h=this.data("_jqs_vcanvas")))return h;if(!1===d.fn.sparkline.canvas)return!1;if(d.fn.sparkline.canvas===c){var j=a.createElement("canvas");if(j.getContext&&j.getContext("2d"))d.fn.sparkline.canvas=function(a,b,c,d){return new G(a,b,c,d)};else{if(!a.namespaces||a.namespaces.v)return d.fn.sparkline.canvas=!1,!1;a.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),d.fn.sparkline.canvas=function(a,b,c,d){return new H(a,b,c)}}}return b===c&&(b=d(this).innerWidth()),e===c&&(e=d(this).innerHeight()),h=d.fn.sparkline.canvas(b,e,this,g),i=d(this).data("_jqs_mhandler"),i&&i.registerCanvas(h),h},d.fn.cleardraw=function(){var a=this.data("_jqs_vcanvas");a&&a.reset()},d.RangeMapClass=r=f({init:function(a){var b,c,d=[];for(b in a)a.hasOwnProperty(b)&&"string"==typeof b&&b.indexOf(":")>-1&&(c=b.split(":"),c[0]=0===c[0].length?-1/0:parseFloat(c[0]),c[1]=0===c[1].length?1/0:parseFloat(c[1]),c[2]=a[b],d.push(c));this.map=a,this.rangelist=d||!1},get:function(a){var b,d,e,f=this.rangelist;if((e=this.map[a])!==c)return e;if(f)for(b=f.length;b--;)if(d=f[b],d[0]<=a&&d[1]>=a)return d[2];return c}}),d.range_map=function(a){return new r(a)},s=f({init:function(a,b){var c=d(a);this.$el=c,this.options=b,this.currentPageX=0,this.currentPageY=0,this.el=a,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!b.get("disableTooltips"),this.highlightEnabled=!b.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a),this.over&&this.updateDisplay()},registerCanvas:function(a){var b=d(a.canvas);this.canvas=a,this.$canvas=b,b.mouseenter(d.proxy(this.mouseenter,this)),b.mouseleave(d.proxy(this.mouseleave,this)),b.click(d.proxy(this.mouseclick,this))},reset:function(a){this.splist=[],this.tooltip&&a&&(this.tooltip.remove(),this.tooltip=c)},mouseclick:function(a){var b=d.Event("sparklineClick");b.originalEvent=a,b.sparklines=this.splist,this.$el.trigger(b)},mouseenter:function(b){d(a.body).unbind("mousemove.jqs"),d(a.body).bind("mousemove.jqs",d.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=b.pageX,this.currentPageY=b.pageY,this.currentEl=b.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new t(this.options),this.tooltip.updatePosition(b.pageX,b.pageY)),this.updateDisplay()},mouseleave:function(){d(a.body).unbind("mousemove.jqs");var b,c,e=this.splist,f=e.length,g=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),c=0;c<f;c++)b=e[c],b.clearRegionHighlight()&&(g=!0);g&&this.canvas.render()},mousemove:function(a){this.currentPageX=a.pageX,this.currentPageY=a.pageY,this.currentEl=a.target,this.tooltip&&this.tooltip.updatePosition(a.pageX,a.pageY),this.updateDisplay()},updateDisplay:function(){var a,b,c,e,f,g=this.splist,h=g.length,i=!1,j=this.$canvas.offset(),k=this.currentPageX-j.left,l=this.currentPageY-j.top;if(this.over){for(c=0;c<h;c++)b=g[c],(e=b.setRegionHighlight(this.currentEl,k,l))&&(i=!0);if(i){if(f=d.Event("sparklineRegionChange"),f.sparklines=this.splist,this.$el.trigger(f),this.tooltip){for(a="",c=0;c<h;c++)b=g[c],a+=b.getCurrentRegionTooltip();this.tooltip.setContent(a)}this.disableHighlight||this.canvas.render()}null===e&&this.mouseleave()}}}),t=f({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(b){var c,e=b.get("tooltipClassname","jqstooltip"),f=this.sizeStyle;this.container=b.get("tooltipContainer")||a.body,this.tooltipOffsetX=b.get("tooltipOffsetX",10),this.tooltipOffsetY=b.get("tooltipOffsetY",12),d("#jqssizetip").remove(),d("#jqstooltip").remove(),this.sizetip=d("<div/>",{id:"jqssizetip",style:f,class:e}),this.tooltip=d("<div/>",{id:"jqstooltip",class:e}).appendTo(this.container),c=this.tooltip.offset(),this.offsetLeft=c.left,this.offsetTop=c.top,this.hidden=!0,d(window).unbind("resize.jqs scroll.jqs"),d(window).bind("resize.jqs scroll.jqs",d.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=d(window).scrollTop(),this.scrollLeft=d(window).scrollLeft(),this.scrollRight=this.scrollLeft+d(window).width(),this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(a){if(!a)return this.tooltip.css("visibility","hidden"),void(this.hidden=!0);this.getSize(a),this.tooltip.html(a).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(a,b){if(a===c){if(this.mousex===c)return;a=this.mousex-this.offsetLeft,b=this.mousey-this.offsetTop}else this.mousex=a-=this.offsetLeft,this.mousey=b-=this.offsetTop;this.height&&this.width&&!this.hidden&&(b-=this.height+this.tooltipOffsetY,a+=this.tooltipOffsetX,b<this.scrollTop&&(b=this.scrollTop),a<this.scrollLeft?a=this.scrollLeft:a+this.width>this.scrollRight&&(a=this.scrollRight-this.width),this.tooltip.css({left:a,top:b}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=c,d(window).unbind("resize.jqs scroll.jqs")}}),D=function(){o(C)},d(D),I=[],d.fn.sparkline=function(b,e){return this.each(function(){var f,g,h=new d.fn.sparkline.options(this,e),i=d(this);if(f=function(){var e,f,g,j,k,l,m;if("html"===b||b===c?(m=this.getAttribute(h.get("tagValuesAttribute")),m!==c&&null!==m||(m=i.html()),e=m.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):e=b,f="auto"===h.get("width")?e.length*h.get("defaultPixelsPerValue"):h.get("width"),"auto"===h.get("height")?h.get("composite")&&d.data(this,"_jqs_vcanvas")||(j=a.createElement("span"),j.innerHTML="a",i.html(j),g=d(j).innerHeight()||d(j).height(),d(j).remove(),j=null):g=h.get("height"),h.get("disableInteraction")?k=!1:(k=d.data(this,"_jqs_mhandler"),k?h.get("composite")||k.reset():(k=new s(this,h),d.data(this,"_jqs_mhandler",k))),h.get("composite")&&!d.data(this,"_jqs_vcanvas"))return void(d.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),d.data(this,"_jqs_errnotify",!0)));l=new(d.fn.sparkline[h.get("type")])(this,e,h,f,g),l.render(),k&&k.registerSparkline(l)},d(this).html()&&!h.get("disableHiddenCheck")&&d(this).is(":hidden")||!d(this).parents("body").length){if(!h.get("composite")&&d.data(this,"_jqs_pending"))for(g=I.length;g;g--)I[g-1][0]==this&&I.splice(g-1,1);I.push([this,f]),d.data(this,"_jqs_pending",!0)}else f.call(this)})},d.fn.sparkline.defaults=e(),d.sparkline_display_visible=function(){var a,b,c,e=[];for(b=0,c=I.length;b<c;b++)a=I[b][0],d(a).is(":visible")&&!d(a).parents().is(":hidden")?(I[b][1].call(a),d.data(I[b][0],"_jqs_pending",!1),e.push(b)):!d(a).closest("html").length&&!d.data(a,"_jqs_pending")&&(d.data(I[b][0],"_jqs_pending",!1),e.push(b));for(b=e.length;b;b--)I.splice(e[b-1],1)},d.fn.sparkline.options=f({init:function(a,b){var c,e,f,g;this.userOptions=b=b||{},this.tag=a,this.tagValCache={},e=d.fn.sparkline.defaults,f=e.common,this.tagOptionsPrefix=b.enableTagOptions&&(b.tagOptionsPrefix||f.tagOptionsPrefix),g=this.getTagSetting("type"),c=g===J?e[b.type||f.type]:e[g],this.mergedOptions=d.extend({},f,c,b)},getTagSetting:function(a){var b,d,e,f,g=this.tagOptionsPrefix;if(!1===g||g===c)return J;if(this.tagValCache.hasOwnProperty(a))b=this.tagValCache.key;else{if((b=this.tag.getAttribute(g+a))===c||null===b)b=J;else if("["===b.substr(0,1))for(b=b.substr(1,b.length-2).split(","),d=b.length;d--;)b[d]=j(b[d].replace(/(^\s*)|(\s*$)/g,""));else if("{"===b.substr(0,1))for(e=b.substr(1,b.length-2).split(","),b={},d=e.length;d--;)f=e[d].split(":",2),b[f[0].replace(/(^\s*)|(\s*$)/g,"")]=j(f[1].replace(/(^\s*)|(\s*$)/g,""));else b=j(b);this.tagValCache.key=b}return b},get:function(a,b){var d,e=this.getTagSetting(a);return e!==J?e:(d=this.mergedOptions[a])===c?b:d}}),d.fn.sparkline._base=f({disabled:!1,init:function(a,b,e,f,g){this.el=a,this.$el=d(a),this.values=b,this.options=e,this.width=f,this.height=g,this.currentRegion=c},initTarget:function(){var a=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),a))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(a,b){},setRegionHighlight:function(a,b,d){var e,f=this.currentRegion,g=!this.options.get("disableHighlight");return b>this.canvasWidth||d>this.canvasHeight||b<0||d<0?null:(e=this.getRegion(a,b,d),f!==e&&(f!==c&&g&&this.removeHighlight(),this.currentRegion=e,e!==c&&g&&this.renderHighlight(),!0))},clearRegionHighlight:function(){return this.currentRegion!==c&&(this.removeHighlight(),this.currentRegion=c,!0)},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(a){},getCurrentRegionTooltip:function(){var a,b,e,f,h,i,j,k,l,m,n,o,p,q,r=this.options,s="",t=[];if(this.currentRegion===c)return"";if(a=this.getCurrentRegionFields(),n=r.get("tooltipFormatter"))return n(this,r,a);if(r.get("tooltipChartTitle")&&(s+='<div class="jqs jqstitle">'+r.get("tooltipChartTitle")+"</div>\n"),!(b=this.options.get("tooltipFormat")))return"";if(d.isArray(b)||(b=[b]),d.isArray(a)||(a=[a]),j=this.options.get("tooltipFormatFieldlist"),k=this.options.get("tooltipFormatFieldlistKey"),j&&k){for(l=[],i=a.length;i--;)m=a[i][k],-1!=(q=d.inArray(m,j))&&(l[q]=a[i]);a=l}for(e=b.length,p=a.length,i=0;i<e;i++)for(o=b[i],"string"==typeof o&&(o=new g(o)),f=o.fclass||"jqsfield",q=0;q<p;q++)a[q].isNull&&r.get("tooltipSkipNull")||(d.extend(a[q],{prefix:r.get("tooltipPrefix"),suffix:r.get("tooltipSuffix")}),h=o.render(a[q],r.get("tooltipValueLookups"),r),t.push('<div class="'+f+'">'+h+"</div>"));return t.length?s+t.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(a,c){var d,e,f,g,i=c.get("highlightColor"),j=c.get("highlightLighten");if(i)return i;if(j&&(d=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a))){for(f=[],e=4===a.length?16:1,g=0;g<3;g++)f[g]=h(b.round(parseInt(d[g+1],16)*e*j),0,255);return"rgb("+f.join(",")+")"}return a}}),u={changeHighlight:function(a){var b,c=this.currentRegion,e=this.target,f=this.regionShapes[c];f&&(b=this.renderRegion(c,a),d.isArray(b)||d.isArray(f)?(e.replaceWithShapes(f,b),this.regionShapes[c]=d.map(b,function(a){return a.id})):(e.replaceWithShape(f,b),this.regionShapes[c]=b.id))},render:function(){var a,b,c,e,f=this.values,g=this.target,h=this.regionShapes;if(this.cls._super.render.call(this)){for(c=f.length;c--;)if(a=this.renderRegion(c))if(d.isArray(a)){for(b=[],e=a.length;e--;)a[e].append(),b.push(a[e].id);h[c]=b}else a.append(),h[c]=a.id;else h[c]=null;g.render()}}},d.fn.sparkline.line=v=f(d.fn.sparkline._base,{type:"line",init:function(a,b,c,d,e){v._super.init.call(this,a,b,c,d,e),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(a,b,d){var e,f=this.regionMap;for(e=f.length;e--;)if(null!==f[e]&&b>=f[e][0]&&b<=f[e][1])return f[e][2];return c},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:null===this.yvalues[a],x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a,b,d=this.currentRegion,e=this.target,f=this.vertices[d],g=this.options,h=g.get("spotRadius"),i=g.get("highlightSpotColor"),j=g.get("highlightLineColor");f&&(h&&i&&(a=e.drawCircle(f[0],f[1],h,c,i),this.highlightSpotId=a.id,e.insertAfterShape(this.lastShapeId,a)),j&&(b=e.drawLine(f[0],this.canvasTop,f[0],this.canvasTop+this.canvasHeight,j),this.highlightLineId=b.id,e.insertAfterShape(this.lastShapeId,b)))},removeHighlight:function(){var a=this.target;this.highlightSpotId&&(a.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(a.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var a,c,d,e,f,g=this.values,h=g.length,i=this.xvalues,j=this.yvalues,k=this.yminmax;for(a=0;a<h;a++)c=g[a],d="string"==typeof g[a],e="object"==typeof g[a]&&g[a]instanceof Array,f=d&&g[a].split(":"),d&&2===f.length?(i.push(Number(f[0])),j.push(Number(f[1])),k.push(Number(f[1]))):e?(i.push(c[0]),j.push(c[1]),k.push(c[1])):(i.push(a),null===g[a]||"null"===g[a]?j.push(null):(j.push(Number(c)),k.push(Number(c))));this.options.get("xvalues")&&(i=this.options.get("xvalues")),this.maxy=this.maxyorg=b.max.apply(b,k),this.miny=this.minyorg=b.min.apply(b,k),this.maxx=b.max.apply(b,i),this.minx=b.min.apply(b,i),this.xvalues=i,this.yvalues=j,this.yminmax=k},processRangeOptions:function(){var a=this.options,b=a.get("normalRangeMin"),d=a.get("normalRangeMax");b!==c&&(b<this.miny&&(this.miny=b),d>this.maxy&&(this.maxy=d)),a.get("chartRangeMin")!==c&&(a.get("chartRangeClip")||a.get("chartRangeMin")<this.miny)&&(this.miny=a.get("chartRangeMin")),a.get("chartRangeMax")!==c&&(a.get("chartRangeClip")||a.get("chartRangeMax")>this.maxy)&&(this.maxy=a.get("chartRangeMax")),a.get("chartRangeMinX")!==c&&(a.get("chartRangeClipX")||a.get("chartRangeMinX")<this.minx)&&(this.minx=a.get("chartRangeMinX")),a.get("chartRangeMaxX")!==c&&(a.get("chartRangeClipX")||a.get("chartRangeMaxX")>this.maxx)&&(this.maxx=a.get("chartRangeMaxX"))},drawNormalRange:function(a,d,e,f,g){var h=this.options.get("normalRangeMin"),i=this.options.get("normalRangeMax"),j=d+b.round(e-e*((i-this.miny)/g)),k=b.round(e*(i-h)/g);this.target.drawRect(a,j,f,k,c,this.options.get("normalRangeColor")).append()},render:function(){var a,e,f,g,h,i,j,k,l,m,n,o,p,q,s,t,u,w,x,y,z,A,B,C,D,E=this.options,F=this.target,G=this.canvasWidth,H=this.canvasHeight,I=this.vertices,J=E.get("spotRadius"),K=this.regionMap;if(v._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),B=this.xvalues,C=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(g=h=0,a=this.maxx-this.minx==0?1:this.maxx-this.minx,e=this.maxy-this.miny==0?1:this.maxy-this.miny,f=this.yvalues.length-1,J&&(G<4*J||H<4*J)&&(J=0),J&&(z=E.get("highlightSpotColor")&&!E.get("disableInteraction"),(z||E.get("minSpotColor")||E.get("spotColor")&&C[f]===this.miny)&&(H-=b.ceil(J)),(z||E.get("maxSpotColor")||E.get("spotColor")&&C[f]===this.maxy)&&(H-=b.ceil(J),g+=b.ceil(J)),(z||(E.get("minSpotColor")||E.get("maxSpotColor"))&&(C[0]===this.miny||C[0]===this.maxy))&&(h+=b.ceil(J),G-=b.ceil(J)),(z||E.get("spotColor")||E.get("minSpotColor")||E.get("maxSpotColor")&&(C[f]===this.miny||C[f]===this.maxy))&&(G-=b.ceil(J))),H--,E.get("normalRangeMin")!==c&&!E.get("drawNormalOnTop")&&this.drawNormalRange(h,g,H,G,e),j=[],k=[j],q=s=null,t=C.length,D=0;D<t;D++)l=B[D],n=B[D+1],m=C[D],o=h+b.round((l-this.minx)*(G/a)),p=D<t-1?h+b.round((n-this.minx)*(G/a)):G,s=o+(p-o)/2,K[D]=[q||0,s,D],q=s,null===m?D&&(null!==C[D-1]&&(j=[],k.push(j)),I.push(null)):(m<this.miny&&(m=this.miny),m>this.maxy&&(m=this.maxy),j.length||j.push([o,g+H]),i=[o,g+b.round(H-H*((m-this.miny)/e))],j.push(i),I.push(i));for(u=[],w=[],x=k.length,D=0;D<x;D++)j=k[D],j.length&&(E.get("fillColor")&&(j.push([j[j.length-1][0],g+H]),w.push(j.slice(0)),j.pop()),j.length>2&&(j[0]=[j[0][0],j[1][1]]),u.push(j));for(x=w.length,D=0;D<x;D++)F.drawShape(w[D],E.get("fillColor"),E.get("fillColor")).append();for(E.get("normalRangeMin")!==c&&E.get("drawNormalOnTop")&&this.drawNormalRange(h,g,H,G,e),x=u.length,D=0;D<x;D++)F.drawShape(u[D],E.get("lineColor"),c,E.get("lineWidth")).append();if(J&&E.get("valueSpots"))for(y=E.get("valueSpots"),y.get===c&&(y=new r(y)),D=0;D<t;D++)(A=y.get(C[D]))&&F.drawCircle(h+b.round((B[D]-this.minx)*(G/a)),g+b.round(H-H*((C[D]-this.miny)/e)),J,c,A).append();J&&E.get("spotColor")&&null!==C[f]&&F.drawCircle(h+b.round((B[B.length-1]-this.minx)*(G/a)),g+b.round(H-H*((C[f]-this.miny)/e)),J,c,E.get("spotColor")).append(),this.maxy!==this.minyorg&&(J&&E.get("minSpotColor")&&(l=B[d.inArray(this.minyorg,C)],F.drawCircle(h+b.round((l-this.minx)*(G/a)),g+b.round(H-H*((this.minyorg-this.miny)/e)),J,c,E.get("minSpotColor")).append()),J&&E.get("maxSpotColor")&&(l=B[d.inArray(this.maxyorg,C)],F.drawCircle(h+b.round((l-this.minx)*(G/a)),g+b.round(H-H*((this.maxyorg-this.miny)/e)),J,c,E.get("maxSpotColor")).append())),this.lastShapeId=F.getLastShapeId(),this.canvasTop=g,F.render()}}}),d.fn.sparkline.bar=w=f(d.fn.sparkline._base,u,{type:"bar",init:function(a,e,f,g,i){var m,n,o,p,q,s,t,u,v,x,y,z,A,B,C,D,E,F,G,H,I,J,K=parseInt(f.get("barWidth"),10),L=parseInt(f.get("barSpacing"),10),M=f.get("chartRangeMin"),N=f.get("chartRangeMax"),O=f.get("chartRangeClip"),P=1/0,Q=-1/0;for(w._super.init.call(this,a,e,f,g,i),s=0,t=e.length;s<t;s++)H=e[s],m="string"==typeof H&&H.indexOf(":")>-1,(m||d.isArray(H))&&(C=!0,m&&(H=e[s]=k(H.split(":"))),H=l(H,null),n=b.min.apply(b,H),o=b.max.apply(b,H),n<P&&(P=n),o>Q&&(Q=o));this.stacked=C,this.regionShapes={},this.barWidth=K,this.barSpacing=L,this.totalBarWidth=K+L,this.width=g=e.length*K+(e.length-1)*L,this.initTarget(),O&&(A=M===c?-1/0:M,B=N===c?1/0:N),q=[],p=C?[]:q;var R=[],S=[];for(s=0,t=e.length;s<t;s++)if(C)for(D=e[s],e[s]=G=[],R[s]=0,p[s]=S[s]=0,E=0,F=D.length;E<F;E++)null!==(H=G[E]=O?h(D[E],A,B):D[E])&&(H>0&&(R[s]+=H),P<0&&Q>0?H<0?S[s]+=b.abs(H):p[s]+=H:p[s]+=b.abs(H-(H<0?Q:P)),q.push(H));else H=O?h(e[s],A,B):e[s],null!==(H=e[s]=j(H))&&q.push(H);this.max=z=b.max.apply(b,q),this.min=y=b.min.apply(b,q),this.stackMax=Q=C?b.max.apply(b,R):z,this.stackMin=P=C?b.min.apply(b,q):y,f.get("chartRangeMin")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMin")<y)&&(y=f.get("chartRangeMin")),f.get("chartRangeMax")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMax")>z)&&(z=f.get("chartRangeMax")),this.zeroAxis=v=f.get("zeroAxis",!0),x=y<=0&&z>=0&&v?0:0==v?y:y>0?y:z,this.xaxisOffset=x,u=C?b.max.apply(b,p)+b.max.apply(b,S):z-y,this.canvasHeightEf=v&&y<0?this.canvasHeight-2:this.canvasHeight-1,y<x?(J=C&&z>=0?Q:z,(I=(J-x)/u*this.canvasHeight)!==b.ceil(I)&&(this.canvasHeightEf-=2,I=b.ceil(I))):I=this.canvasHeight,this.yoffset=I,d.isArray(f.get("colorMap"))?(this.colorMapByIndex=f.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=f.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===c&&(this.colorMapByValue=new r(this.colorMapByValue))),this.range=u},getRegion:function(a,d,e){var f=b.floor(d/this.totalBarWidth);return f<0||f>=this.values.length?c:f},getCurrentRegionFields:function(){var a,b,c=this.currentRegion,d=p(this.values[c]),e=[];for(b=d.length;b--;)a=d[b],e.push({isNull:null===a,value:a,color:this.calcColor(b,a,c),offset:c});return e},calcColor:function(a,b,e){var f,g,h=this.colorMapByIndex,i=this.colorMapByValue,j=this.options;return f=this.stacked?j.get("stackedBarColor"):b<0?j.get("negBarColor"):j.get("barColor"),0===b&&j.get("zeroColor")!==c&&(f=j.get("zeroColor")),i&&(g=i.get(b))?f=g:h&&h.length>e&&(f=h[e]),d.isArray(f)?f[a%f.length]:f},renderRegion:function(a,e){var f,g,h,i,j,k,l,m,o,p,q=this.values[a],r=this.options,s=this.xaxisOffset,t=[],u=this.range,v=this.stacked,w=this.target,x=a*this.totalBarWidth,y=this.canvasHeightEf,z=this.yoffset;if(q=d.isArray(q)?q:[q],l=q.length,m=q[0],i=n(null,q),p=n(s,q,!0),i)return r.get("nullColor")?(h=e?r.get("nullColor"):this.calcHighlightColor(r.get("nullColor"),r),f=z>0?z-1:z,w.drawRect(x,f,this.barWidth-1,0,h,h)):c;for(j=z,k=0;k<l;k++){if(m=q[k],v&&m===s){if(!p||o)continue;o=!0}g=u>0?b.floor(y*(b.abs(m-s)/u))+1:1,m<s||m===s&&0===z?(f=j,j+=g):(f=z-g,z-=g),h=this.calcColor(k,m,a),e&&(h=this.calcHighlightColor(h,r)),t.push(w.drawRect(x,f,this.barWidth-1,g-1,h,h))}return 1===t.length?t[0]:t}}),d.fn.sparkline.tristate=x=f(d.fn.sparkline._base,u,{type:"tristate",init:function(a,b,e,f,g){var h=parseInt(e.get("barWidth"),10),i=parseInt(e.get("barSpacing"),10);x._super.init.call(this,a,b,e,f,g),this.regionShapes={},this.barWidth=h,this.barSpacing=i,this.totalBarWidth=h+i,this.values=d.map(b,Number),this.width=f=b.length*h+(b.length-1)*i,d.isArray(e.get("colorMap"))?(this.colorMapByIndex=e.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=e.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===c&&(this.colorMapByValue=new r(this.colorMapByValue))),this.initTarget()},getRegion:function(a,c,d){return b.floor(c/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(a,b){var c,d=this.values,e=this.options,f=this.colorMapByIndex,g=this.colorMapByValue;return g&&(c=g.get(a))?c:f&&f.length>b?f[b]:d[b]<0?e.get("negBarColor"):d[b]>0?e.get("posBarColor"):e.get("zeroBarColor")},renderRegion:function(a,c){var d,e,f,g,h,i,j=this.values,k=this.options,l=this.target;if(d=l.pixelHeight,f=b.round(d/2),g=a*this.totalBarWidth,j[a]<0?(h=f,e=f-1):j[a]>0?(h=0,e=f-1):(h=f-1,e=2),i=this.calcColor(j[a],a),null!==i)return c&&(i=this.calcHighlightColor(i,k)),l.drawRect(g,h,this.barWidth-1,e-1,i,i)}}),d.fn.sparkline.discrete=y=f(d.fn.sparkline._base,u,{type:"discrete",init:function(a,e,f,g,h){y._super.init.call(this,a,e,f,g,h),this.regionShapes={},this.values=e=d.map(e,Number),this.min=b.min.apply(b,e),this.max=b.max.apply(b,e),this.range=this.max-this.min,this.width=g="auto"===f.get("width")?2*e.length:this.width,this.interval=b.floor(g/e.length),this.itemWidth=g/e.length,f.get("chartRangeMin")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMin")<this.min)&&(this.min=f.get("chartRangeMin")),f.get("chartRangeMax")!==c&&(f.get("chartRangeClip")||f.get("chartRangeMax")>this.max)&&(this.max=f.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===f.get("lineHeight")?b.round(.3*this.canvasHeight):f.get("lineHeight"))},getRegion:function(a,c,d){return b.floor(c/this.itemWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],offset:a}},renderRegion:function(a,c){var d,e,f,g,i=this.values,j=this.options,k=this.min,l=this.max,m=this.range,n=this.interval,o=this.target,p=this.canvasHeight,q=this.lineHeight,r=p-q;return e=h(i[a],k,l),g=a*n,d=b.round(r-r*((e-k)/m)),f=j.get("thresholdColor")&&e<j.get("thresholdValue")?j.get("thresholdColor"):j.get("lineColor"),c&&(f=this.calcHighlightColor(f,j)),o.drawLine(g,d,g,d+q,f)}}),d.fn.sparkline.bullet=z=f(d.fn.sparkline._base,{type:"bullet",init:function(a,d,e,f,g){var h,i,j;z._super.init.call(this,a,d,e,f,g),this.values=d=k(d),j=d.slice(),j[0]=null===j[0]?j[2]:j[0],j[1]=null===d[1]?j[2]:j[1],h=b.min.apply(b,d),i=b.max.apply(b,d),h=e.get("base")===c?h<0?h:0:e.get("base"),this.min=h,this.max=i,this.range=i-h,this.shapes={},this.valueShapes={},this.regiondata={},this.width=f="auto"===e.get("width")?"4.0em":f,this.target=this.$el.simpledraw(f,g,e.get("composite")),d.length||(this.disabled=!0),this.initTarget()},getRegion:function(a,b,d){var e=this.target.getShapeAt(a,b,d);return e!==c&&this.shapes[e]!==c?this.shapes[e]:c},getCurrentRegionFields:function(){var a=this.currentRegion;return{fieldkey:a.substr(0,1),value:this.values[a.substr(1)],region:a}},changeHighlight:function(a){var b,c=this.currentRegion,d=this.valueShapes[c];switch(delete this.shapes[d],c.substr(0,1)){case"r":b=this.renderRange(c.substr(1),a);break;case"p":b=this.renderPerformance(a);break;case"t":b=this.renderTarget(a)}this.valueShapes[c]=b.id,this.shapes[b.id]=c,this.target.replaceWithShape(d,b)},renderRange:function(a,c){var d=this.values[a],e=b.round(this.canvasWidth*((d-this.min)/this.range)),f=this.options.get("rangeColors")[a-2];return c&&(f=this.calcHighlightColor(f,this.options)),this.target.drawRect(0,0,e-1,this.canvasHeight-1,f,f)},renderPerformance:function(a){var c=this.values[1],d=b.round(this.canvasWidth*((c-this.min)/this.range)),e=this.options.get("performanceColor");return a&&(e=this.calcHighlightColor(e,this.options)),this.target.drawRect(0,b.round(.3*this.canvasHeight),d-1,b.round(.4*this.canvasHeight)-1,e,e)},renderTarget:function(a){var c=this.values[0],d=b.round(this.canvasWidth*((c-this.min)/this.range)-this.options.get("targetWidth")/2),e=b.round(.1*this.canvasHeight),f=this.canvasHeight-2*e,g=this.options.get("targetColor");return a&&(g=this.calcHighlightColor(g,this.options)),this.target.drawRect(d,e,this.options.get("targetWidth")-1,f-1,g,g)},render:function(){var a,b,c=this.values.length,d=this.target;if(z._super.render.call(this)){for(a=2;a<c;a++)b=this.renderRange(a).append(),this.shapes[b.id]="r"+a,this.valueShapes["r"+a]=b.id;null!==this.values[1]&&(b=this.renderPerformance().append(),this.shapes[b.id]="p1",this.valueShapes.p1=b.id),null!==this.values[0]&&(b=this.renderTarget().append(),this.shapes[b.id]="t0",this.valueShapes.t0=b.id),d.render()}}}),d.fn.sparkline.pie=A=f(d.fn.sparkline._base,{type:"pie",init:function(a,c,e,f,g){var h,i=0;if(A._super.init.call(this,a,c,e,f,g),this.shapes={},this.valueShapes={},this.values=c=d.map(c,Number),"auto"===e.get("width")&&(this.width=this.height),c.length>0)for(h=c.length;h--;)i+=c[h];this.total=i,this.initTarget(),this.radius=b.floor(b.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(a,b,d){var e=this.target.getShapeAt(a,b,d);return e!==c&&this.shapes[e]!==c?this.shapes[e]:c},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===c,value:this.values[a],percent:this.values[a]/this.total*100,color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},changeHighlight:function(a){var b=this.currentRegion,c=this.renderSlice(b,a),d=this.valueShapes[b];delete this.shapes[d],this.target.replaceWithShape(d,c),this.valueShapes[b]=c.id,this.shapes[c.id]=b},renderSlice:function(a,d){var e,f,g,h,i,j=this.target,k=this.options,l=this.radius,m=k.get("borderWidth"),n=k.get("offset"),o=2*b.PI,p=this.values,q=this.total,r=n?2*b.PI*(n/360):0;for(h=p.length,g=0;g<h;g++){if(e=r,f=r,q>0&&(f=r+o*(p[g]/q)),a===g)return i=k.get("sliceColors")[g%k.get("sliceColors").length],d&&(i=this.calcHighlightColor(i,k)),j.drawPieSlice(l,l,l-m,e,f,c,i);r=f}},render:function(){var a,d,e=this.target,f=this.values,g=this.options,h=this.radius,i=g.get("borderWidth");if(A._super.render.call(this)){for(i&&e.drawCircle(h,h,b.floor(h-i/2),g.get("borderColor"),c,i).append(),d=f.length;d--;)f[d]&&(a=this.renderSlice(d).append(),this.valueShapes[d]=a.id,this.shapes[a.id]=d);e.render()}}}),d.fn.sparkline.box=B=f(d.fn.sparkline._base,{type:"box",init:function(a,b,c,e,f){B._super.init.call(this,a,b,c,e,f),this.values=d.map(b,Number),this.width="auto"===c.get("width")?"4.0em":e,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==c&&a.push({field:"lo",value:this.loutlier}),this.routlier!==c&&a.push({field:"ro",value:this.routlier}),this.lwhisker!==c&&a.push({field:"lw",value:this.lwhisker}),this.rwhisker!==c&&a.push({field:"rw",value:this.rwhisker}),a},render:function(){var a,d,e,f,g,h,j,k,l,m,n,o=this.target,p=this.values,q=p.length,r=this.options,s=this.canvasWidth,t=this.canvasHeight,u=r.get("chartRangeMin")===c?b.min.apply(b,p):r.get("chartRangeMin"),v=r.get("chartRangeMax")===c?b.max.apply(b,p):r.get("chartRangeMax"),w=0;if(B._super.render.call(this)){if(r.get("raw"))r.get("showOutliers")&&p.length>5?(d=p[0],a=p[1],f=p[2],g=p[3],h=p[4],j=p[5],k=p[6]):(a=p[0],f=p[1],g=p[2],h=p[3],j=p[4]);else if(p.sort(function(a,b){return a-b}),f=i(p,1),g=i(p,2),h=i(p,3),e=h-f,r.get("showOutliers")){for(a=j=c,l=0;l<q;l++)a===c&&p[l]>f-e*r.get("outlierIQR")&&(a=p[l]),p[l]<h+e*r.get("outlierIQR")&&(j=p[l]);d=p[0],k=p[q-1]}else a=p[0],j=p[q-1];this.quartiles=[f,g,h],this.lwhisker=a,this.rwhisker=j,this.loutlier=d,this.routlier=k,n=s/(v-u+1),r.get("showOutliers")&&(w=b.ceil(r.get("spotRadius")),s-=2*b.ceil(r.get("spotRadius")),n=s/(v-u+1),d<a&&o.drawCircle((d-u)*n+w,t/2,r.get("spotRadius"),r.get("outlierLineColor"),r.get("outlierFillColor")).append(),k>j&&o.drawCircle((k-u)*n+w,t/2,r.get("spotRadius"),r.get("outlierLineColor"),r.get("outlierFillColor")).append()),o.drawRect(b.round((f-u)*n+w),b.round(.1*t),b.round((h-f)*n),b.round(.8*t),r.get("boxLineColor"),r.get("boxFillColor")).append(),o.drawLine(b.round((a-u)*n+w),b.round(t/2),b.round((f-u)*n+w),b.round(t/2),r.get("lineColor")).append(),o.drawLine(b.round((a-u)*n+w),b.round(t/4),b.round((a-u)*n+w),b.round(t-t/4),r.get("whiskerColor")).append(),o.drawLine(b.round((j-u)*n+w),b.round(t/2),b.round((h-u)*n+w),b.round(t/2),r.get("lineColor")).append(),o.drawLine(b.round((j-u)*n+w),b.round(t/4),b.round((j-u)*n+w),b.round(t-t/4),r.get("whiskerColor")).append(),o.drawLine(b.round((g-u)*n+w),b.round(.1*t),b.round((g-u)*n+w),b.round(.9*t),r.get("medianColor")).append(),r.get("target")&&(m=b.ceil(r.get("spotRadius")),o.drawLine(b.round((r.get("target")-u)*n+w),b.round(t/2-m),b.round((r.get("target")-u)*n+w),b.round(t/2+m),r.get("targetColor")).append(),o.drawLine(b.round((r.get("target")-u)*n+w-m),b.round(t/2),b.round((r.get("target")-u)*n+w+m),b.round(t/2),r.get("targetColor")).append()),o.render()}}}),E=f({init:function(a,b,c,d){this.target=a,this.id=b,this.type=c,this.args=d},append:function(){return this.target.appendShape(this),this}}),F=f({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,b,c){a&&(this.width=a,this.height=b,this.target=c,this.lastShapeId=null,c[0]&&(c=c[0]),d.data(c,"_jqs_vcanvas",this))},drawLine:function(a,b,c,d,e,f){return this.drawShape([[a,b],[c,d]],e,f)},drawShape:function(a,b,c,d){return this._genShape("Shape",[a,b,c,d])},drawCircle:function(a,b,c,d,e,f){return this._genShape("Circle",[a,b,c,d,e,f])},drawPieSlice:function(a,b,c,d,e,f,g){return this._genShape("PieSlice",[a,b,c,d,e,f,g])},drawRect:function(a,b,c,d,e,f){return this._genShape("Rect",[a,b,c,d,e,f])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(a,b){d(b).html(a)},_calculatePixelDims:function(a,b,c){var e;e=this._pxregex.exec(b),this.pixelHeight=e?e[1]:d(c).height(),e=this._pxregex.exec(a),this.pixelWidth=e?e[1]:d(c).width()},_genShape:function(a,b){var c=K++;return b.unshift(c),new E(this,c,a,b)},appendShape:function(a){alert("appendShape not implemented")},replaceWithShape:function(a,b){alert("replaceWithShape not implemented")},insertAfterShape:function(a,b){alert("insertAfterShape not implemented")},removeShapeId:function(a){alert("removeShapeId not implemented")},getShapeAt:function(a,b,c){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),G=f(F,{init:function(b,e,f,g){G._super.init.call(this,b,e,f),this.canvas=a.createElement("canvas"),f[0]&&(f=f[0]),d.data(f,"_jqs_vcanvas",this),d(this.canvas).css({display:"inline-block",width:b,height:e,verticalAlign:"top"}),this._insert(this.canvas,f),this._calculatePixelDims(b,e,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=g,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=c,d(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(a,b,d){var e=this.canvas.getContext("2d");return a!==c&&(e.strokeStyle=a),e.lineWidth=d===c?1:d,b!==c&&(e.fillStyle=b),e},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=c},_drawShape:function(a,b,d,e,f){var g,h,i=this._getContext(d,e,f);for(i.beginPath(),i.moveTo(b[0][0]+.5,b[0][1]+.5),g=1,h=b.length;g<h;g++)i.lineTo(b[g][0]+.5,b[g][1]+.5);d!==c&&i.stroke(),e!==c&&i.fill(),this.targetX!==c&&this.targetY!==c&&i.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawCircle:function(a,d,e,f,g,h,i){var j=this._getContext(g,h,i);j.beginPath(),j.arc(d,e,f,0,2*b.PI,!1),this.targetX!==c&&this.targetY!==c&&j.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a),g!==c&&j.stroke(),h!==c&&j.fill()},_drawPieSlice:function(a,b,d,e,f,g,h,i){var j=this._getContext(h,i);j.beginPath(),j.moveTo(b,d),j.arc(b,d,e,f,g,!1),j.lineTo(b,d),j.closePath(),h!==c&&j.stroke(),i&&j.fill(),this.targetX!==c&&this.targetY!==c&&j.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b+d,c],[b+d,c+e],[b,c+e],[b,c]],f,g)},appendShape:function(a){return this.shapes[a.id]=a,this.shapeseq.push(a.id),this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var c,d=this.shapeseq;for(this.shapes[b.id]=b,c=d.length;c--;)d[c]==a&&(d[c]=b.id);delete this.shapes[a]},replaceWithShapes:function(a,b){var c,d,e,f=this.shapeseq,g={};for(d=a.length;d--;)g[a[d]]=!0;for(d=f.length;d--;)c=f[d],g[c]&&(f.splice(d,1),delete this.shapes[c],e=d);for(d=b.length;d--;)f.splice(e,0,b[d].id),this.shapes[b[d].id]=b[d]},insertAfterShape:function(a,b){var c,d=this.shapeseq;for(c=d.length;c--;)if(d[c]===a)return d.splice(c+1,0,b.id),void(this.shapes[b.id]=b)},removeShapeId:function(a){var b,c=this.shapeseq;for(b=c.length;b--;)if(c[b]===a){c.splice(b,1);break}delete this.shapes[a]},getShapeAt:function(a,b,c){return this.targetX=b,this.targetY=c,this.render(),this.currentTargetShapeId},render:function(){var a,b,c,d=this.shapeseq,e=this.shapes,f=d.length,g=this._getContext();for(g.clearRect(0,0,this.pixelWidth,this.pixelHeight),c=0;c<f;c++)a=d[c],b=e[a],this["_draw"+b.type].apply(this,b.args);this.interact||(this.shapes={},this.shapeseq=[])}}),H=f(F,{init:function(b,c,e){var f;H._super.init.call(this,b,c,e),e[0]&&(e=e[0]),d.data(e,"_jqs_vcanvas",this),this.canvas=a.createElement("span"),d(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:b,height:c,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,e),this._calculatePixelDims(b,c,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,f='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",f),this.group=d(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(a,b,d,e,f){var g,h,i,j,k,l,m=[];for(l=0,k=b.length;l<k;l++)m[l]=b[l][0]+","+b[l][1];return g=m.splice(0,1),f=f===c?1:f,h=d===c?' stroked="false" ':' strokeWeight="'+f+'px" strokeColor="'+d+'" ',i=e===c?' filled="false"':' fillColor="'+e+'" filled="true" ',j=m[0]===m[m.length-1]?"x ":"",'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+a+'" '+h+i+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+g+" l "+m.join(", ")+" "+j+'e"> </v:shape>'},_drawCircle:function(a,b,d,e,f,g,h){var i,j;return b-=e,d-=e,i=f===c?' stroked="false" ':' strokeWeight="'+h+'px" strokeColor="'+f+'" ',j=g===c?' filled="false"':' fillColor="'+g+'" filled="true" ','<v:oval  id="jqsshape'+a+'" '+i+j+' style="position:absolute;top:'+d+"px; left:"+b+"px; width:"+2*e+"px; height:"+2*e+'px"></v:oval>'},_drawPieSlice:function(a,d,e,f,g,h,i,j){var k,l,m,n,o,p,q;if(g===h)return"";if(h-g==2*b.PI&&(g=0,h=2*b.PI),l=d+b.round(b.cos(g)*f),m=e+b.round(b.sin(g)*f),n=d+b.round(b.cos(h)*f),o=e+b.round(b.sin(h)*f),l===n&&m===o){if(h-g<b.PI)return"";l=n=d+f,m=o=e}return l===n&&m===o&&h-g<b.PI?"":(k=[d-f,e-f,d+f,e+f,l,m,n,o],p=i===c?' stroked="false" ':' strokeWeight="1px" strokeColor="'+i+'" ',q=j===c?' filled="false"':' fillColor="'+j+'" filled="true" ','<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+a+'" '+p+q+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+d+","+e+" wa "+k.join(", ")+' x e"> </v:shape>')},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b,c+e],[b+d,c+e],[b+d,c],[b,c]],f,g)},reset:function(){this.group.innerHTML=""},appendShape:function(a){var b=this["_draw"+a.type].apply(this,a.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",b):this.prerender+=b,this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var c=d("#jqsshape"+a),e=this["_draw"+b.type].apply(this,b.args);c[0].outerHTML=e},replaceWithShapes:function(a,b){var c,e=d("#jqsshape"+a[0]),f="",g=b.length;for(c=0;c<g;c++)f+=this["_draw"+b[c].type].apply(this,b[c].args);for(e[0].outerHTML=f,c=1;c<a.length;c++)d("#jqsshape"+a[c]).remove()},insertAfterShape:function(a,b){var c=d("#jqsshape"+a),e=this["_draw"+b.type].apply(this,b.args);c[0].insertAdjacentHTML("afterEnd",e)},removeShapeId:function(a){var b=d("#jqsshape"+a);this.group.removeChild(b[0])},getShapeAt:function(a,b,c){return a.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})}(document,Math),JustGage=function(a){if(!a.id)return alert("Missing id parameter for gauge!"),!1;if(!document.getElementById(a.id))return alert('No element with id: "'+a.id+'" found!'),!1;this.config={id:a.id,value:a.value?a.value:0,valueFontColor:a.valueFontColor?a.valueFontColor:"#010101",min:a.min?a.min:0,max:a.max?a.max:100,showMinMax:null==a.showMinMax||a.showMinMax,gaugeWidthScale:a.gaugeWidthScale?a.gaugeWidthScale:1,gaugeColor:a.gaugeColor?a.gaugeColor:"#edebeb",label:a.label?a.label:"",showInnerShadow:null==a.showInnerShadow||a.showInnerShadow,shadowOpacity:a.shadowOpacity?a.shadowOpacity:.2,shadowSize:a.shadowSize?a.shadowSize:5,shadowVerticalOffset:a.shadowVerticalOffset?a.shadowVerticalOffset:3,levelColors:a.levelColors?a.levelColors:percentColors,levelColorsGradient:null==a.levelColorsGradient||a.levelColorsGradient,labelFontColor:a.labelFontColor?a.labelFontColor:"#b3b3b3",startAnimationTime:a.startAnimationTime?a.startAnimationTime:700,startAnimationType:a.startAnimationType?a.startAnimationType:">",refreshAnimationTime:a.refreshAnimationTime?a.refreshAnimationTime:700,refreshAnimationType:a.refreshAnimationType?a.refreshAnimationType:">"},a.value>this.config.max&&(this.config.value=this.config.max),a.value<this.config.min&&(this.config.value=this.config.min),this.originalValue=a.value,this.canvas=Raphael(this.config.id,"100%","100%");var b,c,d=1*getStyle(document.getElementById(this.config.id),"width").slice(0,-2),e=1*getStyle(document.getElementById(this.config.id),"height").slice(0,-2);d/e>1.25?(b=1.25*e,c=e):(b=d,c=d/1.25);var f=(d-b)/2,g=(e-c)/2,h=c/6.4>16?c/6.4:16,i=f+b/2,j=g+c/1.4,k=c/16>10?c/16:10,l=f+b/2,m=j+h/2+6,n=c/16>10?c/16:10,o=f+b/10+b/6.666666666666667*this.config.gaugeWidthScale/2,p=g+c/1.126760563380282,q=c/16>10?c/16:10,r=f+b-b/10-b/6.666666666666667*this.config.gaugeWidthScale/2,s=g+c/1.126760563380282;this.params={canvasW:d,canvasH:e,widgetW:b,widgetH:c,dx:f,dy:g,valueFontSize:h,valueX:i,valueY:j,labelFontSize:k,labelX:l,labelY:m,minFontSize:n,minX:o,minY:p,maxFontSize:q,maxX:r,maxY:s},this.canvas.customAttributes.pki=function(a,b,c,d,e,f,g,h){var i,j=(1-(a-b)/(c-b))*Math.PI,k=d/2-d/10,l=k-d/6.666666666666667*h,m=d/2+f,n=e/1.25+g,o=d/2+f+k*Math.cos(j),p=e-(e-n)+g-k*Math.sin(j),q=d/2+f+l*Math.cos(j),r=e-(e-n)+g-l*Math.sin(j);return i+="M"+(m-l)+","+n+" ",i+="L"+(m-k)+","+n+" ",i+="A"+k+","+k+" 0 0,1 "+o+","+p+" ",i+="L"+q+","+r+" ",i+="A"+l+","+l+" 0 0,0 "+(m-l)+","+n+" ",i+="z ",{path:i}},this.gauge=this.canvas.path().attr({stroke:"none",fill:this.config.gaugeColor,pki:[this.config.max,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]}),this.gauge.id=this.config.id+"-gauge",this.level=this.canvas.path().attr({stroke:"none",fill:getColorForPercentage((this.config.value-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient),pki:[this.config.min,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]}),this.level.id=this.config.id+"-level",this.txtValue=this.canvas.text(this.params.valueX,this.params.valueY,this.originalValue),this.txtValue.attr({"font-size":this.params.valueFontSize,"font-weight":"bold","font-family":"Arial",fill:this.config.valueFontColor,"fill-opacity":"0"}),this.txtValue.id=this.config.id+"-txtvalue",this.txtLabel=this.canvas.text(this.params.labelX,this.params.labelY,this.config.label),this.txtLabel.attr({"font-size":this.params.labelFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":"0"}),this.txtLabel.id=this.config.id+"-txtlabel",this.txtMin=this.canvas.text(this.params.minX,this.params.minY,this.config.min),this.txtMin.attr({"font-size":this.params.minFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":1==this.config.showMinMax?"1":"0"}),this.txtMin.id=this.config.id+"-txtmin",this.txtMax=this.canvas.text(this.params.maxX,this.params.maxY,this.config.max),this.txtMax.attr({"font-size":this.params.maxFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":1==this.config.showMinMax?"1":"0"}),this.txtMax.id=this.config.id+"-txtmax";var t=this.canvas.canvas.childNodes[1];ie<9?onCreateElementNsReady(function(){this.generateShadow()}):this.generateShadow("http://www.w3.org/2000/svg",t),this.level.animate({pki:[this.config.value,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]},this.config.startAnimationTime,this.config.startAnimationType),this.txtValue.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType),this.txtLabel.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType)},JustGage.prototype.refresh=function(a){originalVal=a,a>this.config.max&&(a=this.config.max),a<this.config.min&&(a=this.config.min);var b=getColorForPercentage((a-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient);this.canvas.getById(this.config.id+"-txtvalue").attr({text:originalVal}),this.canvas.getById(this.config.id+"-level").animate({pki:[a,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale],fill:b},this.config.refreshAnimationTime,this.config.refreshAnimationType)};var percentColors=["#a9d70b","#f9c802","#ff0000"];JustGage.prototype.generateShadow=function(a,b){var c=document.createElementNS(a,"filter");c.setAttribute("id",this.config.id+"-inner-shadow"),b.appendChild(c);var d=document.createElementNS(a,"feOffset");d.setAttribute("dx",0),d.setAttribute("dy",this.config.shadowVerticalOffset),c.appendChild(d);var e=document.createElementNS(a,"feGaussianBlur");e.setAttribute("result","offset-blur"),e.setAttribute("stdDeviation",this.config.shadowSize),c.appendChild(e);var f=document.createElementNS(a,"feComposite");f.setAttribute("operator","out"),f.setAttribute("in","SourceGraphic"),f.setAttribute("in2","offset-blur"),f.setAttribute("result","inverse"),c.appendChild(f);var g=document.createElementNS(a,"feFlood");g.setAttribute("flood-color","black"),g.setAttribute("flood-opacity",this.config.shadowOpacity),g.setAttribute("result","color"),c.appendChild(g);var h=document.createElementNS(a,"feComposite");h.setAttribute("operator","in"),h.setAttribute("in","color"),h.setAttribute("in2","inverse"),h.setAttribute("result","shadow"),c.appendChild(h);var i=document.createElementNS(a,"feComposite");i.setAttribute("operator","over"),i.setAttribute("in","shadow"),i.setAttribute("in2","SourceGraphic"),c.appendChild(i),1==this.config.showInnerShadow&&(this.canvas.canvas.childNodes[2].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)"),this.canvas.canvas.childNodes[3].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)"))};var getColorForPercentage=function(a,b,c){var d=b.length;if(1===d)return b[0];for(var e=c?1/(d-1):1/d,f=new Array,g=0;g<b.length;g++){var h=c?e*g:e*(g+1),i=parseInt(cutHex(b[g]).substring(0,2),16),j=parseInt(cutHex(b[g]).substring(2,4),16),k=parseInt(cutHex(b[g]).substring(4,6),16);f[g]={pct:h,color:{r:i,g:j,b:k}}}if(0==a)return"rgb("+[f[0].color.r,f[0].color.g,f[0].color.b].join(",")+")";for(var g=0;g<f.length;g++)if(a<=f[g].pct){if(1==c){var l=f[g-1],m=f[g],n=m.pct-l.pct,o=(a-l.pct)/n,p=1-o,q=o,r={r:Math.floor(l.color.r*p+m.color.r*q),g:Math.floor(l.color.g*p+m.color.g*q),b:Math.floor(l.color.b*p+m.color.b*q)};return"rgb("+[r.r,r.g,r.b].join(",")+")"}return"rgb("+[f[g].color.r,f[g].color.g,f[g].color.b].join(",")+")"}},ie=function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="\x3c!--[if gt IE "+ ++b+"]><i></i><![endif]--\x3e",d[0];);return b>4?b:a}();(function(a){var b,c,d="0.3.4",e="hasOwnProperty",f=/[\.\/]/,g="*",h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;b=a,c=0;for(var p=0,q=h.length;p<q;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;p<q;p++)if("zIndex"in(e=h[p]))if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do{if(j++,(e=m[l[j]])&&n.push(e.apply(d,g)),c)break}while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k.listeners=function(a){var b,c,d,e,h,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,h=m.length;e<h;e++){for(l=[],i=0,k=o.length;i<k;i++)for(n=o[i].n,c=[n[m[e]],n[g]],d=2;d--;)(b=c[d])&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},k.on=function(a,b){for(var c=a.split(f),d=j,e=0,g=c.length;e<g;e++)d=d.n,!d[c[e]]&&(d[c[e]]={n:{}}),d=d[c[e]];for(d.f=d.f||[],e=0,g=d.f.length;e<g;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.stop=function(){c=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},k.off=k.unbind=function(a,b){var c,d,h,i,k,l,m,n=a.split(f),o=[j];for(i=0,k=n.length;i<k;i++)for(l=0;l<o.length;l+=h.length-2){if(h=[l,1],c=o[l].n,n[i]!=g)c[n[i]]&&h.push(c[n[i]]);else for(d in c)c[e](d)&&h.push(c[d]);o.splice.apply(o,h)}for(i=0,k=o.length;i<k;i++)for(c=o[i];c.n;){if(b){if(c.f){for(l=0,m=c.f.length;l<m;l++)if(c.f[l]==b){c.f.splice(l,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){var p=c.n[d].f;for(l=0,m=p.length;l<m;l++)if(p[l]==b){p.splice(l,1);break}!p.length&&delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}},k.once=function(a,b){var c=function(){var d=b.apply(this,arguments);return k.unbind(a,c),d};return k.on(a,c)},k.version=d,k.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k})(this),function(){function a(a){for(var b=0;b<fb.length;b++)fb[b].el.paper==a&&fb.splice(b--,1)}function b(a,b,c,e,g,h){c=Z(c);var i,j,k,l,m,n,o=a.ms,p={},q={},s={};if(e)for(v=0,w=fb.length;v<w;v++){var t=fb[v];if(t.el.id==b.id&&t.anim==a){t.percent!=c?(fb.splice(v,1),k=1):j=t,b.attr(t.totalOrigin);break}}else e=+q;for(var v=0,w=a.percents.length;v<w;v++){if(a.percents[v]==c||a.percents[v]>e*a.top){c=a.percents[v],m=a.percents[v-1]||0,o=o/a.top*(c-m),l=a.percents[v+1],i=a.anim[c];break}e&&b.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=e,j.start=new Date-j.ms*e;else{for(var y in i)if(i[x](y)&&(ba[x](y)||b.paper.customAttributes[x](y)))switch(p[y]=b.attr(y),null==p[y]&&(p[y]=aa[y]),q[y]=i[y],ba[y]){case R:s[y]=(q[y]-p[y])/o;break;case"colour":p[y]=r.getRGB(p[y]);var z=r.getRGB(q[y]);s[y]={r:(z.r-p[y].r)/o,g:(z.g-p[y].g)/o,b:(z.b-p[y].b)/o};break;case"path":var A=Ia(p[y],q[y]),B=A[1];for(p[y]=A[0],s[y]=[],v=0,w=p[y].length;v<w;v++){s[y][v]=[0];for(var D=1,E=p[y][v].length;D<E;D++)s[y][v][D]=(B[v][D]-p[y][v][D])/o}break;case"transform":var F=b._,I=Na(F[y],q[y]);if(I)for(p[y]=I.from,q[y]=I.to,s[y]=[],s[y].real=!0,v=0,w=p[y].length;v<w;v++)for(s[y][v]=[p[y][v][0]],D=1,E=p[y][v].length;D<E;D++)s[y][v][D]=(q[y][v][D]-p[y][v][D])/o;else{var J=b.matrix||new f,K={_:{transform:F.transform},getBBox:function(){return b.getBBox(1)}};p[y]=[J.a,J.b,J.c,J.d,J.e,J.f],La(K,q[y]),q[y]=K._.transform,s[y]=[(K.matrix.a-J.a)/o,(K.matrix.b-J.b)/o,(K.matrix.c-J.c)/o,(K.matrix.d-J.d)/o,(K.matrix.e-J.e)/o,(K.matrix.f-J.f)/o]}break;case"csv":var L=G(i[y])[H](u),M=G(p[y])[H](u);if("clip-rect"==y)for(p[y]=M,s[y]=[],v=M.length;v--;)s[y][v]=(L[v]-p[y][v])/o;q[y]=L;break;default:for(L=[][C](i[y]),M=[][C](p[y]),s[y]=[],v=b.paper.customAttributes[y].length;v--;)s[y][v]=((L[v]||0)-(M[v]||0))/o}var N=i.easing,O=r.easing_formulas[N];if(!O)if((O=G(N).match(X))&&5==O.length){var P=O;O=function(a){return d(a,+P[1],+P[2],+P[3],+P[4],o)}}else O=la;if(n=i.start||a.start||+new Date,t={anim:a,percent:c,timestamp:n,start:n+(a.del||0),status:0,initstatus:e||0,stop:!1,ms:o,easing:O,from:p,diff:s,to:q,el:b,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:b.attr(),totalOrigin:g},fb.push(t),e&&!j&&!k&&(t.stop=!0,t.start=new Date-o*e,1==fb.length))return hb();k&&(t.start=new Date-t.ms*e),1==fb.length&&gb(hb)}eve("raphael.anim.start."+b.id,b,a)}}function c(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[x](e)&&(d[Z(e)]=a[e],c.push(Z(e)));c.sort(ja)}this.anim=d,this.top=c[c.length-1],this.percents=c}function d(a,b,c,d,e,f){function g(a,b){var c,d,e,f,g,h;for(e=a,h=0;h<8;h++){if(f=i(e)-a,O(f)<b)return e;if(g=(3*l*e+2*k)*e+j,O(g)<1e-6)break;e-=f/g}if(c=0,d=1,e=a,e<c)return c;if(e>d)return d;for(;c<d;){if(f=i(e),O(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}function h(a,b){var c=g(a,b);return((o*c+n)*c+m)*c}function i(a){return((l*a+k)*a+j)*a}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return h(a,1/(200*f))}function e(){return this.x+F+this.y+F+this.width+" � "+this.height}function f(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function g(a,b,c){a=r._path2curve(a),b=r._path2curve(b);for(var d,e,f,g,i,j,k,l,m,n,o=c?0:[],p=0,q=a.length;p<q;p++){var s=a[p];if("M"==s[0])d=i=s[1],e=j=s[2];else{"C"==s[0]?(m=[d,e].concat(s.slice(1)),d=m[6],e=m[7]):(m=[d,e,d,e,i,j,i,j],d=i,e=j);for(var t=0,u=b.length;t<u;t++){var v=b[t];if("M"==v[0])f=k=v[1],g=l=v[2];else{"C"==v[0]?(n=[f,g].concat(v.slice(1)),f=n[6],g=n[7]):(n=[f,g,f,g,k,l,k,l],f=k,g=l);var w=h(m,n,c);if(c)o+=w;else{for(var x=0,y=w.length;x<y;x++)w[x].segment1=p,w[x].segment2=t,w[x].bez1=m,w[x].bez2=n;o=o.concat(w)}}}}}return o}function h(a,b,c){var d=r.bezierBBox(a),e=r.bezierBBox(b);if(!r.isBBoxIntersect(d,e))return c?0:[];for(var f=k.apply(0,a),g=k.apply(0,b),h=~~(f/5),j=~~(g/5),l=[],m=[],n={},o=c?0:[],p=0;p<h+1;p++){var q=r.findDotsAtSegment.apply(r,a.concat(p/h));l.push({x:q.x,y:q.y,t:p/h})}for(p=0;p<j+1;p++)q=r.findDotsAtSegment.apply(r,b.concat(p/j)),m.push({x:q.x,y:q.y,t:p/j});for(p=0;p<h;p++)for(var s=0;s<j;s++){var t=l[p],u=l[p+1],v=m[s],w=m[s+1],x=O(u.x-t.x)<.001?"y":"x",y=O(w.x-v.x)<.001?"y":"x",z=i(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(n[z.x.toFixed(4)]==z.y.toFixed(4))continue;n[z.x.toFixed(4)]=z.y.toFixed(4);var A=t.t+O((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t),B=v.t+O((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&A<=1&&B>=0&&B<=1&&(c?o++:o.push({x:z.x,y:z.y,t1:A,t2:B}))}}return o}function i(a,b,c,d,e,f,g,h){if(!(M(a,c)<N(e,g)||N(a,c)>M(e,g)||M(b,d)<N(f,h)||N(b,d)>M(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(!k)return;var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(n<+N(a,c).toFixed(2)||n>+M(a,c).toFixed(2)||n<+N(e,g).toFixed(2)||n>+M(e,g).toFixed(2)||o<+N(b,d).toFixed(2)||o>+M(b,d).toFixed(2)||o<+N(f,h).toFixed(2)||o>+M(f,h).toFixed(2))return;return{x:l,y:m}}}function j(a,b,c,d,e,f,g,h,i){if(!(i<0||k(a,b,c,d,e,f,g,h)<i)){var j,l=1,m=l/2,n=l-m,o=.01;for(j=k(a,b,c,d,e,f,g,h,n);O(j-i)>o;)m/=2,n+=(j<i?1:-1)*m,j=k(a,b,c,d,e,f,g,h,n);return n}}function k(a,b,c,d,e,f,g,h,i){null==i&&(i=1),i=i>1?1:i<0?0:i;for(var j=i/2,k=12,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;p<k;p++){var q=j*m[p]+j,r=l(q,a,c,e,g),s=l(q,b,d,f,h),t=r*r+s*s;o+=n[p]*L.sqrt(t)}return j*o}function l(a,b,c,d,e){return a*(a*(-3*b+9*c-9*d+3*e)+6*b-12*c+6*d)-3*b+3*c}function m(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function n(){return this.hex}function o(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("?"),g=d.cache=d.cache||{},h=d.count=d.count||[];return g[x](f)?(p(h,f),c?c(g[f]):g[f]):(h.length>=1e3&&delete g[h.shift()],h.push(f),g[f]=a[B](b,e),c?c(g[f]):g[f])}return d}function p(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function q(a){if(Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[x](c)&&(b[c]=q(a[c]));return b}function r(a){if(r.is(a,"function"))return s?a():eve.on("raphael.DOMload",a);if(r.is(a,T))return r._engine.create[B](r,a.splice(0,3+r.is(a[0],R))).add(a);var b=Array.prototype.slice.call(arguments,0);if(r.is(b[b.length-1],"function")){var c=b.pop();return s?c.call(r._engine.create[B](r,b)):eve.on("raphael.DOMload",function(){c.call(r._engine.create[B](r,b))})}return r._engine.create[B](r,arguments)}r.version="2.1.0",r.eve=eve;var s,t,u=/[, ]+/,v={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},w=/\{(\d+)\}/g,x="hasOwnProperty",y={doc:document,win:window},z={was:Object.prototype[x].call(y.win,"Raphael"),is:y.win.Raphael},A=function(){this.ca=this.customAttributes={}},B="apply",C="concat",D="createTouch"in y.doc,E="",F=" ",G=String,H="split",I="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[H](F),J={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},K=G.prototype.toLowerCase,L=Math,M=L.max,N=L.min,O=L.abs,P=L.pow,Q=L.PI,R="number",S="string",T="array",U=Object.prototype.toString,V=(r._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),W={NaN:1,Infinity:1,"-Infinity":1},X=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Y=L.round,Z=parseFloat,$=parseInt,_=G.prototype.toUpperCase,aa=r._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ba=r._availableAnimAttrs={blur:R,"clip-rect":"csv",cx:R,cy:R,fill:"colour","fill-opacity":R,"font-size":R,height:R,opacity:R,path:"path",r:R,rx:R,ry:R,stroke:"colour","stroke-opacity":R,"stroke-width":R,transform:"transform",width:R,x:R,y:R},ca=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,da={hs:1,rg:1},ea=/,?([achlmqrstvxz]),?/gi,fa=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ga=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ha=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,ia=(r._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ja=function(a,b){return Z(a)-Z(b)},ka=function(){},la=function(a){return a},ma=r._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},na=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},oa=r._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return na(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return na(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ma(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ma(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ma(b.x,b.y,b.width,b.height)}},pa=r.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Ia(a),e=0,g=a.length;e<g;e++)for(i=a[e],f=1,h=i.length;f<h;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(r._g=y,r.type=y.win.SVGAngle||y.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==r.type){var qa,ra=y.doc.createElement("div");if(ra.innerHTML='<v:shape adj="1"/>',qa=ra.firstChild,qa.style.behavior="url(#default#VML)",!qa||"object"!=typeof qa.adj)return r.type=E;ra=null}r.svg=!(r.vml="VML"==r.type),r._Paper=A,r.fn=t=A.prototype=r.prototype,r._id=0,r._oid=0,r.is=function(a,b){return b=K.call(b),"finite"==b?!W[x](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||U.call(a).slice(8,-1).toLowerCase()==b},r.angle=function(a,b,c,d,e,f){if(null==e){var g=a-c,h=b-d;return g||h?(180+180*L.atan2(-h,-g)/Q+360)%360:0}return r.angle(a,b,e,f)-r.angle(c,d,e,f)},r.rad=function(a){return a%360*Q/180},r.deg=function(a){return 180*a/Q%360},r.snapTo=function(a,b,c){if(c=r.is(c,"finite")?c:10,r.is(a,T)){for(var d=a.length;d--;)if(O(a[d]-b)<=c)return a[d]}else{a=+a;var e=b%a;if(e<c)return b-e;if(e>a-c)return b-e+a}return b};r.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*L.random()|0;return("x"==a?b:3&b|8).toString(16)});r.setWindow=function(a){eve("raphael.setWindow",r,y.win,a),y.win=a,y.doc=y.win.document,r._engine.initWin&&r._engine.initWin(y.win)};var sa=function(a){if(r.vml){var b,c=/^\s+|\s+$/g;try{var d=new ActiveXObject("htmlfile");d.write("<body>"),d.close(),b=d.body}catch(a){b=createPopup().document.body}var e=b.createTextRange();sa=o(function(a){try{b.style.color=G(a).replace(c,E);var d=e.queryCommandValue("ForeColor");return d=(255&d)<<16|65280&d|(16711680&d)>>>16,"#"+("000000"+d.toString(16)).slice(-6)}catch(a){return"none"}})}else{var f=y.doc.createElement("i");f.title="Rapha�l Colour Picker",f.style.display="none",y.doc.body.appendChild(f),sa=o(function(a){return f.style.color=a,y.doc.defaultView.getComputedStyle(f,E).getPropertyValue("color")})}return sa(a)},ta=function(){return"hsb("+[this.h,this.s,this.b]+")"},ua=function(){return"hsl("+[this.h,this.s,this.l]+")"},va=function(){return this.hex},wa=function(a,b,c){if(null==b&&r.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(c=a.b,b=a.g,a=a.r),null==b&&r.is(a,S)){var d=r.getRGB(a);a=d.r,b=d.g,c=d.b}return(a>1||b>1||c>1)&&(a/=255,b/=255,c/=255),[a,b,c]},xa=function(a,b,c,d){a*=255,b*=255,c*=255;var e={r:a,g:b,b:c,hex:r.rgb(a,b,c),toString:va};return r.is(d,"finite")&&(e.opacity=d),e};r.color=function(a){var b;return r.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=r.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):r.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=r.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(r.is(a,"string")&&(a=r.getRGB(a)),r.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=r.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=r.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=va,a},r.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-O(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],xa(e,f,g,d)},r.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(c<.5?c:1-c),h=i*(1-O(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],xa(e,f,g,d)},r.rgb2hsb=function(a,b,c){c=wa(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=M(a,b,c),g=f-N(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:ta}},r.rgb2hsl=function(a,b,c){c=wa(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=M(a,b,c),h=N(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:f<.5?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:ua}},r._path2string=function(){return this.join(",").replace(ea,"$1")};r._preload=function(a,b){var c=y.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,y.doc.body.removeChild(this)},c.onerror=function(){y.doc.body.removeChild(this)},y.doc.body.appendChild(c),c.src=a};r.getRGB=o(function(a){if(!a||(a=G(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:n};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:n};!da[x](a.toLowerCase().substring(0,2))&&"#"!=a.charAt()&&(a=sa(a));var b,c,d,e,f,g,h=a.match(V);return h?(h[2]&&(d=$(h[2].substring(5),16),c=$(h[2].substring(3,5),16),b=$(h[2].substring(1,3),16)),h[3]&&(d=$((f=h[3].charAt(3))+f,16),c=$((f=h[3].charAt(2))+f,16),b=$((f=h[3].charAt(1))+f,16)),h[4]&&(g=h[4][H](ca),b=Z(g[0]),"%"==g[0].slice(-1)&&(b*=2.55),c=Z(g[1]),"%"==g[1].slice(-1)&&(c*=2.55),d=Z(g[2]),"%"==g[2].slice(-1)&&(d*=2.55),"rgba"==h[1].toLowerCase().slice(0,4)&&(e=Z(g[3])),g[3]&&"%"==g[3].slice(-1)&&(e/=100)),h[5]?(g=h[5][H](ca),b=Z(g[0]),"%"==g[0].slice(-1)&&(b*=2.55),c=Z(g[1]),"%"==g[1].slice(-1)&&(c*=2.55),d=Z(g[2]),"%"==g[2].slice(-1)&&(d*=2.55),("deg"==g[0].slice(-3)||"�"==g[0].slice(-1))&&(b/=360),"hsba"==h[1].toLowerCase().slice(0,4)&&(e=Z(g[3])),g[3]&&"%"==g[3].slice(-1)&&(e/=100),r.hsb2rgb(b,c,d,e)):h[6]?(g=h[6][H](ca),b=Z(g[0]),"%"==g[0].slice(-1)&&(b*=2.55),c=Z(g[1]),"%"==g[1].slice(-1)&&(c*=2.55),d=Z(g[2]),"%"==g[2].slice(-1)&&(d*=2.55),("deg"==g[0].slice(-3)||"�"==g[0].slice(-1))&&(b/=360),"hsla"==h[1].toLowerCase().slice(0,4)&&(e=Z(g[3])),g[3]&&"%"==g[3].slice(-1)&&(e/=100),r.hsl2rgb(b,c,d,e)):(h={r:b,g:c,b:d,toString:n},h.hex="#"+(16777216|d|c<<8|b<<16).toString(16).slice(1),r.is(e,"finite")&&(h.opacity=e),h)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:n}},r),r.hsb=o(function(a,b,c){return r.hsb2rgb(a,b,c).hex}),r.hsl=o(function(a,b,c){return r.hsl2rgb(a,b,c).hex}),r.rgb=o(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),r.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},r.getColor.reset=function(){delete this.start},r.parsePathString=function(a){if(!a)return null;var b=ya(a);if(b.arr)return Aa(b.arr);var c={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},d=[];return r.is(a,T)&&r.is(a[0],T)&&(d=Aa(a)),d.length||G(a).replace(fa,function(a,b,e){var f=[],g=b.toLowerCase();if(e.replace(ha,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(d.push([b][C](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)d.push([b][C](f));else for(;f.length>=c[g]&&(d.push([b][C](f.splice(0,c[g]))),c[g]););}),d.toString=r._path2string,b.arr=Aa(d),d},r.parseTransformString=o(function(a){if(!a)return null;var b=[];return r.is(a,T)&&r.is(a[0],T)&&(b=Aa(a)),b.length||G(a).replace(ga,function(a,c,d){var e=[];K.call(c);d.replace(ha,function(a,b){b&&e.push(+b)}),b.push([c][C](e))}),b.toString=r._path2string,b});var ya=function(a){var b=ya.ps=ya.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[x](c)&&c!=a&&!--b[c].sleep&&delete b[c]}),b[a]};r.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=P(j,3),l=P(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*L.atan2(q-s,r-t)/Q;return(q>s||r<t)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}},r.bezierBBox=function(a,b,c,d,e,f,g,h){r.is(a,"array")||(a=[a,b,c,d,e,f,g,h]);var i=Ha.apply(null,a);return{x:i.min.x,y:i.min.y,x2:i.max.x,y2:i.max.y,width:i.max.x-i.min.x,height:i.max.y-i.min.y}},r.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},r.isBBoxIntersect=function(a,b){var c=r.isPointInsideBBox;return c(b,a.x,a.y)||c(b,a.x2,a.y)||c(b,a.x,a.y2)||c(b,a.x2,a.y2)||c(a,b.x,b.y)||c(a,b.x2,b.y)||c(a,b.x,b.y2)||c(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},r.pathIntersection=function(a,b){return g(a,b)},r.pathIntersectionNumber=function(a,b){return g(a,b,1)},r.isPointInsidePath=function(a,b,c){var d=r.pathBBox(a);return r.isPointInsideBBox(d,b,c)&&g(a,[["M",b,c],["H",d.x2+10]],1)%2==1},r._removedFactory=function(a){return function(){eve("raphael.log",null,"Rapha�l: you are calling to method �"+a+"� of removed object",a)}};var za=r.pathBBox=function(a){var b=ya(a);if(b.bbox)return b.bbox;if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Ia(a);for(var c,d=0,e=0,f=[],g=[],h=0,i=a.length;h<i;h++)if(c=a[h],"M"==c[0])d=c[1],e=c[2],f.push(d),g.push(e);else{var j=Ha(d,e,c[1],c[2],c[3],c[4],c[5],c[6]);f=f[C](j.min.x,j.max.x),g=g[C](j.min.y,j.max.y),d=c[5],e=c[6]}var k=N[B](0,f),l=N[B](0,g),m=M[B](0,f),n=M[B](0,g),o={x:k,y:l,x2:m,y2:n,width:m-k,height:n-l};return b.bbox=q(o),o},Aa=function(a){var b=q(a);return b.toString=r._path2string,b},Ba=r._pathToRelative=function(a){var b=ya(a);if(b.rel)return Aa(b.rel);r.is(a,T)&&r.is(a&&a[0],T)||(a=r.parsePathString(a));var c=[],d=0,e=0,f=0,g=0,h=0;"M"==a[0][0]&&(d=a[0][1],e=a[0][2],f=d,g=e,h++,c.push(["M",d,e]));for(var i=h,j=a.length;i<j;i++){var k=c[i]=[],l=a[i];if(l[0]!=K.call(l[0]))switch(k[0]=K.call(l[0]),k[0]){case"a":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]-d).toFixed(3),k[7]=+(l[7]-e).toFixed(3);break;case"v":k[1]=+(l[1]-e).toFixed(3);break;case"m":f=l[1],g=l[2];default:for(var m=1,n=l.length;m<n;m++)k[m]=+(l[m]-(m%2?d:e)).toFixed(3)}else{k=c[i]=[],"m"==l[0]&&(f=l[1]+d,g=l[2]+e);for(var o=0,p=l.length;o<p;o++)c[i][o]=l[o]}var q=c[i].length;switch(c[i][0]){case"z":d=f,e=g;break;case"h":d+=+c[i][q-1];break;case"v":e+=+c[i][q-1];break;default:d+=+c[i][q-2],e+=+c[i][q-1]}}return c.toString=r._path2string,b.rel=Aa(c),c},Ca=r._pathToAbsolute=function(a){var b=ya(a);if(b.abs)return Aa(b.abs);if(r.is(a,T)&&r.is(a&&a[0],T)||(a=r.parsePathString(a)),!a||!a.length)return[["M",0,0]];var c=[],d=0,e=0,f=0,g=0,h=0;"M"==a[0][0]&&(d=+a[0][1],e=+a[0][2],f=d,g=e,h++,c[0]=["M",d,e]);for(var i,j,k=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),l=h,n=a.length;l<n;l++){if(c.push(i=[]),j=a[l],j[0]!=_.call(j[0]))switch(i[0]=_.call(j[0]),i[0]){case"A":i[1]=j[1],i[2]=j[2],i[3]=j[3],i[4]=j[4],i[5]=j[5],i[6]=+(j[6]+d),i[7]=+(j[7]+e);break;case"V":i[1]=+j[1]+e;break;case"H":i[1]=+j[1]+d;break;case"R":for(var o=[d,e][C](j.slice(1)),p=2,q=o.length;p<q;p++)o[p]=+o[p]+d,o[++p]=+o[p]+e;c.pop(),c=c[C](m(o,k));break;case"M":f=+j[1]+d,g=+j[2]+e;default:for(p=1,q=j.length;p<q;p++)i[p]=+j[p]+(p%2?d:e)}else if("R"==j[0])o=[d,e][C](j.slice(1)),c.pop(),c=c[C](m(o,k)),i=["R"][C](j.slice(-2));else for(var s=0,t=j.length;s<t;s++)i[s]=j[s];switch(i[0]){case"Z":d=f,e=g;break;case"H":d=i[1];break;case"V":e=i[1];break;case"M":f=i[i.length-2],g=i[i.length-1];default:d=i[i.length-2],e=i[i.length-1]}}return c.toString=r._path2string,b.abs=Aa(c),c},Da=function(a,b,c,d){return[a,b,c,d,c,d]},Ea=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Fa=function(a,b,c,d,e,f,g,h,i,j){var k,l=120*Q/180,m=Q/180*(+e||0),n=[],p=o(function(a,b,c){return{x:a*L.cos(c)-b*L.sin(c),y:a*L.sin(c)+b*L.cos(c)}});if(j)y=j[0],z=j[1],w=j[2],x=j[3];else{k=p(a,b,-m),a=k.x,b=k.y,k=p(h,i,-m),h=k.x,i=k.y;var q=(L.cos(Q/180*e),L.sin(Q/180*e),(a-h)/2),r=(b-i)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=L.sqrt(s),c*=s,d*=s);var t=c*c,u=d*d,v=(f==g?-1:1)*L.sqrt(O((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+h)/2,x=v*-d*q/c+(b+i)/2,y=L.asin(((b-x)/d).toFixed(9)),z=L.asin(((i-x)/d).toFixed(9));y=a<w?Q-y:y,z=h<w?Q-z:z,y<0&&(y=2*Q+y),z<0&&(z=2*Q+z),g&&y>z&&(y-=2*Q),!g&&z>y&&(z-=2*Q)}var A=z-y;if(O(A)>l){var B=z,D=h,E=i;z=y+l*(g&&z>y?1:-1),h=w+c*L.cos(z),i=x+d*L.sin(z),n=Fa(h,i,c,d,e,0,g,D,E,[z,B,w,x])}A=z-y;var F=L.cos(y),G=L.sin(y),I=L.cos(z),J=L.sin(z),K=L.tan(A/4),M=4/3*c*K,N=4/3*d*K,P=[a,b],R=[a+M*G,b-N*F],S=[h+M*J,i-N*I],T=[h,i];if(R[0]=2*P[0]-R[0],R[1]=2*P[1]-R[1],j)return[R,S,T][C](n);n=[R,S,T][C](n).join()[H](",");for(var U=[],V=0,W=n.length;V<W;V++)U[V]=V%2?p(n[V-1],n[V],m).y:p(n[V],n[V+1],m).x;return U},Ga=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:P(j,3)*a+3*P(j,2)*i*c+3*j*i*i*e+P(i,3)*g,y:P(j,3)*b+3*P(j,2)*i*d+3*j*i*i*f+P(i,3)*h}},Ha=o(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+L.sqrt(k*k-4*j*l))/2/j,n=(-k-L.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return O(m)>"1e12"&&(m=.5),O(n)>"1e12"&&(n=.5),m>0&&m<1&&(i=Ga(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&n<1&&(i=Ga(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+L.sqrt(k*k-4*j*l))/2/j,n=(-k-L.sqrt(k*k-4*j*l))/2/j,O(m)>"1e12"&&(m=.5),O(n)>"1e12"&&(n=.5),m>0&&m<1&&(i=Ga(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&n<1&&(i=Ga(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:N[B](0,p),y:N[B](0,o)},max:{x:M[B](0,p),y:M[B](0,o)}}}),Ia=r._path2curve=o(function(a,b){var c=!b&&ya(a);if(!b&&c.curve)return Aa(c.curve);for(var d=Ca(a),e=b&&Ca(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][C](Fa[B](0,[b.x,b.y][C](a.slice(1))));break;case"S":c=b.x+(b.x-(b.bx||b.x)),d=b.y+(b.y-(b.by||b.y)),a=["C",c,d][C](a.slice(1));break;case"T":b.qx=b.x+(b.x-(b.qx||b.x)),b.qy=b.y+(b.y-(b.qy||b.y)),a=["C"][C](Ea(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][C](Ea(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][C](Da(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][C](Da(b.x,b.y,a[1],b.y));break;case"V":a=["C"][C](Da(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][C](Da(b.x,b.y,b.X,b.Y))}return a}),i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][C](c.splice(0,6)));a.splice(b,1),l=M(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=M(d.length,e&&e.length||0))},k=0,l=M(d.length,e&&e.length||0);k<l;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=Z(m[o-4])||f.x,f.by=Z(m[o-3])||f.y,g.bx=e&&(Z(n[p-4])||g.x),g.by=e&&(Z(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=Aa(d)),e?[d,e]:d},null,Aa),Ja=(r._parseDots=o(function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e={},f=a[c].match(/^([^:]*):?([\d\.]*)/);if(e.color=r.getRGB(f[1]),e.color.error)return null;e.color=e.color.hex,f[2]&&(e.offset=f[2]+"%"),b.push(e)}for(c=1,d=b.length-1;c<d;c++)if(!b[c].offset){for(var g=Z(b[c-1].offset||0),h=0,i=c+1;i<d;i++)if(b[i].offset){h=b[i].offset;break}h||(h=100,i=d),h=Z(h);for(var j=(h-g)/(i-c+1);c<i;c++)g+=j,b[c].offset=g+"%"}return b}),r._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),Ka=(r._tofront=function(a,b){b.top!==a&&(Ja(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},r._toback=function(a,b){b.bottom!==a&&(Ja(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},r._insertafter=function(a,b,c){Ja(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},r._insertbefore=function(a,b,c){Ja(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},r.toMatrix=function(a,b){var c=za(a),d={_:{transform:E},getBBox:function(){return c}};return La(d,b),d.matrix}),La=(r.transformPath=function(a,b){return pa(a,Ka(a,b))},r._extractTransform=function(a,b){if(null==b)return a._.transform;b=G(b).replace(/\.{3}|\u2026/g,a._.transform||E);var c=r.parseTransformString(b),d=0,e=0,g=0,h=1,i=1,j=a._,k=new f;if(j.transform=c||[],c)for(var l=0,m=c.length;l<m;l++){var n,o,p,q,s,t=c[l],u=t.length,v=G(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),o=x.y(0,0),p=x.x(t[1],t[2]),q=x.y(t[1],t[2]),k.translate(p-n,q-o)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),d+=t[1]):4==u&&(w?(p=x.x(t[2],t[3]),q=x.y(t[2],t[3]),k.rotate(t[1],p,q)):k.rotate(t[1],t[2],t[3]),d+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(p=x.x(t[3],t[4]),q=x.y(t[3],t[4]),k.scale(t[1],t[2],p,q)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=d,j.dx=e=k.e,j.dy=g=k.f,1==h&&1==i&&!d&&j.bbox?(j.bbox.x+=+e,j.bbox.y+=+g):j.dirtyT=1}),Ma=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Na=r._equaliseTransform=function(a,b){b=G(b).replace(/\.{3}|\u2026/g,a),a=r.parseTransformString(a)||[],b=r.parseTransformString(b)||[];for(var c,d,e,f,g=M(a.length,b.length),h=[],i=[],j=0;j<g;j++){if(e=a[j]||Ma(b[j]),f=b[j]||Ma(e),e[0]!=f[0]||"r"==e[0].toLowerCase()&&(e[2]!=f[2]||e[3]!=f[3])||"s"==e[0].toLowerCase()&&(e[3]!=f[3]||e[4]!=f[4]))return;for(h[j]=[],i[j]=[],c=0,d=M(e.length,f.length);c<d;c++)c in e&&(h[j][c]=e[c]),c in f&&(i[j][c]=f[c])}return{from:h,to:i}};r._getContainer=function(a,b,c,d){var e;if(null!=(e=null!=d||r.is(a,"object")?a:y.doc.getElementById(a)))return e.tagName?null==b?{container:e,width:e.style.pixelWidth||e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:b,height:c}:{container:1,x:a,y:b,width:c,height:d}},r.pathToRelative=Ba,r._engine={},r.path2curve=Ia,r.matrix=function(a,b,c,d,e,g){return new f(a,b,c,d,e,g)},function(a){function b(a){var b=L.sqrt(c(a));a[0]&&(a[0]/=b),a[1]&&(a[1]/=b)}function c(a){return a[0]*a[0]+a[1]*a[1]}a.add=function(a,b,c,d,e,g){var h,i,j,k,l=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],n=[[a,c,e],[b,d,g],[0,0,1]];for(a&&a instanceof f&&(n=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),h=0;h<3;h++)for(i=0;i<3;i++){for(k=0,j=0;j<3;j++)k+=m[h][j]*n[j][i];l[h][i]=k}this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new f(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,c){a=r.rad(a),b=b||0,c=c||0;var d=+L.cos(a).toFixed(9),e=+L.sin(a).toFixed(9);this.add(d,e,-e,d,b,c),this.add(1,0,0,1,-b,-c)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[G.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return r.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var d=[[this.a,this.c],[this.b,this.d]];a.scalex=L.sqrt(c(d[0])),b(d[0]),a.shear=d[0][0]*d[1][0]+d[0][1]*d[1][1],d[1]=[d[1][0]-d[0][0]*a.shear,d[1][1]-d[0][1]*a.shear],a.scaley=L.sqrt(c(d[1])),b(d[1]),a.shear/=a.scaley;var e=-d[0][1],f=d[1][1];return f<0?(a.rotate=r.deg(L.acos(f)),e<0&&(a.rotate=360-a.rotate)):a.rotate=r.deg(L.asin(e)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[H]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:E)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:E)+(b.rotate?"r"+[b.rotate,0,0]:E)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(f.prototype);var Oa=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Oa&&Oa[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Oa&&Oa[1]<8?t.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:t.safari=ka;for(var Pa=function(){this.returnValue=!1},Qa=function(){return this.originalEvent.preventDefault()},Ra=function(){this.cancelBubble=!0},Sa=function(){return this.originalEvent.stopPropagation()},Ta=function(){return y.doc.addEventListener?function(a,b,c,d){var e=D&&J[b]?J[b]:b,f=function(e){var f=y.doc.documentElement.scrollTop||y.doc.body.scrollTop,g=y.doc.documentElement.scrollLeft||y.doc.body.scrollLeft,h=e.clientX+g,i=e.clientY+f;if(D&&J[x](b))for(var j=0,k=e.targetTouches&&e.targetTouches.length;j<k;j++)if(e.targetTouches[j].target==a){var l=e;e=e.targetTouches[j],e.originalEvent=l,e.preventDefault=Qa,e.stopPropagation=Sa;break}return c.call(d,e,h,i)};return a.addEventListener(e,f,!1),function(){return a.removeEventListener(e,f,!1),!0}}:y.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||y.win.event;var b=y.doc.documentElement.scrollTop||y.doc.body.scrollTop,e=y.doc.documentElement.scrollLeft||y.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Pa,a.stopPropagation=a.stopPropagation||Ra,c.call(d,a,f,g)};return a.attachEvent("on"+b,e),function(){return a.detachEvent("on"+b,e),!0}}:void 0}(),Ua=[],Va=function(a){for(var b,c=a.clientX,d=a.clientY,e=y.doc.documentElement.scrollTop||y.doc.body.scrollTop,f=y.doc.documentElement.scrollLeft||y.doc.body.scrollLeft,g=Ua.length;g--;){if(b=Ua[g],D){for(var h,i=a.touches.length;i--;)if(h=a.touches[i],h.identifier==b.el._drag.id){c=h.clientX,d=h.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var j,k=b.el.node,l=k.nextSibling,m=k.parentNode,n=k.style.display;y.win.opera&&m.removeChild(k),k.style.display="none",j=b.el.paper.getElementByPoint(c,d),k.style.display=n,y.win.opera&&(l?m.insertBefore(k,l):m.appendChild(k)),j&&eve("raphael.drag.over."+b.el.id,b.el,j),c+=f,d+=e,eve("raphael.drag.move."+b.el.id,b.move_scope||b.el,c-b.el._drag.x,d-b.el._drag.y,c,d,a)}},Wa=function(a){r.unmousemove(Va).unmouseup(Wa);for(var b,c=Ua.length;c--;)b=Ua[c],b.el._drag={},eve("raphael.drag.end."+b.el.id,b.end_scope||b.start_scope||b.move_scope||b.el,a);Ua=[]},Xa=r.el={},Ya=I.length;Ya--;)!function(a){r[a]=Xa[a]=function(b,c){return r.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Ta(this.shape||this.node||y.doc,a,b,c||this)})),this},r["un"+a]=Xa["un"+a]=function(b){for(var c=this.events||[],d=c.length;d--;)if(c[d].name==a&&c[d].f==b)return c[d].unbind(),c.splice(d,1),!c.length&&delete this.events,this;return this}}(I[Ya]);Xa.data=function(a,b){var c=ia[this.id]=ia[this.id]||{};if(1==arguments.length){if(r.is(a,"object")){for(var d in a)a[x](d)&&this.data(d,a[d]);return this}return eve("raphael.data.get."+this.id,this,c[a],a),c[a]}return c[a]=b,eve("raphael.data.set."+this.id,this,b,a),this},Xa.removeData=function(a){return null==a?ia[this.id]={}:ia[this.id]&&delete ia[this.id][a],this},Xa.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},Xa.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var Za=[];Xa.drag=function(a,b,c,d,e,f){function g(g){(g.originalEvent||g).preventDefault();var h=y.doc.documentElement.scrollTop||y.doc.body.scrollTop,i=y.doc.documentElement.scrollLeft||y.doc.body.scrollLeft;this._drag.x=g.clientX+i,this._drag.y=g.clientY+h,this._drag.id=g.identifier,!Ua.length&&r.mousemove(Va).mouseup(Wa),Ua.push({el:this,move_scope:d,start_scope:e,end_scope:f}),b&&eve.on("raphael.drag.start."+this.id,b),a&&eve.on("raphael.drag.move."+this.id,a),c&&eve.on("raphael.drag.end."+this.id,c),eve("raphael.drag.start."+this.id,e||d||this,g.clientX+i,g.clientY+h,g)}return this._drag={},Za.push({el:this,start:g}),this.mousedown(g),this},Xa.onDragOver=function(a){a?eve.on("raphael.drag.over."+this.id,a):eve.unbind("raphael.drag.over."+this.id)},Xa.undrag=function(){for(var a=Za.length;a--;)Za[a].el==this&&(this.unmousedown(Za[a].start),Za.splice(a,1),eve.unbind("raphael.drag.*."+this.id));!Za.length&&r.unmousemove(Va).unmouseup(Wa)},t.circle=function(a,b,c){var d=r._engine.circle(this,a||0,b||0,c||0);return this.__set__&&this.__set__.push(d),d},t.rect=function(a,b,c,d,e){var f=r._engine.rect(this,a||0,b||0,c||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},t.ellipse=function(a,b,c,d){var e=r._engine.ellipse(this,a||0,b||0,c||0,d||0);return this.__set__&&this.__set__.push(e),e},t.path=function(a){a&&!r.is(a,S)&&!r.is(a[0],T)&&(a+=E);var b=r._engine.path(r.format[B](r,arguments),this);return this.__set__&&this.__set__.push(b),b},t.image=function(a,b,c,d,e){var f=r._engine.image(this,a||"about:blank",b||0,c||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},t.text=function(a,b,c){var d=r._engine.text(this,a||0,b||0,G(c));return this.__set__&&this.__set__.push(d),d},t.set=function(a){!r.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new jb(a);return this.__set__&&this.__set__.push(b),b},t.setStart=function(a){this.__set__=a||this.set()},t.setFinish=function(a){var b=this.__set__;return delete this.__set__,b},t.setSize=function(a,b){return r._engine.setSize.call(this,a,b)},t.setViewBox=function(a,b,c,d,e){return r._engine.setViewBox.call(this,a,b,c,d,e)},t.top=t.bottom=null,t.raphael=r;var $a=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0;return{y:b.top+(y.win.pageYOffset||e.scrollTop||d.scrollTop)-f,x:b.left+(y.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g}};t.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=y.doc.elementFromPoint(a,b);if(y.win.opera&&"svg"==e.tagName){var f=$a(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},t.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},t.forEach=function(a,b){for(var c=this.bottom;c;){if(!1===a.call(b,c))return this;c=c.next}return this},t.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},Xa.isPointInside=function(a,b){var c=this.realPath=this.realPath||oa[this.type](this);return r.isPointInsidePath(c,a,b)},Xa.getBBox=function(a){if(this.removed)return{};var b=this._;return a?(!b.dirty&&b.bboxwt||(this.realPath=oa[this.type](this),b.bboxwt=za(this.realPath),b.bboxwt.toString=e,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&(!b.dirty&&this.realPath||(b.bboxwt=0,this.realPath=oa[this.type](this)),b.bbox=za(pa(this.realPath,this.matrix)),b.bbox.toString=e,b.dirty=b.dirtyT=0),b.bbox)},Xa.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},Xa.glow=function(a){if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||oa[this.type](this);f=this.matrix?pa(f,this.matrix):f;for(var g=1;g<c+1;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var _a=function(a,b,c,d,e,f,g,h,i){return null==i?k(a,b,c,d,e,f,g,h):r.findDotsAtSegment(a,b,c,d,e,f,g,h,j(a,b,c,d,e,f,g,h,i))},ab=function(a,b){return function(c,d,e){c=Ia(c);for(var f,g,h,i,j,k="",l={},m=0,n=0,o=c.length;n<o;n++){if(h=c[n],"M"==h[0])f=+h[1],g=+h[2];else{if(i=_a(f,g,h[1],h[2],h[3],h[4],h[5],h[6]),m+i>d){if(b&&!l.start){if(j=_a(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-m),k+=["C"+j.start.x,j.start.y,j.m.x,j.m.y,j.x,j.y],e)return k;l.start=k,k=["M"+j.x,j.y+"C"+j.n.x,j.n.y,j.end.x,j.end.y,h[5],h[6]].join(),m+=i,f=+h[5],g=+h[6];continue}if(!a&&!b)return j=_a(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-m),{x:j.x,y:j.y,alpha:j.alpha}}m+=i,f=+h[5],g=+h[6]}k+=h.shift()+h}return l.end=k,j=a?m:b?l:r.findDotsAtSegment(f,g,h[0],h[1],h[2],h[3],h[4],h[5],1),j.alpha&&(j={x:j.x,y:j.y,alpha:j.alpha}),j}},bb=ab(1),cb=ab(),db=ab(0,1);r.getTotalLength=bb,r.getPointAtLength=cb,r.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return db(a,b).end;var d=db(a,c,1);return b?db(d,b).end:d},Xa.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():bb(this.attrs.path)},Xa.getPointAtLength=function(a){if("path"==this.type)return cb(this.attrs.path,a)},Xa.getSubpath=function(a,b){if("path"==this.type)return r.getSubpath(this.attrs.path,a,b)};var eb=r.easing_formulas={linear:function(a){return a},"<":function(a){return P(a,1.7)},">":function(a){return P(a,.48)},"<>":function(a){var b=.48-a/1.04,c=L.sqrt(.1734+b*b),d=c-b,e=P(O(d),1/3)*(d<0?-1:1),f=-c-b,g=P(O(f),1/3)*(f<0?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:P(2,-10*a)*L.sin(2*(a-.075)*Q/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return a<1/d?b=c*a*a:a<2/d?(a-=1.5/d,b=c*a*a+.75):a<2.5/d?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};eb.easeIn=eb["ease-in"]=eb["<"],eb.easeOut=eb["ease-out"]=eb[">"],eb.easeInOut=eb["ease-in-out"]=eb["<>"],eb["back-in"]=eb.backIn,eb["back-out"]=eb.backOut;var fb=[],gb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,16)},hb=function(){for(var a=+new Date,c=0;c<fb.length;c++){var d=fb[c];if(!d.el.removed&&!d.paused){var e,f,g=a-d.start,h=d.ms,i=d.easing,j=d.from,k=d.diff,l=d.to,m=(d.t,d.el),n={},o={};if(d.initstatus?(g=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*h,d.status=d.initstatus,delete d.initstatus,d.stop&&fb.splice(c--,1)):d.status=(d.prev+(d.percent-d.prev)*(g/h))/d.anim.top,!(g<0))if(g<h){var p=i(g/h);for(var q in j)if(j[x](q)){switch(ba[q]){case R:e=+j[q]+p*h*k[q];break;case"colour":e="rgb("+[ib(Y(j[q].r+p*h*k[q].r)),ib(Y(j[q].g+p*h*k[q].g)),ib(Y(j[q].b+p*h*k[q].b))].join(",")+")";break;case"path":e=[];for(var s=0,t=j[q].length;s<t;s++){e[s]=[j[q][s][0]];for(var u=1,v=j[q][s].length;u<v;u++)e[s][u]=+j[q][s][u]+p*h*k[q][s][u];e[s]=e[s].join(F)}e=e.join(F);break;case"transform":if(k[q].real)for(e=[],s=0,t=j[q].length;s<t;s++)for(e[s]=[j[q][s][0]],u=1,v=j[q][s].length;u<v;u++)e[s][u]=j[q][s][u]+p*h*k[q][s][u];else{var w=function(a){return+j[q][a]+p*h*k[q][a]};e=[["m",w(0),w(1),w(2),w(3),w(4),w(5)]]}break;case"csv":if("clip-rect"==q)for(e=[],s=4;s--;)e[s]=+j[q][s]+p*h*k[q][s];break;default:var y=[][C](j[q]);for(e=[],s=m.paper.customAttributes[q].length;s--;)e[s]=+y[s]+p*h*k[q][s]}n[q]=e}m.attr(n),function(a,b,c){setTimeout(function(){eve("raphael.anim.frame."+a,b,c)})}(m.id,m,d.anim)}else{if(function(a,b,c){setTimeout(function(){eve("raphael.anim.frame."+b.id,b,c),eve("raphael.anim.finish."+b.id,b,c),r.is(a,"function")&&a.call(b)})}(d.callback,m,d.anim),m.attr(l),fb.splice(c--,1),d.repeat>1&&!d.next){for(f in l)l[x](f)&&(o[f]=d.totalOrigin[f]);d.el.attr(o),b(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&b(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}r.svg&&m&&m.paper&&m.paper.safari(),fb.length&&gb(hb)},ib=function(a){return a>255?255:a<0?0:a};Xa.animateWith=function(a,d,e,f,g,h){var i=this;if(i.removed)return h&&h.call(i),i;var j=e instanceof c?e:r.animation(e,f,g,h);b(j,i,j.percents[0],null,i.attr());for(var k=0,l=fb.length;k<l;k++)if(fb[k].anim==d&&fb[k].el==a){fb[l-1].start=fb[k].start;break}return i},Xa.onAnimation=function(a){return a?eve.on("raphael.anim.frame."+this.id,a):eve.unbind("raphael.anim.frame."+this.id),this},c.prototype.delay=function(a){var b=new c(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},c.prototype.repeat=function(a){var b=new c(this.anim,this.ms);return b.del=this.del,b.times=L.floor(M(a,0))||1,b},r.animation=function(a,b,d,e){if(a instanceof c)return a;!r.is(d,"function")&&d||(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[x](g)&&Z(g)!=g&&Z(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new c({100:h},b)):new c(a,b)},Xa.animate=function(a,d,e,f){var g=this;if(g.removed)return f&&f.call(g),g;var h=a instanceof c?a:r.animation(a,d,e,f);return b(h,g,h.percents[0],null,g.attr()),g},Xa.setTime=function(a,b){return a&&null!=b&&this.status(a,N(b,a.ms)/a.ms),this},Xa.status=function(a,c){var d,e,f=[],g=0;if(null!=c)return b(a,this,-1,N(c,1)),this;for(d=fb.length;g<d;g++)if(e=fb[g],e.el.id==this.id&&(!a||e.anim==a)){if(a)return e.status;f.push({anim:e.anim,status:e.status})}return a?0:f},Xa.pause=function(a){for(var b=0;b<fb.length;b++)fb[b].el.id==this.id&&(!a||fb[b].anim==a)&&!1!==eve("raphael.anim.pause."+this.id,this,fb[b].anim)&&(fb[b].paused=!0);return this},Xa.resume=function(a){for(var b=0;b<fb.length;b++)if(fb[b].el.id==this.id&&(!a||fb[b].anim==a)){var c=fb[b];!1!==eve("raphael.anim.resume."+this.id,this,c.anim)&&(delete c.paused,this.status(c.anim,c.status))}return this},Xa.stop=function(a){for(var b=0;b<fb.length;b++)fb[b].el.id==this.id&&(!a||fb[b].anim==a)&&!1!==eve("raphael.anim.stop."+this.id,this,fb[b].anim)&&fb.splice(b--,1);return this},eve.on("raphael.remove",a),eve.on("raphael.clear",a),Xa.toString=function(){return"Rapha�l�s object"};var jb=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].constructor==Xa.constructor||a[b].constructor==jb)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},kb=jb.prototype;kb.push=function(){for(var a,b,c=0,d=arguments.length;c<d;c++)(a=arguments[c])&&(a.constructor==Xa.constructor||a.constructor==jb)&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},kb.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},kb.forEach=function(a,b){for(var c=0,d=this.items.length;c<d;c++)if(!1===a.call(b,this.items[c],c))return this;return this};for(var lb in Xa)Xa[x](lb)&&(kb[lb]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][B](c,b)})}}(lb));kb.attr=function(a,b){if(a&&r.is(a,T)&&r.is(a[0],"object"))for(var c=0,d=a.length;c<d;c++)this.items[c].attr(a[c]);else for(var e=0,f=this.items.length;e<f;e++)this.items[e].attr(a,b);return this},kb.clear=function(){for(;this.length;)this.pop()},kb.splice=function(a,b,c){a=a<0?M(this.length+a,0):a,b=M(0,N(this.length-a,b));var d,e=[],f=[],g=[];for(d=2;d<arguments.length;d++)g.push(arguments[d]);for(d=0;d<b;d++)f.push(this[a+d]);for(;d<this.length-a;d++)e.push(this[a+d]);var h=g.length;for(d=0;d<h+e.length;d++)this.items[a+d]=this[a+d]=d<h?g[d]:e[d-h];for(d=this.items.length=this.length-=b-h;this[d];)delete this[d++];return new jb(f)},kb.exclude=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return this.splice(b,1),!0},kb.animate=function(a,b,c,d){(r.is(c,"function")||!c)&&(d=c||null);var e,f,g=this.items.length,h=g,i=this;if(!g)return this;d&&(f=function(){!--g&&d.call(i)}),c=r.is(c,S)?c:f;var j=r.animation(a,b,c,f);for(e=this.items[--h].animate(j);h--;)this.items[h]&&!this.items[h].removed&&this.items[h].animateWith(e,j,j);return this},kb.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},kb.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=N[B](0,a),b=N[B](0,b),c=M[B](0,c),d=M[B](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},kb.clone=function(a){a=new jb;for(var b=0,c=this.items.length;b<c;b++)a.push(this.items[b].clone());return a},kb.toString=function(){return"Rapha�l�s set"},r.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[x](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=$(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[x](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[x](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},t.getFont=function(a,b,c,d){if(d=d||"normal",c=c||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,r.fonts){var e=r.fonts[a];if(!e){var f=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var g in r.fonts)if(r.fonts[x](g)&&f.test(g)){e=r.fonts[g];break}}var h;if(e)for(var i=0,j=e.length;i<j&&(h=e[i],h.face["font-weight"]!=b||h.face["font-style"]!=c&&h.face["font-style"]||h.face["font-stretch"]!=d);i++);return h}},t.print=function(a,b,c,d,e,f,g){f=f||"middle",g=M(N(g||0,1),-1);var h,i=G(c)[H](E),j=0,k=0,l=E;if(r.is(d,c)&&(d=this.getFont(d)),d){h=(e||16)/d.face["units-per-em"];for(var m=d.face.bbox[H](u),n=+m[0],o=m[3]-m[1],p=0,q=+m[1]+("baseline"==f?o+ +d.face.descent:o/2),s=0,t=i.length;s<t;s++){if("\n"==i[s])j=0,w=0,k=0,p+=o;else{var v=k&&d.glyphs[i[s-1]]||{},w=d.glyphs[i[s]];j+=k?(v.w||d.w)+(v.k&&v.k[i[s]]||0)+d.w*g:0,k=1}w&&w.d&&(l+=r.transformPath(w.d,["t",j*h,p*h,"s",h,h,n,q,"t",(a-n)/h,(b-q)/h]))}}return this.path(l).attr({fill:"#000",stroke:"none"})},t.add=function(a){if(r.is(a,"array"))for(var b,c=this.set(),d=0,e=a.length;d<e;d++)b=a[d]||{},v[x](b.type)&&c.push(this[b.type]().attr(b));return c},r.format=function(a,b){var c=r.is(b,T)?[0][C](b):arguments;return a&&r.is(a,S)&&c.length-1&&(a=a.replace(w,function(a,b){return null==c[++b]?E:c[b]})),a||E},r.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),r.ninja=function(){return z.was?y.win.Raphael=z.is:delete Raphael,r},r.st=kb,function(a,b,c){function d(){/in/.test(a.readyState)?setTimeout(d,9):r.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,c=function(){a.removeEventListener(b,c,!1),a.readyState="complete"},!1),a.readyState="loading"),d()}(document,"DOMContentLoaded"),z.was?y.win.Raphael=r:Raphael=r,eve.on("raphael.DOMload",function(){s=!0})}(),window.Raphael.svg&&function(a){var b="hasOwnProperty",c=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=a.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};a.toString=function(){return"Your browser supports SVG.\nYou are running Rapha�l "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[b](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),c(e[f])):d.setAttribute(f,c(e[f])))}else d=a._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(b,e){var j="linear",k=b.id+e,m=.5,n=.5,o=b.node,p=b.paper,r=o.style,s=a._g.doc.getElementById(k);if(!s){if(e=c(e).replace(a._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b),n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(a.rad(t)),f.sin(a.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=a._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),b.gradient&&k!=b.gradient.id&&(p.defs.removeChild(b.gradient),delete b.gradient),!b.gradient){s=q(j+"Gradient",{id:k}),b.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:b.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;x<y;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var g,h,i,j,k,m=c(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w){var A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y;a._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1);var C,D=a._g.doc.getElementById(B);D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k);var E=i*("diamond"!=w&&"oval"!=w);f?(g=d._.arrows.startdx*u||0,h=a.getTotalLength(t.path)-E*u):(g=E*u,h=a.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),k={},k["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=Raphael.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e}else f?(g=d._.arrows.startdx*u||0,h=a.getTotalLength(t.path)-g):(g=0,h=a.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:Raphael.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"];for(k in p)if(p[b](k)&&!p[k]){var F=a._g.doc.getElementById(k);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,b,d){if(b=u[c(b).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=b.length;h--;)g[h]=b[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[b](o)){if(!a._availableAttrs[b](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"href":case"title":case"target":var u=i.parentNode;if("a"!=u.tagName.toLowerCase()){var w=q("a");u.insertBefore(w,i),w.appendChild(i),u=w}"target"==o?u.setAttributeNS(n,"show","blank"==p?"new":p):u.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var x=c(p).split(j);if(4==x.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var z=q("clipPath"),A=q("rect");z.id=a.createUUID(),q(A,{x:x[0],y:x[1],width:x[2],height:x[3]}),z.appendChild(A),d.paper.defs.appendChild(z),q(i,{"clip-path":"url(#"+z.id+")"}),d.clip=A}if(!p){var B=i.getAttribute("clip-path");if(B){var C=a._g.doc.getElementById(B.replace(/(^url\(#|\)$)/g,l));C&&C.parentNode.removeChild(C),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=a._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":1==d._.sx&&1==d._.sy||(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var D=c(p).match(a._ISURL);if(D){z=q("pattern");var E=q("image");z.id=a.createUUID(),q(z,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(E,{x:0,y:0,"xlink:href":D[1]}),z.appendChild(E),function(b){a._preload(D[1],function(){var a=this.offsetWidth,c=this.offsetHeight;q(b,{width:a,height:c}),q(E,{width:a,height:c}),d.paper.safari()})}(z),d.paper.defs.appendChild(z),q(i,{fill:"url(#"+z.id+")"}),d.pattern=z,d.pattern&&s(d);break}var F=a.getRGB(p);if(F.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=c(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var G=a._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(G){var H=G.getElementsByTagName("stop");q(H[H.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!a.is(k.opacity,"undefined")&&a.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!a.is(k["fill-opacity"],"undefined")&&a.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});F[b]("opacity")&&q(i,{"fill-opacity":F.opacity>1?F.opacity/100:F.opacity});case"stroke":F=a.getRGB(p),i.setAttribute(o,F.hex),"stroke"==o&&F[b]("opacity")&&q(i,{"stroke-opacity":F.opacity>1?F.opacity/100:F.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=c(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[b]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){(G=a._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)))&&(H=G.getElementsByTagName("stop"),q(H[H.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var I=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[I]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},x=1.2,y=function(d,f){if("text"==d.type&&(f[b]("text")||f[b]("font")||f[b]("font-size")||f[b]("x")||f[b]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(a._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;if(f[b]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=c(f.text).split("\n"),m=[],n=0,o=k.length;n<o;n++)j=q("tspan"),n&&q(j,{dy:i*x,x:g.x}),j.appendChild(a._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;n<o;n++)n?q(m[n],{dy:i*x,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&a.is(r,"finite")&&q(m[0],{dy:r})}},z=function(b,c){this[0]=this.node=b,b.raphael=!0,this.id=a._oid++,b.raphaelid=this.id,this.matrix=a.matrix(),this.realPath=null,this.paper=c,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!c.bottom&&(c.bottom=this),this.prev=c.top,c.top&&(c.top.next=this),c.top=this,this.next=null},A=a.el;z.prototype=A,A.constructor=z,a._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,b,e){if(this.removed)return this;if(a=c(a).split(j),a.length-1&&(b=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(b=e),null==b||null==e){var f=this.getBBox(1);b=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,b,e]])),this},A.scale=function(a,b,e,f){if(this.removed)return this;if(a=c(a).split(j),a.length-1&&(b=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==b&&(b=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,b,e,f]])),this},A.translate=function(a,b){return this.removed?this:(a=c(a).split(j),a.length-1&&(b=d(a[1])),a=d(a[0])||0,b=+b||0,this.transform(this._.transform.concat([["t",a,b]])),this)},A.transform=function(c){var d=this._;if(null==c)return d.transform;if(a._extractTransform(this,c),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[b]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var b=this.paper;b.__set__&&b.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&b.defs.removeChild(this.gradient),a._tear(this,b),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var c in this)this[c]="function"==typeof this[c]?a._removedFactory(c):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(a){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(c,d){if(this.removed)return this;if(null==c){var e={};for(var f in this.attrs)this.attrs[b](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&a.is(c,"string")){if("fill"==c&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==c)return this._.transform;for(var g=c.split(j),h={},i=0,l=g.length;i<l;i++)c=g[i],c in this.attrs?h[c]=this.attrs[c]:a.is(this.paper.customAttributes[c],"function")?h[c]=this.paper.customAttributes[c].def:h[c]=a._availableAttrs[c];return l-1?h:h[g[0]]}if(null==d&&a.is(c,"array")){for(h={},i=0,l=c.length;i<l;i++)h[c[i]]=this.attr(c[i]);return h}if(null!=d){var m={};m[c]=d}else null!=c&&a.is(c,"object")&&(m=c);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[b](n)&&m[b](n)&&a.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[b](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var b=this.paper;return b.top!=this&&a._tofront(this,b),this},A.toBack=function(){if(this.removed)return this;var b=this.node.parentNode;"a"==b.tagName.toLowerCase()?b.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):b.firstChild!=this.node&&b.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper);this.paper;return this},A.insertAfter=function(b){if(this.removed)return this;var c=b.node||b[b.length-1].node;return c.nextSibling?c.parentNode.insertBefore(this.node,c.nextSibling):c.parentNode.appendChild(this.node),a._insertafter(this,b,this.paper),this},A.insertBefore=function(b){if(this.removed)return this;var c=b.node||b[0].node;return c.parentNode.insertBefore(this.node,c),a._insertbefore(this,b,this.paper),this},A.blur=function(b){var c=this;if(0!=+b){var d=q("filter"),e=q("feGaussianBlur");c.attrs.blur=b,d.id=a.createUUID(),q(e,{stdDeviation:+b||1.5}),d.appendChild(e),c.paper.defs.appendChild(d),c._blur=d,q(c.node,{filter:"url(#"+d.id+")"})}else c._blur&&(c._blur.parentNode.removeChild(c._blur),delete c._blur,delete c.attrs.blur),c.node.removeAttribute("filter")},a._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},a._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},a._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},a._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},a._engine.text=function(b,c,d,e){var f=q("text");b.canvas&&b.canvas.appendChild(f);var g=new z(f,b);return g.attrs={x:c,y:d,"text-anchor":"middle",text:e,font:a._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},a._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},a._engine.create=function(){var b=a._getContainer.apply(0,arguments),c=b&&b.container,d=b.x,e=b.y,f=b.width,g=b.height;if(!c)throw new Error("SVG container not found.");var h,i=q("svg"),j="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==c?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",a._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",c.firstChild?c.insertBefore(i,c.firstChild):c.appendChild(i)),c=new a._Paper,c.width=f,c.height=g,c.canvas=i,c.clear(),c._left=c._top=0,h&&(c.renderfix=function(){}),c.renderfix(),c},a._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this},a.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(c){a=b.createSVGMatrix()}var d=-a.e%1,e=-a.f%1;(d||e)&&(d&&(this._left=(this._left+d)%1,c.left=this._left+"px"),e&&(this._top=(this._top+e)%1,c.top=this._top+"px"))},a.prototype.clear=function(){a.eve("raphael.clear",this);for(var b=this.canvas;b.firstChild;)b.removeChild(b.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(a._g.doc.createTextNode("Created with Rapha�l "+a.version)),b.appendChild(this.desc),b.appendChild(this.defs=q("defs"))},a.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null};var B=a.st;for(var C in A)A[b](C)&&!B[b](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}(window.Raphael),window.Raphael.vml&&function(a){var b="hasOwnProperty",c=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=a.eve,m=" progid:DXImageTransform.Microsoft",n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(b){var d=/[ahqstv]/gi,e=a._pathToAbsolute;if(c(b).match(d)&&(e=a._path2curve),d=/[clmz]/g,e==a._pathToAbsolute&&!c(b).match(d)){var g=c(b).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var h,i,j=e(b);g=[];for(var k=0,l=j.length;k<l;k++){h=j[k],"z"==(i=j[k][0].toLowerCase())&&(i="x");for(var m=1,r=h.length;m<r;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(b,c,d){var e=a.matrix();return e.rotate(-b,.5,.5),{dx:e.x(c,d),dy:e.y(c,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(q)+n+i(r),m.rotation=f*(b*c<0?-1:1),f){var s=y(f,d,e);d=s.dx,e=s.dy}if(b<0&&(p+="x"),c<0&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize){var t=l.getElementsByTagName(j);t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)}m.visibility="visible"}};a.toString=function(){return"Your browser doesn�t support SVG. Falling down to VML.\nYou are running Rapha�l "+this.version};var A=function(a,b,d){for(var e=c(b).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(var t in i)i[b](t)&&(m[t]=i[t]);if(q&&(m.path=a._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~c(m.path).toLowerCase().indexOf("r")?a._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u))}if("clip-rect"in i){var G=c(i["clip-rect"]).split(k);if(4==G.length){G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1];var H=l.clipRect||a._g.doc.createElement("div"),I=H.style;I.clip=a.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var J=e.textpath.style;i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])}if("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var K=l.getElementsByTagName(j);if(K=K&&K[0],!K&&(K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),null!=K.on&&"none"!=i.fill&&null!==i.fill||(K.on=!1),K.on&&i.fill){var L=c(i.fill).match(a._ISURL);if(L){K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=L[1],K.type="tile";var M=e.getBBox(1);K.position=M.x+n+M.y,e._.fillpos=[M.x,M.y],a._preload(L[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else K.color=a.getRGB(i.fill).hex,K.src=o,K.type="solid",a.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=c(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var N=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+a.getRGB(i.fill).o+1||2)-1);N=h(g(N,0),1),K.opacity=N,K.src&&(K.color="none")}l.appendChild(K);var O=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],P=!1;!O&&(P=O=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(O.on=!0),("none"==i.stroke||null===i.stroke||null==O.on||0==i.stroke||0==i["stroke-width"])&&(O.on=!1);var Q=a.getRGB(i.stroke);O.on&&i.stroke&&(O.color=Q.hex),N=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+Q.o+1||2)-1);var R=.75*(d(i["stroke-width"])||1);if(N=h(g(N,0),1),null==i["stroke-width"]&&(R=m["stroke-width"]),i["stroke-width"]&&(O.weight=R),R&&R<1&&(N*=R)&&(O.weight=1),O.opacity=N,i["stroke-linejoin"]&&(O.joinstyle=i["stroke-linejoin"]||"miter"),O.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(O.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),i["stroke-dasharray"]){var S={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};O.dashstyle=S[b](i["stroke-dasharray"])?S[i["stroke-dasharray"]]:o}P&&l.appendChild(O)}if("text"==s.type){s.paper.canvas.style.display=o;var T=s.paper.span,U=100,V=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=T.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),V=d(m["font-size"]||V&&V[0])||10,p.fontSize=V*U+"px",s.textpath.string&&(T.innerHTML=c(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var W=T.getBoundingClientRect();s.W=m.w=(W.right-W.left)/U,s.H=m.h=(W.bottom-W.top)/U,s.X=m.x,s.Y=m.y+s.H/2,("x"in i||"y"in i)&&(s.path.v=a.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var X=["x","y","text","font","font-family","font-weight","font-style","font-size"],Y=0,Z=X.length;Y<Z;Y++)if(X[Y]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left",s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right",s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center",s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(b,f,g){b.attrs=b.attrs||{};var h=(b.attrs,Math.pow),i="linear",j=".5 .5";if(b.attrs.gradient=f,f=c(f).replace(a._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift();if(k=-d(k),isNaN(k))return null}var l=a._parseDots(f);if(!l)return null;if(b=b.shape||b.node,l.length){b.removeChild(g),g.on=!0,g.method="none",g.color=l[0].color,g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;p<q;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),b.appendChild(g)}return 1},D=function(b,c){this[0]=this.node=b,b.raphael=!0,this.id=a._oid++,b.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=c,this.matrix=a.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!c.bottom&&(c.bottom=this),this.prev=c.top,c.top&&(c.top.next=this),c.top=this,this.next=null},E=a.el;D.prototype=E,E.constructor=D,E.transform=function(b){if(null==b)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=b=c(b).replace(/\.{3}|\u2026/g,this._.transform||o)),a._extractTransform(this,f+b);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~c(this.attrs.fill).indexOf("-"),l=!c(this.attrs.fill).indexOf("url(");if(h.translate(-.5,-.5),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=c(h),i.offset=h.offset();return d&&(this._.transform=d),this},E.rotate=function(a,b,e){if(this.removed)return this;if(null!=a){if(a=c(a).split(k),a.length-1&&(b=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(b=e),null==b||null==e){var f=this.getBBox(1);b=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,b,e]])),this}},E.translate=function(a,b){return this.removed?this:(a=c(a).split(k),a.length-1&&(b=d(a[1])),a=d(a[0])||0,b=+b||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=b),this.transform(this._.transform.concat([["t",a,b]])),this)},E.scale=function(a,b,e,f){if(this.removed)return this;if(a=c(a).split(k),a.length-1&&(b=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==b&&(b=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,b,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),a.eve.unbind("raphael.*.*."+this.id),a._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null;this.removed=!0}},E.attr=function(c,d){if(this.removed)return this;if(null==c){var e={};for(var f in this.attrs)this.attrs[b](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&a.is(c,"string")){if(c==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=c.split(k),h={},i=0,m=g.length;i<m;i++)c=g[i],c in this.attrs?h[c]=this.attrs[c]:a.is(this.paper.customAttributes[c],"function")?h[c]=this.paper.customAttributes[c].def:h[c]=a._availableAttrs[c];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&a.is(c,"array")){for(h={},i=0,m=c.length;i<m;i++)h[c[i]]=this.attr(c[i]);return h}var n;null!=d&&(n={},n[c]=d),null==d&&a.is(c,"object")&&(n=c);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[b](o)&&n[b](o)&&a.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[b](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&a._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper)),this)},E.insertAfter=function(b){return this.removed?this:(b.constructor==a.st.constructor&&(b=b[b.length-1]),b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):b.node.parentNode.appendChild(this.node),a._insertafter(this,b,this.paper),this)},E.insertBefore=function(b){return this.removed?this:(b.constructor==a.st.constructor&&(b=b[0]),b.node.parentNode.insertBefore(this.node,b.node),a._insertbefore(this,b,this.paper),this)},E.blur=function(b){var c=this.node.runtimeStyle,d=c.filter;d=d.replace(r,o),0!=+b?(this.attrs.blur=b,c.filter=d+n+m+".Blur(pixelradius="+(+b||1.5)+")",c.margin=a.format("-{0}px 0 0 -{0}px",f(+b||1.5))):(c.filter=d,c.margin=0,delete this.attrs.blur)},a._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},a._engine.rect=function(b,c,d,e,f,g){var h=a._rectPath(c,d,e,f,g),i=b.path(h),j=i.attrs;return i.X=j.x=c,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},a._engine.ellipse=function(a,b,c,d,e){var f=a.path();f.attrs;return f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},a._engine.circle=function(a,b,c,d){var e=a.path();e.attrs;return e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},a._engine.image=function(b,c,d,e,f,g){var h=a._rectPath(d,e,f,g),i=b.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=c,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=c,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},a._engine.text=function(b,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=a.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=c(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,b),l={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=c(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),b.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},a._engine.setSize=function(b,c){var d=this.canvas.style;return this.width=b,this.height=c,b==+b&&(b+="px"),c==+c&&(c+="px"),d.width=b,d.height=c,d.clip="rect(0 "+b+" "+c+" 0)",this._viewBox&&a._engine.setViewBox.apply(this,this._viewBox),this},a._engine.setViewBox=function(b,c,d,e,f){a.eve("raphael.setViewBox",this,this._viewBox,[b,c,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,d*h<j&&(b-=(j-d*h)/2/h),e*i<k&&(c-=(k-e*i)/2/i)),this._viewBox=[b,c,d,e,!!f],this._viewBoxShift={dx:-b,dy:-c,scale:l},this.forEach(function(a){a.transform("...")}),this};var F;a._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(a){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},a._engine.initWin(a._g.win),a._engine.create=function(){var b=a._getContainer.apply(0,arguments),c=b.container,d=b.height,e=b.width,f=b.x,g=b.y;if(!c)throw new Error("VML container not found.");var h=new a._Paper,i=h.canvas=a._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=1e3*u+n+1e3*u,h.coordorigin="0 0",h.span=a._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==c?(a._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):c.firstChild?c.insertBefore(i,c.firstChild):c.appendChild(i),h.renderfix=function(){},h},a.prototype.clear=function(){a.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=a._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},a.prototype.remove=function(){a.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null;return!0};var G=a.st;for(var H in E)E[b](H)&&!G[b](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}(window.Raphael),Speedometer.themes={};var TBE={CreateCanvasElement:function(){var a=document.createElement("canvas");return a.style.position="absolute",a},CreateSquareCanvasElement:function(a){var b=TBE.CreateCanvasElement();return b.setAttribute("width",a),b.setAttribute("height",a),b},GetElement2DContext:function(a){return"object"!=typeof a&&(a=document.getElementById(a)),a&&a.getContext?a.getContext("2d"):null},ClearCanvas:function(a){"object"!=typeof a&&(a=document.getElementById(a)),a&&a.setAttribute("width",a.getAttribute("width"))},defaultView:null,GetElementComputedStyle:function(a){return this.defaultView||(this.defaultView=document.defaultView),this.defaultView&&this.defaultView.getComputedStyle?this.defaultView.getComputedStyle(a,null):null},Deg2Rad:function(a){return a*Math.PI/180}};Speedometer.themes.default={dial:"Gray",rim:"SlateGray",rimArc:"Gainsboro",thresh:"LawnGreen",center:"Black",nose:"SlateGray",hand:"Black",handShine:"SlateGray",handShineTo:"Black",ticks:"Black",marks:"Black",strings:"Black",digits:"Black",font:"Sans-Serif"},Speedometer.themes.kitsch={dial:"Green",rim:"Purple",thresh:"Blue",center:"Blue",nose:"Yellow",hand:"Blue",handShine:"LightBlue",handShineTo:"Blue",ticks:"Purple",marks:"White",strings:"Red",digits:"Green",font:"Times"},freeboard.loadWidgetPlugin({type_name:"barGraph",display_name:"Bar Graph",description:"A bar graph generated from input data",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"],settings:[{name:"orientation",display_name:"Orientation",type:"option",options:[{name:"Vertical",value:"vertical"},{name:"Horizontal",value:"horizontal"}]},{name:"graphTitle",display_name:"Graph Title",type:"text"},{name:"data",display_name:"Data",type:"data",multi_input:!0,incoming_parser:!0,description:'expected format: [ { "x": 1, "y": 2 }, { "x": 2, "y": 4 }, { "x": 3, "y": 8 } ] '},{name:"sizeInBlocks",display_name:"Size in Blocks",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:4},{name:"rangeTitle",display_name:"Range Title",type:"text",default_value:""},{name:"domainTitle",display_name:"Domain Title",type:"text",default_value:""},{name:"title_color",display_name:"Title Color",type:"text",default_value:"#5EA7CF"},{name:"axis_color",display_name:"Axis Color",type:"text",default_value:"#CCCCCC"},{name:"bar_color",display_name:"Bar Color",type:"text",default_value:"#5EA7CF"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new barGraph(a,c))}});var barGraph=function(a,b){var c,d=this,e=a,f=60,g=$("<div>").addClass("barGraphContainer"),h=$("<h2>").addClass("section-title").css("text-align","center"),i=d3.select(g[0]).append("svg"),j=function(){g.html(""),i.remove();var a={top:20,right:25,bottom:70,left:55},b=g.width()-a.left-a.right,d=g.height()-a.top-a.bottom;i=d3.select(g[0]).append("svg").attr("width",b+a.left+a.right).attr("height",d+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");var f=utils.graph.formatInput(c);if("vertical"===e.orientation){var j=d3.scale.ordinal().rangeRoundBands([0,b],.05),k=d3.scale.linear().range([d,0]),l=d3.svg.axis().scale(j).orient("bottom"),m=d3.svg.axis().scale(k).orient("left").ticks(10);j.domain(f.map(function(a){return a.x})),k.domain([0,d3.max(f,function(a){return a.y})]),i.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(l).selectAll("text").style("text-anchor","middle").attr("y","15"),i.append("text").attr("class","axisLabel").attr("x",b/2).attr("y",d+35).style("text-anchor","middle").text(e.domainTitle),i.append("g").attr("class","y axis").call(m).append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",5).attr("dy",".71em").style("text-anchor","end").text(e.rangeTitle),i.selectAll("bar").data(f).enter().append("rect").attr("class","bar").attr("x",function(a){return j(a.x)}).attr("width",j.rangeBand()).attr("y",function(a){return k(a.y)}).attr("height",function(a){return d-k(a.y)})}if("horizontal"===e.orientation){var j=d3.scale.ordinal().rangeRoundBands([0,d],.05),k=d3.scale.linear().range([0,b]),l=d3.svg.axis().scale(j).orient("left"),m=d3.svg.axis().scale(k).orient("bottom").ticks(10);j.domain(f.map(function(a){return a.x})),k.domain([0,d3.max(f,function(a){return a.y})]),i.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(m).selectAll("text").style("text-anchor","middle").attr("y","15"),i.append("g").attr("class","y axis").call(l);var n=0;for(var o in f)n=Math.max(f[o].y,n);var p=b/n,q=d/f.length;i.selectAll("bar").data(f).enter().append("rect").attr("class",function(a,b){return"bar "+a.x}).attr("x",function(a,b){return 0}).attr("y",function(a,b){return q*b+1}).attr("width",function(a,b){return p*a.y}).attr("height",q-2),i.selectAll("text").data(f).enter().append("text").attr("class",function(a,b){return"label "+a.x}).attr("x",5).attr("y",function(a,b){return q*b+15}).text(function(a){return a.x+" ("+a.y+")"}).attr("font-size","15px").style("font-weight","bold");i.append("text").attr("class","axisLabel").attr("x",b/2).attr("y",d+35).style("text-anchor","middle").text(e.rangeTitle),i.append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",-55).attr("x",-d/2).attr("dy",10).style("text-anchor","middle").text(e.domainTitle)}i.selectAll(".bar").style({fill:e.bar_color}),i.selectAll(".axis , .axis text").style({fill:e.axis_color}),i.selectAll(".axis line, .axis path").style({stroke:e.axis_color}),i.selectAll("text.axisLabel").style({fill:e.title_color}),h.css("color",e.title_color)};d.render=function(a){$(a).html(""),h.text(e.graphTitle),g.css({width:"100%",height:f*e.sizeInBlocks+"px"}),$(a).append([h,g]),setTimeout(function(){j(),freeboard.resize()},300)},d.getHeight=function(){var a=e.sizeInBlocks?e.sizeInBlocks:4;return utils.widget.calculateHeight(a)},d.onSettingsChanged=function(a){e=a,e.sizeInBlocks=utils.widget.calculateHeight(e.sizeInBlocks),d.render()},d.onCalculatedValueChanged=function(a,b){c=b,d.render()},d.getValue=function(){return c},d.onDispose=function(){}};freeboard.loadWidgetPlugin({type_name:"simple_button",display_name:"Button",description:"A basic button for sending information",fill_size:!1,settings:[{name:"buttonLabel",display_name:"Button Label",type:"text"},{name:"eventTarget",display_name:"Event Target",type:"data",force_data:"dynamic",multi_input:!0,outgoing_parser:!0},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"}]},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new simpleButtonPlugin(a,c))}});var simpleButtonPlugin=function(a,b){var c=this,d=a,e=$("<input>").attr({type:"button",value:a.buttonLabel}).addClass("widget-button").wrap("<div></div>"),f={};c.render=function(a){$(a).append(e),e.on("click",c.onEvent)},c.getHeight=function(){return"big"==d.size?utils.widget.calculateHeight(2):utils.widget.calculateHeight(1)},c.onSettingsChanged=function(a){d=a,e.val(a.buttonLabel)},c.onCalculatedValueChanged=function(a,b){f=b},c.onDispose=function(){},c.getValue=function(){},c.onEvent=function(){b(f)}},COLLECTION_GRID_COLUMNS_SETTING_NAME="columns",COLLECTION_GRID_DATA_SETTING_NAME="data",COLLECTION_GRID_PAGE_SIZE="page_size",COLLECTION_GRID_ITEM_COUNT="item_count";freeboard.loadWidgetPlugin({type_name:"crudgrid",display_name:"CRUD Grid",description:"An interactive grid for working with a source's data.",external_scripts:["lib/js/thirdparty/jsgrid.min.js"],settings:[{name:"gridTitle",display_name:"Grid Title",type:"text"},{name:COLLECTION_GRID_DATA_SETTING_NAME,display_name:"Data",type:"data",force_data:"dynamic",incoming_parser:!0,outgoing_parser:!0,description:'expected format: [ { "name": "John", "age": 42 }, { "name": "Jane", "age": 43 } ]'},{name:COLLECTION_GRID_COLUMNS_SETTING_NAME,display_name:"Columns",type:"data",force_data:"dynamic",incoming_parser:!0,description:'expected format: [ { "name": "name", "type": "text" }, { "name": "age", "type": "number" } ]'},{name:COLLECTION_GRID_PAGE_SIZE,display_name:"Page Size",type:"number",description:"Number of items per page. Expected format: Int"},{name:COLLECTION_GRID_ITEM_COUNT,display_name:"Item Count",type:"number",type:"data",force_data:"dynamic",incoming_parser:!0,description:"Number of items"},{name:"sizeInBlocks",display_name:"Size in Blocks",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:4},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],default_parsers:{clearblade_collection:{incoming:"// Defualt incoming parser for use with a ClearBlade Collection datasource. Format collection data to match widget's expected schema.\nif(this.datasource === undefined){return;}\nvar fmtData = [];\nfor(var i = 0, len = this.datasource.length; i < len; i++){\nfmtData.push(this.datasource[i].data);\n}\nreturn fmtData;",outgoing:'// Defualt outgoing parser for use with a ClearBlade Collection datasource. Generates query to update on unique key of "item_id".\nif (this.widget.method !== "'+utils.constants.PAGE_METHOD+'") {\nvar query = cb.Query();\nquery.equalTo("item_id", this.widget.data["item_id"])\nthis.widget.query = query;\n}\nreturn this.widget;'},clearblade_collection_columns:{incoming:'// Default parser when used with Collection Columns. Supplies all collection columns and disables editing of \'item_id\'\nif(this.datasource == undefined){return;}\nvar fmtColumns = [];\nfor(var c = 0, len = this.datasource.length; c < len; c++){\nvar col = {\n"name": this.datasource[c].ColumnName,\n"type" : this.datasource[c].ColumnType,\n"disabled" : (this.datasource[c].ColumnName == "item_id" ? true : false)\n};\nfmtColumns.push(col);\n}\nreturn fmtColumns;'}},newInstance:function(a,b,c){b(new collectionGrid(a,c))}});var collectionGrid=function(a,b){var c,d=a,e=$("<h4>").addClass("widget-heading").text(a.gridTitle),f=$("<div>"),g="control",h="Add",i=[],j=100,k={},l="",m={paging:{pageIndex:1,pageSize:d[COLLECTION_GRID_PAGE_SIZE]},schema:[]},n={insertItem:function(a){var c=$.Deferred();return l=utils.constants.INSERT_METHOD,b(a).then(function(a){c.resolve()},function(){c.reject()}),c.promise()},updateItem:function(a){var c=$.Deferred();return k=a,l=utils.constants.UPDATE_METHOD,b(a).then(function(a){c.resolve()},function(){c.reject()}),c.promise()},deleteItem:function(a){var c=$.Deferred();return k=a,l=utils.constants.DELETE_METHOD,b(a).then(function(){c.resolve()},function(){c.reject()}),c.promise()},loadData:function(a){var c=$.Deferred();return a.bypass?(c.resolve({data:i,itemsCount:j}),setTimeout(function(){f.jsGrid("render")})):(m.paging=a,l=utils.constants.PAGE_METHOD,b().then(function(a){c.resolve({data:i,itemsCount:j})},function(){c.reject()})),c.promise()}},o=function(a,b){for(var d,e=$("<form>"),f=0,i=c.fields.length;f<i;f++)c.fields[f].type!==g&&(d=$("<div>").addClass("form-row").append($("<div>").addClass("form-label").append("<label>").addClass("control-label").html(c.fields[f].name)).append($("<div>").addClass("form-value").append($("<input>").attr({type:c.fields[f].type,placeholder:c.fields[f].name}).prop("disabled",void 0!==c.fields[f].disabled&&c.fields[f].disabled).val(b[c.fields[f].name]))),e.append(d));var j={};new DialogBox(e,a+" Row","Save","Cancel",function(){for(var c=0,d=e[0].length;c<d;c++)j[$(e[0][c]).attr("placeholder")]=$(e[0][c]).val();p(j,b,a===h)})},p=function(a,b,c){k=a,f.jsGrid(c?"insertItem":"updateItem",b,a)};this.render=function(a){this.defineGrid(),$(a).append([e,f]),setTimeout(function(){f.jsGrid("loadData")})},this.setFields=function(a){c.fields=a,c.fields.push({type:g,modeSwitchButton:!1,editButton:!1,headerTemplate:function(){return $("<button>").attr("type","button").text("Add").on("click",function(){o(h,{})})}}),m.schema=c.fields,f.jsGrid(c)},this.setRows=function(a){c.data=a;for(var b in a)for(var d in a[b])a[b][d]=a[b][d]+"";f.jsGrid(c)},this.getHeight=function(){var a=d.sizeInBlocks?d.sizeInBlocks:4;return utils.widget.calculateHeight(a)},this.getValue=function(){return{data:k,method:l,options:m}},this.defineGrid=function(){var a=""!==e.text()?40:20;c={height:utils.widget.blocksToPixels(this.getHeight())-a+"px",width:"100%",editing:!0,paging:!0,pageSize:d[COLLECTION_GRID_PAGE_SIZE]||20,pageLoading:!0,noDataContent:"Empty data set",controller:n,rowClick:function(a){o("Edit",a.item)},deleteConfirm:function(a){return"Are you sure you want to delete this item?"},fields:[]}},this.onSettingsChanged=function(a){d=a,e.text(d.gridTitle),this.defineGrid()},this.onCalculatedValueChanged=function(a,b){a===COLLECTION_GRID_COLUMNS_SETTING_NAME&&this.setFields(b),a===COLLECTION_GRID_DATA_SETTING_NAME&&(i=b,setTimeout(function(){f.jsGrid("loadData",{bypass:!0})})),a===COLLECTION_GRID_ITEM_COUNT&&(j=b)},this.onDispose=function(){}};freeboard.loadWidgetPlugin({type_name:"mach_d3_plugin",display_name:"D3.js Visualization",description:"Uses D3.js to visualize data",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"],fill_size:!1,settings:[{name:"data",display_name:"Source",description:"Bind the widget to a data source.",type:"data",force_data:"dynamic",incoming_parser:!0},{name:"style",display_name:"CSS",description:"Stylesheet rules to add to the whole page.",type:"calculated"},{name:"html",display_name:"HTML",description:"The HTML to render in the widget.",type:"calculated"},{name:"code",display_name:"D3.js Code",description:"Write the d3.js code to update the visualization.",type:"calculated"},{name:"sizeInBlocks",display_name:"Size in Blocks (fractions are allowed)",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:1},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new d3WidgetPlugin(a))}});var d3WidgetPlugin=function(settings){var self=this,currentSettings=settings,container,dataBU,styleSheet=null;self.render=function(a){container=a,self.onSettingsChanged(currentSettings)},self.getHeight=function(){var a=currentSettings.sizeInBlocks?currentSettings.sizeInBlocks:1;return utils.widget.calculateHeight(a)},self.onSettingsChanged=function(a){if(currentSettings=a,currentSettings.sizeInBlocks=utils.widget.calculateHeight(currentSettings.sizeInBlocks),currentSettings.html&&(container.innerHTML=currentSettings.html),currentSettings.style){if(self.styleSheet){self.styleSheet.parentNode.removeChild(self.styleSheet)}var b=function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a};self.styleSheet=b(),self.styleSheet.innerHTML=currentSettings.style}},self.onCalculatedValueChanged=function(settingName,newValue){if(settingName==currentSettings.data[0].dsName){var code=currentSettings.code,data=newValue;dataBU=data,eval(code)}},self.onDispose=function(){},self.getValue=function(){return dataBU||""}},dialWidgetPlugin=function(a,b){var c=this;c.lastMove;for(var d,e=a,f={x:0,y:0},g={x:0,y:0},h=[],i={min:0,max:270,current:0},j=10,k="Low",l="High",m=$("<h4>").addClass("widget-heading").text(a.dial_name).css("margin-bottom","-35px"),n=$("<div>").addClass("knob-surround"),o=$("<div>").addClass("knob").bind("touchstart",function(a){f.x=a.originalEvent.touches[0].pageX,f.y=a.originalEvent.touches[0].pageY}).bind("mousewheel DOMMouseScroll touchmove scroll",function(a){var b=null;"mousewheel"==a.type?b=-1*a.originalEvent.wheelDelta:"DOMMouseScroll"==a.type?b=40*a.originalEvent.detail:"touchmove"==a.type&&(g={x:0,y:0},g.x=f.x-a.originalEvent.touches[0].pageX,g.y=f.y-a.originalEvent.touches[0].pageY,b=g.y),b&&(a.preventDefault(),$(this).scrollTop(b+$(this).scrollTop())),a.originalEvent.wheelDelta>0||a.originalEvent.detail<0||g.y>0?c.moveKnob("up"):c.moveKnob("down")}),p=$("<span>").addClass("min").text(k).css("color","green"),q=$("<span>").addClass("max").text(l).css("color","red"),r=$("<div>").addClass("ticks"),s=0;s<j;s++){var t=$("<div>").addClass("widget-tick");r.append(t),h.push(t)}n.append([o,p,q,r]);var u=$("<span>").css({display:"block","margin-top":"-35px","text-align":"center"}).text("loading...");c.updateSpeed=function(c){d=c,void 0!==a._datatype&&b(d)},c.getValue=function(){return d},c.moveKnob=function(a){c.lastMove=Date.now(),"up"==a?i.current+2<=i.max&&(i.current+=2,c.setAngle()):"down"==a&&i.current-2>=i.min&&(i.current-=2,c.setAngle())},c.setAngle=function(a){o.css({"-moz-transform":"rotate("+i.current+"deg)","-webkit-transform":"rotate("+i.current+"deg)","-o-transform":"rotate("+i.current+"deg)","-ms-transform":"rotate("+i.current+"deg)",transform:"rotate("+i.current+"deg)"});var b=Math.round(i.current/30)+1,d=0;for(d;d<b;d++)h[d].addClass("activetick");for(d;d<j;d++)h[d].removeClass("activetick");var e=Math.round(i.current/i.max*100);u.text(e+"%"),a||c.updateSpeed(e)},c.render=function(a){$(a).append([m,n,u])},c.getHeight=function(){return utils.widget.calculateHeight(8)},c.onSettingsChanged=function(b){e=b,m.text(a.dial_name)},c.onCalculatedValueChanged=function(a,b){(Date.now()-500>=c.lastMove||!c.lastMove)&&void 0!==b&&(i.current=Math.round(b/100*i.max),isNaN(i.current)&&(console.warn("Received a value that wasn't a number for dial with name of '"+e.dial_name+"'; Resetting to 0"),i.current=0),c.setAngle(!0))},c.onDispose=function(){}};freeboard.loadWidgetPlugin({type_name:"dial_widget",display_name:"Dial",description:"A dial that connects to a message topic",external_scripts:["lib/js/thirdparty/dial.js"],fill_size:!1,settings:[{name:"dial_name",display_name:"Dial Name",type:"text",required:!0},{name:"dialVal",display_name:"Dial Value",type:"data",multi_input:!0,incoming_parser:!0,outgoing_parser:!0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new dialWidgetPlugin(a,c))}}),freeboard.loadWidgetPlugin({type_name:"message_feed",display_name:"Message Feed",fill_size:!1,settings:[{name:"feed_name",display_name:"Feed Name",type:"text"},{name:"feedSource",display_name:"Feed Source",type:"data",multi_input:!0,incoming_parser:!0},{name:"size",display_name:"Size",type:"option",options:[{name:"Small",value:"sm"},{name:"Medium",value:"md"},{name:"Large",value:"lg"},{name:"XL",value:"xl"}]},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new feedWidgetPlugin(a,c))}});var feedWidgetPlugin=function(a,b){var c=this;a.formName=a.feed_name.replace(/\s+/g,"-");var d=a,e=[],f=$("<div>").attr("id",a.feed_name).addClass("widget-list-frame"),g=$("<span>").addClass("widget-list-heading").text(a.feed_name),h=$("<ul>").addClass("lw-list");d.topic_name;c.render=function(a){$(a).append([g,f])},c.getHeight=function(){switch(d.size){case"sm":return 1;case"md":return 2;case"lg":return 4;case"xl":return 8}},c.onSettingsChanged=function(a){d=a,f.attr("id",d.feed_name),g.text(d.feed_name)},c.populateList=function(){h.html("");for(var a=e.length-1;a>=0;a--){var b=$("<li>"),c=e[a],d=$("<a>").text(c);b.append(d),h.append(b)}f.append(h)},c.onCalculatedValueChanged=function(a,b){e.push(JSON.stringify(b)),e.length>100&&e.shift(),c.populateList()},c.getValue=function(){},c.onDispose=function(){}};freeboard.addStyle(".lw-list li a","text-color: white; text-size:14px;padding: 5px 30px 5px 10px; display: block;"),freeboard.loadWidgetPlugin({type_name:"filterable_list",display_name:"Filterable List",fill_size:!1,description:"Easily filter a list based of key/values you care about. Ability to add multiple filter options, and a text search box as well",settings:[{name:"list_name",display_name:"List Name",type:"text"},{name:"list_data",display_name:"List Source",type:"data",incoming_parser:!0,multi_input:!0},{name:"selected_item",display_name:"Selected Item",type:"data",force_data:"dynamic",outgoing_parser:!0,multi_input:!0},{name:"display_attribute",display_name:"Display Attribute",type:"text",description:"The attribute on a provided object that contains the value you want displayed in the list for the object. Defaults to 'name'",default_value:"name",required:!0},{name:"status_attribute",display_name:"Status Attribute",type:"text",description:"Attribute used to display status type styling (If value is true, then background will have green highlighting, if false, then it will be red). Leave blank if you don't care about this."},{name:"filters",display_name:"Filters",type:"text",description:'An array of simple objects that define the drop down filters you would like to have available for this list. The object should look like { someKeyOnYourObject: "Awesome Key"}'},{name:"allow_text_filter",display_name:"Allow Text Filter",type:"boolean",description:"Should a text field be display to allow filtering of the list via user input?"},{name:"block_height",display_name:"Block Height",type:"number",default_value:4},{name:"container_width",display_name:"Container Width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:100,required:!0}],newInstance:function(a,b,c){b(new filterableListWidgetPlugin(a,c))}});var filterableListWidgetPlugin=function(a,b){var c=this;c.rawData=[],c.selectedFilters={},c.textFilter="";var d,e,f=a,g=$("<div>"),h=$("<ul>"),i=$("<input>").addClass("filterable-list-text-filter").css("display","none").on("change paste keyup",function(a){c.textFilter=a.target.value,m()}),j=$("<h2>").addClass("section-title").text(f.list_name).css("margin-bottom","3px"),k=function(){for(var a=$("<div>").addClass("filterable-list-filter"),b=utils.parseJsonArray(f.filters),d=0;d<b.length;d++){var e;for(var g in b[d])b[d].hasOwnProperty(g)&&(e=g);for(var h=[],i=0;i<c.rawData.length;i++)-1===h.indexOf(c.rawData[i][e])&&h.push(c.rawData[i][e]);var j=$("<div>").addClass("filterable-list-filter-container").text(b[d][e]),k=$("<select>").css({display:"block"}).on("change",{filterKey:e},function(a){""===this.value?delete c.selectedFilters[a.data.filterKey]:c.selectedFilters[a.data.filterKey]=this.value,m()});k.append($("<option>").attr("value","").text(""));for(var i=0;i<h.length;i++)$option=$("<option>").attr("value",h[i]).text(h[i]),k.append($option);a.append(j.append(k))}return a},l=function(){var a,g=$("<ul>").addClass("filterable-list-list");if(a=_.isEqual(c.selectedFilters,{})?c.rawData.slice():_.where(c.rawData,c.selectedFilters),""!==c.textFilter)for(var h=a.length-1;h>=0;h--)-1===a[h][f.display_attribute].indexOf(c.textFilter)&&a.splice(h,1);for(var h=0;h<a.length;h++){var i=$("<li>");if(void 0!==f.status_attribute&&""!==f.status_attribute){var j=$("<div>").addClass("status");a[h][f.status_attribute]?j.addClass("positive"):j.addClass("negative"),i.append(j)}i.append($("<span>").text(a[h][f.display_attribute])),i.addClass("filterable-list-list-item").on("click",{item:a[h]},function(a){a.stopPropagation(),d=a.data.item,e&&e.removeClass("active"),e=$(this),e.addClass("active"),b(a.data.item,f.selected_item)}),g.append(i)}return g},m=function(){var a=l();h.replaceWith(a),h=a},n=function(){var a=k();g.replaceWith(a),g=a};c.render=function(a){g=k(),h=l(),f.allow_text_filter&&i.css("display","initial"),$(a).append(j,g,i,h).addClass("filterable-list-container")},c.getHeight=function(){return utils.widget.calculateHeight(f.block_height)},c.getValue=function(){return d},c.onCalculatedValueChanged=function(a,b){_.isEqual(b,this.rawData)||(this.rawData=b,n(),m())},c.onSettingsChanged=function(a){f=a,n(),m(),j.text(f.list_name),f.allow_text_filter?i.css("display","initial"):i.css("display","none")}};freeboard.loadWidgetPlugin({type_name:"flipswitch",display_name:"Flip Switch",description:"A basic switch for setting on or off states",fill_size:!1,settings:[{name:"sectionTitle",display_name:"Title",type:"text",default_value:"Switch"},{name:"trueLabel",display_name:"True Label",type:"text",default_value:"on"},{name:"falseLabel",display_name:"False Label",type:"text",default_value:"off"},{name:"switchVal",display_name:"Switch Value",type:"data",multi_input:!0,incoming_parser:!0,outgoing_parser:!0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new flipSwitchPlugin(a,c))}});var flipSwitchPlugin=function(a,b){var c=this,d=!0,e=!1,f=a,g=$("<h4>").addClass("widget-heading").text(a.sectionTitle),h=!1,i=Math.floor(50*Math.random()+1)+"",j="flipswitch-"+a.sectionTitle+i,k=$("<div>").addClass("flipswitch"),l=$("<input>").attr({type:"checkbox",id:j,name:"flipswitch"}).addClass("flipswitch-checkbox"),m=$("<label>").attr("for",j).addClass("flipswitch-label"),n=$("<div>").addClass("flipswitch-inner"),o=$("<span>").addClass("on").text(f.trueLabel),p=$("<span>").addClass("off").text(f.falseLabel);n.append([o,p]);var q=$("<div>").addClass("flipswitch-switch");m.append([n,q]),k.append([l,m]);var r={true:f.truePayload,false:f.falsePayload},s=function(){l.toggleClass("flipped"),h=!h};c.render=function(a){$(a).append([g,k]),l.on("change",c.onToggle)},c.getHeight=function(){return"big"==f.size?3:2},c.onSettingsChanged=function(a){f=a,g.text(a.sectionTitle),o.text(a.trueLabel),p.text(a.falseLabel),r={true:a.truePayload,false:a.falsePayload},c.currentState=a.currentState,c.targetDataSource=a.targetDataSource},c.getValue=function(){return l.hasClass("flipped")?d:e},c.onCalculatedValueChanged=function(a,b){var c=l.hasClass("flipped");"true"!==b&&!0!==b||c?"false"!==b&&!1!==b||!c||s():s()},c.onDispose=function(){},c.onToggle=function(){"true"===h||!0===h?(s(),b(e)):(s(),b(d))}};freeboard.loadWidgetPlugin({type_name:"form_accountConfirm",display_name:"Account Confirmation",description:"Allows for a user to confirm a pasword reset. Note: This widget must have a code datasource that validates a requested pin and updates a user's password. See docmentation for example services.",fill_size:!1,settings:[{name:"sectionTitle",display_name:"Title",type:"text",default_value:"Confirm Account"},{name:"submission_handler",display_name:"Submission Handler",type:"data",incoming_parser:!0,outgoing_parser:!0,description:'outgoing payload: {user:"email@clearblade.com", pin:"inputPin", password:"newUserPassword"}'},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new FormAccountConfimationPlugin(a,c))}});var FormAccountConfimationPlugin=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this,n=a;m.processFormOne=function(a){a.preventDefault();var c={user:f.val(),pin:h.val(),password:j.val()};if(null==c.user||null==c.pin||""===c.user||""===c.pin)return void alertMessage("Developer email and reset pin are required");if(!utils.doesMatch(c.password,l.val()))return void alertMessage("Passwords do not match.");b(c)},m.render=function(a){c=$("<h2>").addClass("section-title").text(n.sectionTitle),d=$("<form>").addClass("widget-form-frame").on("submit",m.processFormOne),e=$("<label>").text("Account Email").addClass("widget-form-label"),f=$("<input>").attr({type:"email"}).addClass("widget-form-input-text"),g=$("<label>").text("Reset Pin").addClass("widget-form-label"),h=$("<input>").attr({type:"password"}).addClass("widget-form-input-text"),$submitForm=$("<input>").attr({type:"submit",placeholder:"Email",value:"Update Account"}).addClass("widget-form-input-submit"),i=$("<label>").text("New Password").addClass("widget-form-label"),j=$("<input>").attr({type:"password"}).addClass("widget-form-input-text"),k=$("<label>").text("Confirm Password").addClass("widget-form-label"),l=$("<input>").attr({type:"password"}).addClass("widget-form-input-text");var b=$(a);b.empty(),e.append(f),g.append(h),i.append(j),k.append(l),d.append([e,g,i,k,$submitForm]),b.append([c,d])},m.getHeight=function(){return 5},m.onSettingsChanged=function(a){n=a},m.onCalculatedValueChanged=function(a,b){""!==f.val()&&(b.success?(alertMessage("Password updated for account "+f.val()),d[0].reset()):alertMessage("Error updating password: "+b.results))},m.onDispose=function(){},m.getValue=function(){return{email:f.val(),pin:h.val(),password:j.val()}},m.onEvent=function(){}};freeboard.loadWidgetPlugin({type_name:"form_passwordReset",display_name:"Reset Password",description:"Allows for a user to initiate a pasword reset. Must link to a code service datasource that generates a reset pin.",fill_size:!1,settings:[{name:"sectionTitle",display_name:"Title",type:"text",default_value:"Reset Password"},{name:"submission_handler",display_name:"Submission Handler",type:"data",incoming_parser:!0,outgoing_parser:!0,description:'outgoing payload: {email:"emailToReset@clearbalde.com"}'},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new FormResetPasswordPlugin(a,c))}});var FormResetPasswordPlugin=function(a,b){var c,d,e,f,g,h=this,i=a,j="";h.processForm=function(a){a.preventDefault();var c=f.val();if(null===c||""===c)return void alertMessage("Developer email address is required");j=c,b()},h.render=function(a){c=$("<h2>").addClass("section-title").text(i.sectionTitle),d=$("<form>").addClass("widget-form-frame").on("submit",h.processForm),e=$("<label>").addClass("widget-form-label").text("Account Email"),f=$("<input>").attr({type:"email"}).addClass("widget-form-input-text"),g=$("<input>").attr({type:"submit",placeholder:"Email",value:"Send Reset Code"}).addClass("widget-form-input-submit");var b=$(a);b.empty(),e.append(f),d.append([e,g]),b.append([c,d])},h.getHeight=function(){return 2},h.onSettingsChanged=function(a){i=a},h.onCalculatedValueChanged=function(a,b){""!=f.val()&&(b.success?(alertMessage("A reset pin has been sent to "+f.val()),d[0].reset()):alertMessage("Error requesting reset: ",b.results))},h.onDispose=function(){},h.getValue=function(){return{email:j}},h.onEvent=function(){}},gaugeWidget=function(a){var b,c=this,d=a,e=$("<div>"),f=$("<h2>").addClass("section-title").css("text-align","center"),g=d3.select(e[0]).append("svg"),h={width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},i={width:50,height:20},j={gauge:{},needleCanvas:{},minLabel:{},maxLabel:{},indicator:{},segments:[],radius:0,chartInset:0,barWidth:50,padRad:.025,currentVal:50},k=function(){function a(a){this.el=a,this.len=h.width/3,this.radius=this.len/6}var b=function(a){var b,c,d,e,f,g,h,i,j;return h=utils.percToRad(a/2),b=0,c=0,i=b-this.len*Math.cos(h),j=c-this.len*Math.sin(h),d=b-this.radius*Math.cos(h-Math.PI/2),e=c-this.radius*Math.sin(h-Math.PI/2),f=b-this.radius*Math.cos(h+Math.PI/2),g=c-this.radius*Math.sin(h+Math.PI/2),"M "+d+" "+e+" L "+i+" "+j+" L "+f+" "+g};return a.prototype.render=function(){var a=h.width/278*20;return a<20&&(a=20),this.el.append("circle").attr("class","needle-center").attr("cx",0).attr("cy",0).attr("r",a).style({fill:d.needle_color}),this.el.append("path").attr("class","needle").attr("d",b.call(this,0)).style({fill:d.needle_color,"z-index":1})},a.prototype.moveTo=function(a){var c,e=this.perc||0;this.perc=a,c=this;var f=(d.units,a-e);this.el.transition().duration(500).ease("quad").select(".needle").tween("progress",function(){return function(a){var g=e+a*f;return d.units=d.units||"%",j.currentLabel.text(j.currentVal+" "+d.units),d3.select(this).attr("d",b.call(c,g))}})},a}();this.renderGauge=function(){g.remove(),h.width=Math.floor(b.width())||(b.parent().parent().width()-b.parent().width())*(Number.parseInt(d.container_width)/100),h.height=Math.round(.5*h.width),h.padding.bottom=h.padding.top=Number.parseInt(b.css("padding-top")),h.padding.left=h.padding.right=Number.parseInt(b.css("padding-right")),e.css({width:h.width}),e.css({height:h.height});var a={width:h.width,height:Math.round(h.width/2)+i.height},f={arc:{min:{height:i.height,x:0,y:a.height,fill:d.label_color,"text-anchor":"start"},max:{height:i.height,x:a.width,y:a.height,fill:d.label_color,"text-anchor":"end"},current:{height:i.height,x:a.width/2-.6*i.height,y:a.height-.8*i.height,fill:d.label_color,"text-anchor":"start"}},barH:{min:{height:i.height,x:0,y:a.height/2+32,fill:d.label_color,"text-anchor":"start"},max:{height:i.height,x:a.width,y:a.height/2+32,fill:d.label_color,"text-anchor":"end"},current:{height:i.height,x:a.width/2-.6*i.height,y:a.height/2-34,fill:d.label_color,"text-anchor":"middle"}},barV:{min:{height:i.height,x:a.width/2+28,y:a.height,fill:d.label_color,"text-anchor":"start"},max:{height:i.height,x:a.width/2+28,y:10+i.height,fill:d.label_color,"text-anchor":"start"},current:{height:i.height,x:a.width/2-28,y:10+i.height,fill:d.label_color,"text-anchor":"end"}}};g=d3.select(e[0]).append("svg").attr(a).style("overflow","visible");var l=a.width>0?j.barWidth*(a.width/278):j.barWidth;j.barWidth=l>100?100:l,j.chartInset=0,void 0===d.gauge_style||0===d.gauge_style?(j.minLabel=g.append("text").attr(f.arc.min),j.maxLabel=g.append("text").attr(f.arc.max),j.radius=h.height>0?h.height-i.height:10,j.gauge=g.append("g").attr("transform","translate("+a.width/2+", "+(a.height-i.height)+")"),j.needleCanvas=g.append("g").attr("transform","translate("+a.width/2+", "+(a.height-i.height)+")"),j.needle=new k(j.needleCanvas),j.needle.render(),j.currentLabel=g.append("text").attr(f.arc.current)):1===d.gauge_style?(j.minLabel=g.append("text").attr(f.barH.min),j.maxLabel=g.append("text").attr(f.barH.max),j.radius=h.height-i.height,j.gauge=g.append("g").attr("transform","translate(0,"+(a.height/2-50)+")"),j.currentLabel=g.append("text").attr(f.barH.current),j.indicator=g.append("rect").attr({width:2,height:50,x:a.width/2-25,y:a.height/2-30,fill:d.needle_color})):2===d.gauge_style&&(j.minLabel=g.append("text").attr(f.barV.min),j.maxLabel=g.append("text").attr(f.barV.max),j.radius=h.height-i.height,j.gauge=g.append("g").attr("transform","translate("+(a.width/2-25)+", 20)"),j.currentLabel=g.append("text").attr(f.barV.current),j.indicator=g.append("rect").attr({width:50,height:2,x:a.width/2-25,y:a.height/2,fill:d.needle_color})),c.paintGauge(j.segments)};var l=[];this.paintGauge=function(a){for(c in l)l[c].remove();l.length=0;var b=.75;if(void 0===d.gauge_style||0===d.gauge_style){b=.75;for(var c,e=0,f=a.length;e<f;e++){var g=j.gauge.append("path").attr({class:"arc"}).style({fill:a[e].color,"z-index":-1});l.push(g),c=d3.svg.arc().outerRadius(j.radius-j.chartInset).innerRadius(j.radius-j.chartInset-j.barWidth),arcStartRad=utils.percToRad(b),arcEndRad=arcStartRad+utils.percToRad(a[e].share/2),b+=a[e].share/2,c.startAngle(arcStartRad).endAngle(arcEndRad),g.attr("d",c)}j.needle.moveTo(j.currentVal/d.max_value)}else if(1===d.gauge_style){if(0===d.gauge_varient||1===d.gauge_varient){b=0;for(var c,e=0,f=a.length;e<f;e++){var i=h.width*Number.parseFloat(a[e].share),g=j.gauge.append("rect").attr({class:"bar",width:i,height:50,x:b,y:20}).style({fill:a[e].color,"z-index":-1});l.push(g),b+=i}}var k=j.currentVal/d.max_value*h.width;j.currentLabel.attr("x",k),j.currentLabel.text(j.currentVal+" "+d.units),j.indicator.attr("x",k)}else if(2===d.gauge_style){if(0===d.gauge_varient||1===d.gauge_varient){b=h.height;for(var c,e=0,f=a.length;e<f;e++){var m=h.height*Number.parseFloat(a[e].share),g=j.gauge.append("rect").attr({class:"bar",width:50,height:m,x:0,y:b-m}).style({fill:a[e].color,"z-index":-1});l.push(g),b-=m}}var n=h.height+30-j.currentVal/d.max_value*h.height;j.currentLabel.attr("y",n),j.currentLabel.text(j.currentVal+" "+d.units),j.indicator.attr("y",n-10)}j.minLabel.text(d.min_value),j.maxLabel.text(d.max_value)},this.adjustBarLabels=function(){if(1===d.gauge_style){var a=j.currentVal/d.max_value*h.width;j.currentLabel.attr("x",a),j.indicator.attr("x",a)}if(2===d.gauge_style){var b=h.height+30-j.currentVal/d.max_value*h.height;j.currentLabel.attr("y",b),j.indicator.attr("y",b-10)}j.currentLabel.text(j.currentVal+" "+d.units)},this.render=function(a){b=$(a),b.css("width","100%"),f.html(d.title),b.append([f,e]),h.width=Math.floor(b.width())||(b.parent().parent().width()-b.parent().width())*(Number.parseInt(d.container_width)/100),h.height=Math.round(.5*h.width),h.padding.bottom=h.padding.top=Number.parseInt(b.css("padding-top")),h.padding.left=h.padding.right=Number.parseInt(b.css("padding-right")),d.gauge_varient=Number.parseInt(d.gauge_varient),d.gauge_style=Number.parseInt(d.gauge_style),d.units=d.units||"";var g=utils.parseJsonArray(d.gauge_segments);g.length>0?j.segments=g:c.applyDefaults(),setTimeout(function(){c.onSettingsChanged(d)},1e3),freeboard.resize()},this.onSettingsChanged=function(a){d=a,d.gauge_varient=Number.parseInt(d.gauge_varient),d.gauge_style=Number.parseInt(d.gauge_style),f.html(d.title);var b=utils.parseJsonArray(d.gauge_segments);b.length>0?j.segments=b:c.applyDefaults(),setTimeout(function(){c.renderGauge(),setTimeout(function(){freeboard.resize()},1e3)},1e3)},this.applyDefaults=function(){void 0===d.gauge_style||0===d.gauge_style?void 0===d.gauge_varient||0===d.gauge_varient?j.segments=[{share:.3,color:"#607D8B"},{share:.7,color:"#CCCCCC"}]:1===d.gauge_varient&&(j.segments=[{share:.4,color:"#569922"},{share:.25,color:"#FFF131"},{share:.25,color:"#CC5C2F"},{share:.1,color:"#AA3224"}]):1!==d.gauge_style&&2!==d.gauge_style||(void 0===d.gauge_varient||0===d.gauge_varient?j.segments=[{share:.3,color:"#607D8B"},{share:.7,color:"#CCCCCC"}]:1===d.gauge_varient&&(j.segments=[{share:.4,color:"#569922"},{share:.25,color:"#FFF131"},{share:.25,color:"#CC5C2F"},{share:.1,color:"#AA3224"}]))},this.onCalculatedValueChanged=function(a,b){j.currentVal=b,void 0===d.gauge_style||0===d.gauge_style?void 0===d.gauge_varient||0===d.gauge_varient?(j.segments[0].share=b/d.max_value,j.segments[1].share=1-j.segments[0].share,c.paintGauge(j.segments)):1===d.gauge_varient&&j.needle.moveTo(b/d.max_value):1!==d.gauge_style&&2!==d.gauge_style||(void 0===d.gauge_varient||0===d.gauge_varient?(j.segments[0].share=b/d.max_value,j.segments[1].share=1-j.segments[0].share,c.paintGauge(j.segments)):c.adjustBarLabels())},this.onDispose=function(){},this.getValue=function(){return j.currentVal},this.getHeight=function(){return utils.widget.calculateHeight(d.block_height)}};freeboard.loadWidgetPlugin({type_name:"gauge",display_name:"Gauge",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"],settings:[{name:"title",display_name:"Title",type:"text"},{name:"gauge_style",display_name:"Style",type:"option",options:[{name:"Arc",value:0},{name:"Bar - Horizontal",value:1},{name:"Bar - Vertical",value:2}]},{name:"gauge_varient",display_name:"Varient",type:"option",options:[{name:"Indicator",value:0},{name:"Segmented",value:1}]},{name:"gaugeVal",display_name:"Gauge Value",type:"data",multi_input:!0,incoming_parser:!0,force_data:"dynamic"},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"number",default_value:0},{name:"max_value",display_name:"Maximum",type:"number",default_value:100},{name:"title_color",display_name:"Title Color",type:"text",default_value:"#5EA7CF"},{name:"gauge_segments",display_name:"Gauge Segments",type:"text",default_value:"",description:'Provide in order the segment % share and associated color. Note: share % does not matter for indicator. Defaults: <br/>indicator: <br /> [ <br />  { "share": 0.40, "color": "#569922" }, <br />  { "share": 0.25, "color": "#FFF131" }<br /> ]<br />segmented: <br /> [ <br />  { "share": 0.40, "color": "#569922" }, <br />  { "share": 0.25, "color": "#FFF131" }, <br />  { "share": 0.25, "color": "#CC5C2F" }, <br />  { "share": 0.10, "color": "#AA3224" }<br /> ]'},{name:"needle_color",display_name:"Needle Color",type:"text",default_value:"#444444"},{name:"label_color",display_name:"Label Color",type:"text",default_value:"#5EA7CF"},{name:"block_height",display_name:"Block Height",type:"number",default_value:4},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new gaugeWidget(a))}}),freeboard.loadWidgetPlugin({type_name:"grouping_list",display_name:"Grouping List",fill_size:!1,description:"Easily group an array of objects by specific key/value pairs on the object. Also will nest groupings as much as you like.",settings:[{name:"list_name",display_name:"List Name",type:"text"},{name:"list_data",display_name:"List Source",type:"data",incoming_parser:!0,multi_input:!0},{name:"selected_item",display_name:"Selected Item",type:"data",force_data:"dynamic",outgoing_parser:!0,multi_input:!0},{name:"status_attribute",display_name:"Status Attribute",type:"text",description:"Attribute used to display status type styling (If value is true, then background will have green highlighting, if false, then it will be red). Leave blank if you don't care about this."},{name:"group_by_attributes",display_name:"Group By Attributes",type:"text",description:"An Array of strings defining what attribute(s) to group by on the provided array of objects."},{name:"block_height",display_name:"Block Height",type:"number",default_value:4},{name:"container_width",display_name:"Container Width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new groupingListWidgetPlugin(a,c))}});var groupingListWidgetPlugin=function(a,b){var c,d=this,e=a;d.rawData={};var f,g=$("<h2>").addClass("section-title").text(e.list_name).css("margin-bottom","3px"),h=$("<ul>");_.mixin({groupByMulti:function(a,b,c){if(!b.length)return a;var d=_.groupBy(a,b[0],c),e=b.slice(1);for(var f in d)d[f]=_.groupByMulti(d[f],e,c);return d}});var i=function(a){var d=$("<ul>").addClass("grouping-list-widget"),a=utils.parseJsonArray(a),g=function(a){a.stopPropagation(),$(this).children().toggleClass("hidden")};for(var h in a)if(a.hasOwnProperty(h))if(Array.isArray(a[h])){var j=$("<li>").addClass("grouping-list-widget-group-name").on("click",g).text(h),k=$("<ul>").addClass("grouping-list-widget hidden");j.append(k);for(var l=0;l<a[h].length;l++){var m=$("<li>");if(void 0!==e.status_attribute&&""!==e.status_attribute){var n=$("<div>").addClass("status");a[h][l][e.status_attribute]?n.addClass("positive"):n.addClass("negative"),m.append(n)}m.append($("<span>").text(a[h][l].name)),m.addClass("grouping-list-widget-item").on("click",{item:a[h][l]},function(a){a.stopPropagation(),c=a.data.item,f&&f.removeClass("active"),f=$(this),f.addClass("active"),b(a.data.item,e.selected_item)}),k.append(m)}d.append(j)}else{var j=$("<li>").addClass("grouping-list-widget-group-name").text(h).on("click",g),o=i(a[h]);j.append(o.addClass("hidden")),d.append(j)}return d};d.render=function(a){$(a).addClass("grouping-list-container").append([g,h])},d.getHeight=function(){return utils.widget.calculateHeight(e.block_height)},d.getValue=function(){return c},d.onCalculatedValueChanged=function(a,b){if(!_.isEqual(b,this.rawData)){this.rawData=b;var c=i(_.groupByMulti(b,utils.parseJsonArray(e.group_by_attributes)));h.replaceWith(c),h=c}},d.onSettingsChanged=function(a){e=a;var b=i(_.groupByMulti(this.rawData,utils.parseJsonArray(e.group_by_attributes)));h.replaceWith(b),h=b,g.text(e.list_name)}};freeboard.loadWidgetPlugin({type_name:"novi_input",display_name:"Input",description:"Link an HTML5 input field to a datasource for updates/publishes.",fill_size:!1,settings:[{name:"sectionTitle",display_name:"Title",type:"text"},{name:"inputType",display_name:"Input Type",type:"option",options:[{name:"button",value:"button"},{name:"checkbox",value:"checkbox"},{name:"color",value:"color"},{name:"date",value:"date"},{name:"datetime-local",value:"dateLocal"},{name:"email",value:"email"},{name:"month",value:"month"},{name:"number",value:"number"},{name:"password",value:"password"},{name:"range",value:"range"},{name:"search",value:"search"},{name:"select",value:"select"},{name:"telephone",value:"tel"},{name:"text",value:"text"},{name:"textarea",value:"textarea"},{name:"time",value:"time"},{name:"url",value:"url"},{name:"week",value:"week"}]},{name:"inputVal",display_name:"Value",type:"data",force_data:"dynamic",incoming_parser:!0,outgoing_parser:!0},{name:"attributes",display_name:"Relevant Attributes",type:"text",description:"Provide range, options, and other relevant input attributes."},{name:"blockHeight",display_name:"Block Height",type:"number",default_value:2},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new InputWidgetPlugin(a,c))}});var InputWidgetPlugin=function(a,b){var c=this,d=a.sectionTitle||"",e=a,f=$("<h2>").addClass("section-title").text(d).css("margin-bottom","3px"),g=$("<input>");this.renderInput=function(){var a=utils.parseJsonObject(e.attributes),b=$("<input>"),d=function(a){13===a.keyCode&&b.blur()};switch(e.inputType){case"button":b=$("<input>").attr({type:"button"}).css({width:"95%"}).on("click",c.onEvent);break;case"checkbox":b=$("<input>").attr({type:"checkbox"}).css({width:"95%"}).on("change",c.onEvent).keyup(function(a){d(a)}),void 0!==a.checked&&b.prop("checked","true"==a.checked);break;case"color":b=$("<input>").attr({type:"color"}).css({width:"95%"}).on("change",c.onEvent).keyup(function(a){d(a)});break;case"date":b=$("<input>").attr({type:"date"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"dateLocal":b=$("<input>").attr({type:"datetime-local"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"email":b=$("<input>").attr({type:"email"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"month":b=$("<input>").attr({type:"month"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"number":b=$("<input>").attr({type:"number"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)}),void 0!==a.min&&b.attr("min",a.min),void 0!==a.max&&b.attr("max",a.max);break;case"password":b=$("<input>").attr({type:"password"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"range":b=$("<input>").attr({type:"range"}).css({width:"95%","margin-top":"5px"}).on("change",c.onEvent).val(e.inputVal),void 0!==a.min&&b.attr("min",a.min),void 0!==a.max&&b.attr("max",a.max),void 0!==a.step&&b.attr("step",a.step);break;case"search":b=$("<input>").attr({type:"search"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"select":if(b=$("<select>").css({width:"95%"}).on("change",c.onEvent),void 0===a.options){console.error("Select missing options");break}for(var f=a.selected||"",g=0,h=a.options.length;g<h;g++){var i=a.options[g];b.append($("<option>").val(i).text(i).prop("selected",i===f))}break;case"tel":b=$("<input>").attr({type:"tel"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"text":b=$("<input>").attr({type:"text"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"time":b=$("<input>").attr({type:"time"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"url":b=$("<input>").attr({type:"url"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"week":b=$("<input>").attr({type:"week"}).css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)});break;case"textarea":b=$("<textarea>").css({width:"95%"}).on("blur",c.onEvent).keyup(function(a){d(a)}),void 0!==a.rows&&b.attr("rows",a.rows);break;default:console.error("Invalid input type")}return b},this.render=function(a){$(a).empty(),g=c.renderInput(),$(a).append(f).append(g)},this.getHeight=function(){return e.blockHeight=e.blockHeight||1,utils.widget.calculateHeight(e.blockHeight)},this.onSettingsChanged=function(a){e=a,f.text(e.sectionTitle);var b=c.renderInput();g.replaceWith(b),g=b,freeboard.resize()},this.onCalculatedValueChanged=function(a,b){g.val(b)},this.onDispose=function(){},this.getValue=function(){try{return g.val()}catch(b){var a=void 0!==e.sectionTitle&&""!==e.sectionTitle?' with title: "'+e.sectionTitle+'"':"";return console.error("Unable to retrieve value for "+e.inputType+" input"+a+"."),console.error(b),{}}},this.onEvent=function(){b(c.getValue())}};freeboard.loadWidgetPlugin({type_name:"lineGraph",display_name:"Line Graph",description:"A line graph generated from input data",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"],settings:[{name:"graphTitle",display_name:"Graph Title",type:"text"},{name:"data",display_name:"Data",type:"data",multi_input:!0,incoming_parser:!0,description:'expected format: [ { "x": 1, "y": 2 }, { "x": 2, "y": 4 }, { "x": 3, "y": 8 } ] '},{name:"sizeInBlocks",display_name:"Size in Blocks",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:4},{name:"rangeTitle",display_name:"Range Title",type:"text",default_value:""},{name:"domainTitle",display_name:"Domain Title",type:"text",default_value:""},{name:"title_color",display_name:"Title Color",type:"text",default_value:"#5EA7CF"},{name:"axis_color",display_name:"Axis Color",type:"text",default_value:"#CCCCCC"},{name:"line_color",display_name:"Line Color",type:"text",default_value:"#5EA7CF"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new lineGraph(a,c))}});var lineGraph=function(a,b){var c,d=this,e=a,f=60,g=$("<div>").addClass("barGraphContainer"),h=$("<h2>").addClass("section-title").css("text-align","center"),i=d3.select(g[0]).append("svg"),j=function(){g.html(""),i.remove();var a={top:20,right:25,bottom:70,left:55},b=g.width()-a.left-a.right,d=g.height()-a.top-a.bottom;i=d3.select(g[0]).append("svg").attr("width",b+a.left+a.right).attr("height",d+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");var f=utils.graph.formatInput(c),j=d3.scale.ordinal().rangeRoundBands([0,b]),k=d3.scale.linear().range([d,0]),l=d3.svg.axis().scale(j).orient("bottom"),m=d3.svg.axis().scale(k).orient("left"),n=d3.svg.line().x(function(b){return j(b.x)+(a.right+8)}).y(function(a){return k(a.y)});j.domain(f.map(function(a){return a.x})),k.domain([0,d3.max(f,function(a){return a.y})]),i.append("path").attr("class","line").attr("d",n(f)),i.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(l),i.append("g").attr("class","y axis").call(m),i.append("text").attr("class","axisLabel").attr("transform","rotate(-90)").attr("y",5).attr("dy",".71em").style("text-anchor","end").text(e.rangeTitle),i.append("text").attr("class","axisLabel").attr("x",b/2).attr("y",d+35).style("text-anchor","middle").text(e.domainTitle),i.selectAll(".line").style({stroke:e.line_color}),i.selectAll(".axis , .axis text").style({fill:e.axis_color}),i.selectAll(".axis line, .axis path").style({stroke:e.axis_color}),i.selectAll("text.axisLabel").style({fill:e.title_color}),h.css("color",e.title_color)};d.render=function(a){$(a).html(""),h.text(e.graphTitle),g.css({width:"100%",height:f*e.sizeInBlocks+"px"}),$(a).append([h,g]),setTimeout(function(){j()},300)},d.getHeight=function(){var a=e.sizeInBlocks?e.sizeInBlocks:4;return utils.widget.calculateHeight(a)},d.getValue=function(){return c},d.onSettingsChanged=function(a){e=a,e.sizeInBlocks=utils.widget.calculateHeight(e.sizeInBlocks),d.render()},d.onCalculatedValueChanged=function(a,b){c=b,d.render()},d.onDispose=function(){}};freeboard.loadWidgetPlugin({type_name:"collection_list",display_name:"List",fill_size:!1,description:'Expects an array of items in the format [ {"label": "String", "value" : AnyObject } ] where value is sent to the local_var on item click.',settings:[{name:"list_name",display_name:"List Name",type:"text"},{name:"listData",display_name:"List Source",type:"data",incoming_parser:!0,multi_input:!0},{name:"local_var",display_name:"Local Variable",type:"data",force_data:"dynamic",outgoing_parser:!0,multi_input:!0},{name:"track_attribute",display_name:"Tracking Column Name",type:"text",description:"Attribute used to identify active item."},{name:"blockHeight",display_name:"Block Height",type:"number",default_value:4},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],default_parsers:{clearblade_collection:{incoming:'// Defualt incoming parser for use with a ClearBlade Collection datasource. Generates a list using "item_id" as a label and the row data as the value, then sorts by alphanumeric order.\nif(this.datasource === undefined){return;}\nvar fmtData = [];\nvar len = this.datasource.length;\nfor(var i = 0; i < len; i++){\nfmtData.push({"label": this.datasource[i].data.item_id , "value": this.datasource[i].data});\n}\nfmtData.sort(function(a,b) {return (a.label > b.label) ? 1 : ((b.label > a.label) ? -1 : 0);} );\nreturn fmtData;'}},newInstance:function(a,b,c){b(new listWidgetPlugin(a,c))}});var listWidgetPlugin=function(a,b){var c,d=this,e=a,f=$("<h2>").addClass("section-title").text(a.list_name).css("margin-bottom","3px"),g=$("<ul>"),h=function(a){var d=$("<ul>").css({padding:"0px"}).addClass("list-widget"),f=utils.parseJsonArray(a),g=f.length;if(g)for(var h=0;h<g;h++){var i=$("<li>").text(f[h].label).addClass("list-widget-item").on("click",{idx:h,item:f[h].value},function(a){c=a.data.item,$(this).siblings(".list-widget-item").removeClass("active"),$(this).toggleClass("active"),b(a.data.item,e.local_var)});void 0!==c&&void 0!==e.track_attribute&&c[e.track_attribute]===f[h].value[e.track_attribute]&&i.addClass("active"),d.append(i)}else console.error("List missing data");return d};d.render=function(a){g=h(e.listData),$(a).css("overflow","auto").append([f,g])},d.getHeight=function(){return utils.widget.calculateHeight(e.blockHeight)},d.onSettingsChanged=function(a){e=a;var b=h(e.listData);g.replaceWith(b),g=b,f.text(e.list_name)},d.getValue=function(){return c},d.onCalculatedValueChanged=function(a,b){var c=h(b);g.replaceWith(c),g=c},d.onDispose=function(){}};freeboard.addStyle(".gm-style-cc a","text-shadow:none;");var googleMapWidget1=function(a,b){var c,d,e,f=this,g=a,h=g.apiKey,i={},j="";f.getValue=function(){return i},f.initializeMap=function(){var a={},f=[],h=new google.maps.LatLngBounds;if(void 0!==e){try{a=JSON.parse(e)}catch(b){a=e}if(void 0===a||void 0===a.markers)return void console.warn("Map source invalid");if(void 0===a.markers[0])return void console.warn("Map source invalid. Must provide at least one marker");var j=void 0!==a.zoom?a.zoom:16,k={zoom:j,center:a.markers[0],mapTypeId:google.maps.MapTypeId.ROADMAPX};c=new google.maps.Map(d,k);for(var l=0,m=a.markers.length;l<m;l++){if("standardMap"===g.map_type){new google.maps.Marker({position:a.markers[l],map:c})}f.push(new google.maps.LatLng(a.markers[l].lat,a.markers[l].lng)),h.extend(a.markers[l])}if(void 0===a.zoom&&c.fitBounds(h),"heatMap"===g.map_type){new google.maps.visualization.HeatmapLayer({data:f,map:c}).setMap(c)}c.addListener("click",function(a){var d=a.latLng;new google.maps.Marker({position:d,map:c}),i={lat:d.lat(),lng:d.lng()},b(i,"location_source")})}},f.render=function(a){d=a,j="https://maps.googleapis.com/maps/api/js?v=3.exp&key="+h+"&libraries=visualization",mapLoader(j,f.initializeMap)},f.onSettingsChanged=function(a){void 0!==a.location_source&&""!==a.location_source||void 0===g.location_source||""===g.location_source||(a.location_source=g.location_source),g=a,"static"==g._datatype&&(e=g.location_source),void 0!==c&&mapLoader(j,f.initializeMap)},f.onCalculatedValueChanged=function(a,b){b!==e&&(e=b,mapLoader(j,f.initializeMap))},f.onDispose=function(){},f.getHeight=function(){return utils.widget.calculateHeight(4)},this.onSettingsChanged(a)};freeboard.loadWidgetPlugin({type_name:"google_map1",display_name:"Google Map",fill_size:!0,settings:[{name:"map_name",display_name:"Map Name",type:"text",required:!0},{name:"map_type",display_name:"Map Type",type:"option",options:[{name:"Simple Map",value:"standardMap"},{name:"Heat Map",value:"heatMap"}]},{name:"location_source",display_name:"Location Source",type:"data",multi_input:!0,incoming_parser:!0,outgoing_parser:!0},{name:"apiKey",display_name:"API Key",type:"text",required:!0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new googleMapWidget1(a))}}),freeboard.loadWidgetPlugin({type_name:"pieChart",display_name:"Pie Chart",description:"A pie chart generated from input data",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"],settings:[{name:"graphTitle",display_name:"Graph Title",type:"text"},{name:"data",display_name:"Data",type:"data",multi_input:!0,incoming_parser:!0,description:'expected format: [ { "x": 1, "y": 2 }, { "x": 2, "y": 4 }, { "x": 3, "y": 8 } ] '},{name:"include_legend",display_name:"Include Legend",type:"boolean",default_value:!0},{name:"sizeInBlocks",display_name:"Size in Blocks",description:"Blocks are 60px, fractions are not allowed. eg: 1.5 will be cast to 2",type:"number",default_value:4},{name:"colors",display_name:"Slice Colors",type:"text",description:'Array of slice colors: ["#FFFFFF", "white"]  Note: If more slices than colors, colors will be reused. (leave blank for 20 random colors)'},{name:"label_color",display_name:"Label Color",default_value:"#000000",type:"text"},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new pieChart(a,c))}});var pieChart=function(a,b){var c,d=a,e=$("<div>").addClass("pieChartContainer"),f=$("<h2>").addClass("section-title").css("text-align","center"),g=$("<div>").css({display:"block",position:"absolute",bottom:"20px",overflow:"auto",padding:"5px",background:"rgba(0,0,0,0.30)"}),h=d3.select(e[0]).append("svg"),i=function(){e.html(""),h.remove(),h=d3.select(e[0]).append("svg");var a,b,i,j,k,l,m,n,o;if(b=utils.parseJsonArray(d.colors),i=b.length?d3.scale.ordinal().range(b):d3.scale.category20c(),j=utils.graph.formatInput(c),o=e.width(),h.attr("width",o).attr("height",o),a=.35*o,n=a+.1*o,k=h.data([j]).append("svg:g").attr("transform","translate("+n+","+a+")"),l=d3.layout.pie().value(function(a){return a.y}),m=d3.svg.arc().outerRadius(a),g.html(""),d.include_legend)var p=[];var q=k.selectAll("g.slice").data(l).enter().append("svg:g").attr("class","slice");q.append("svg:path").attr("fill",function(a,b){return i(b)}).attr("d",function(a){return m(a)}),q.append("svg:text").attr("transform",function(b){return b.innerRadius=0,b.outerRadius=a,"translate("+m.centroid(b)+")"}).attr("text-anchor","middle").text(function(a,b){if(!d.include_legend)return g.css("display","none"),j[b].x;if(-1==p.indexOf(j[b].x)){var c=$("<li>"),f=$("<span>").css({display:"inline-block",width:"20px",height:"20px",background:i(b)}),h=$("<span>").text(j[b].x).css({color:d.label_color,display:"inline-block","vertical-align":"top","margin-left":"5px","line-height":"20px"});c.append([f,h]),g.css({"max-height":.6*e.height(),right:.3*o}).append(c),p.push(j[b].x)}}),h.selectAll(".slice text").style({fill:d.label_color}),f.css("color",d.label_color)};this.render=function(a){$(a).html(""),f.html(d.graphTitle),e.css({width:"100%"}),g.html(""),$(a).append([f,e,g]),setTimeout(function(){i()},300)},this.getHeight=function(){var a=d.sizeInBlocks?d.sizeInBlocks:4;return utils.widget.calculateHeight(a)},this.getValue=function(){return c},this.onSettingsChanged=function(a){d=a,d.sizeInBlocks=utils.widget.calculateHeight(d.sizeInBlocks),this.render()},this.onCalculatedValueChanged=function(a,b){c=b,this.render()},this.onDispose=function(){},i()},SpeechRecognition=SpeechRecognition||webkitSpeechRecognition;freeboard.loadWidgetPlugin({type_name:"speech_recognition",display_name:"Speech Recognition",description:"Convert speech to text",fill_size:!1,settings:[{name:"inputVal",display_name:"Event Target",type:"data",force_data:"dynamic",outgoing_parser:!0},{name:"blockHeight",display_name:"Block Height",type:"number",default_value:2},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b,c){b(new SpeechWidgetPlugin(a,c))}});var SpeechWidgetPlugin=function(a,b){function c(){f?(i.replaceWith(h),f=!1,j.stop()):(h.replaceWith(i),f=!0,j.start())}var d=a,e=null,f=!1,g=$("<button>").css({width:"100%",height:"50px"}),h=$("<img src='img/mic-mute.svg'>").addClass("speech-recognition-mic-icon"),i=$("<img src='img/mic.svg'>").addClass("speech-recognition-mic-icon glowing");g.append(h),g.on("click",c);var j=new SpeechRecognition;j.continuous=!0,j.lang="en-US",j.interimResults=!1,j.maxAlternatives=1,this.render=function(a){$(a).empty(),$(a).append(g)},j.onresult=function(a){var c=a.results.length-1;e=a.results[c][0].transcript,b(e)},j.onspeechend=function(){j.stop()},j.onerror=function(a){console.error("recognition error:",a.error),i.replaceWith(h),alertMessage("Error performing speech recognition: ",a.error)},this.getHeight=function(){return d.blockHeight=d.blockHeight||1,utils.widget.calculateHeight(d.blockHeight)},this.onSettingsChanged=function(a){d=a},this.onDispose=function(){},this.getValue=function(){return e}},speedometerWidgetPlugin=function(a){var b,c,d=this,e=a,f=Date.now()+"-speedometer",g=$('<h2 style="text-align: center; font-weight: bold; font-size: 20px; padding-top: 6%;">'+a.speedometerName+"</h2>"),h=$('<div id="'+f+'" style="width: 200px; height: 200px; padding-left: 15%; padding-top: 3%;"></div>');void 0==e.speedometerName&&g.html(""),c=void 0!==a.unit?$('<div style="text-align: center; font-weight: bold; padding-top: 2%;">'+a.unit+"</div>"):$('<div style="text-align: center; font-weight: bold; padding-top: 2%;"></div>'),d.render=function(a){$(a).append(g).append(h).append(c),b=new Speedometer(f,{theme:"default",max:parseInt(e.maxValue)}),b.draw()},d.getHeight=function(){return utils.widget.calculateHeight(5)},d.onSettingsChanged=function(a){e=a,b.rescale(parseInt(e.maxValue)),c.html(_.isUndefined(e.unit)?"":e.unit),g.html(_.isUndefined(e.speedometerName)?"":e.speedometerName),void 0==e.speedometerName&&g.html("")},d.onCalculatedValueChanged=function(a,c){b.update(parseInt(c))},d.onDispose=function(){},d.getValue=function(){}};freeboard.loadWidgetPlugin({type_name:"speedometer_widget",display_name:"Speedometer",description:"A speedometer widget for displaying speed",external_scripts:["plugins/thirdparty/controls.js","plugins/thirdparty/digitaldisplay.js","plugins/thirdparty/example.js","plugins/thirdparty/speedometer.js","plugins/thirdparty/tbe.js","plugins/thirdparty/xcanvas.js","plugins/thirdparty/themes/default.js"],fill_size:!0,settings:[{name:"speedometerName",display_name:"Speedometer Name",type:"text",required:!1},{name:"maxValue",display_name:"Maximum Value",type:"text",default_value:"100",description:"Maximum speed on the speedometer"},{name:"unit",display_name:"Unit",type:"text"},{name:"speedVal",display_name:"Speed Source",type:"data",multi_input:!0,incoming_parser:!0,default_value:0},{name:"container_width",display_name:"Container width",type:"integer",description:"Width of your widget's container as a percentage. Useful when juxtaposing widgets.",default_value:"100",required:!0}],newInstance:function(a,b){b(new speedometerWidgetPlugin(a))}}),freeboard.loadWidgetPlugin({type_name:"text_editor",display_name:"Text Editor",description:"Wire text to a datasource for updates/publishes",external_scripts:["lib/js/thirdparty/ckeditor/ckeditor.js"],fill_size:!1,settings:[{name:"sectionTitle",display_name:"Title",type:"text"},{name:"inputVal",display_name:"Value",type:"data",multi_input:!0,incoming_parser:!0,outgoing_parser:!0},{name:"size",display_name:"Size",type:"option",options:[{name:"Big",value:"big"}]}],newInstance:function(a,b,c){b(new TextEditorWidgetPlugin(a,c))}});var TextEditorWidgetPlugin=function(a,b){var c=this;void 0===a.sectionTitle?a.inputName="":a.inputName=a.sectionTitle.replace(/\s+/g,"-");var d=a,e=$('<div class="tw-display"></div>'),f=$('<h2 class="section-title tw-title tw-td">'+a.sectionTitle+"</h2>"),g=$("<textarea id='"+a.inputName+"'></textarea>"),h=document.createElement("script");h.type="text/javascript",h.text="var editor = CKEDITOR.replace('"+a.inputName+"');";var i=$('<input id="send" type="button" value="Save">');c.render=function(b){var d=CKEDITOR.instances[a.inputName];d&&d.destroy(!0),$(b).empty(),$(e).append($('<div class="tw-tr"></div>').append(f)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(g)).append(h)).append($('<div class="tw-tr"></div>').append(i)),i.on("click",c.onEvent),$(b).append(e)},c.getHeight=function(){if("big"==d.size)return 8},c.onSettingsChanged=function(a){d=a},c.onCalculatedValueChanged=function(a,b){CKEDITOR.instances[d.inputName].setData(b)},c.onDispose=function(){},c.getValue=function(){try{return CKEDITOR.instances[a.inputName].getData().replace(/<[^>]*>/g," ")}catch(a){return console.log("unable to get value from the textarea "+d.inputName),console.log(a),{}}},c.onEvent=function(){b(c.getValue())}};!function(){var a={circle:function(a,b,c){this.ellipse(a,b,c,c)},fillCircle:function(a,b,c){this.beginPath(),this.circle(a,b,c),this.fill()},strokeCircle:function(a,b,c){this.beginPath(),this.circle(a,b,c),this.stroke()},ellipse:function(a,b,c,d){var e=c/2*.5522848,f=d/2*.5522848,g=a+c,h=b+d,i=a+c/2,j=b+d/2;this.moveTo(a,j),this.bezierCurveTo(a,j-f,i-e,b,i,b),this.bezierCurveTo(i+e,b,g,j-f,g,j),this.bezierCurveTo(g,j+f,i+e,h,i,h),this.bezierCurveTo(i-e,h,a,j+f,a,j),this.closePath()},fillEllipse:function(a,b,c,d){this.beginPath(),this.ellipse(a,b,c,d),this.fill()},strokeEllipse:function(a,b,c,d){this.beginPath(),this.ellipse(a,b,c,d),this.stroke()},polygon:function(a){var b=a.length;if(1&b&&b--,!((b/=2)<=1)){this.moveTo(a[0],a[1]);for(var c=1;c<b;c++)this.lineTo(a[2*c+0],a[2*c+1])}},fillPolygon:function(a){this.beginPath(),this.polygon(a),this.fill()},strokePolygon:function(a){this.beginPath(),this.polygon(a),this.stroke()},boxedArc:function(a,b,c,d,e,f,g){this.save(),this.scale(c/d,d/c),this.arc(a+c/2,b+d/2,c/2,e,e+f,g),this.restore()},fillBoxedArc:function(a,b,c,d,e,f){this.beginPath(),this.boxedArc(a,b,c,d,e,f,counterClockWise),this.fill()},strokeBoxedArc:function(a,b,c,d,e,f,g){this.beginPath(),this.boxedArc(a,b,c,d,e,f,g),this.stroke()}};for(var b in a)CanvasRenderingContext2D.prototype[b]=a[b];var c={measureText:function(a){return this.mozMeasureText(a)},fillText:function(a,b,c){this.beginPath(),this.drawText(a,b,c),this.fill()},strokeText:function(a,b,c){this.beginPath(),this.drawText(a,b,c),this.stroke()},drawText:function(a,b,c){this.font&&(this.mozTextStyle=this.font),"center"==this.textAlignment?b-=this.measureText(a)/2:"right"==this.textAlignment&&(b=this.width-this.measureText(a)),this.save(),this.translate(b,c),this.mozPathText(a),this.restore()}};for(var b in c)CanvasRenderingContext2D.prototype[b]||(CanvasRenderingContext2D.prototype[b]=c[b]);this.G_vmlCanvasManager||(G_vmlCanvasManager={init:function(){},initElement:function(a){return a}})}();
function DialogBox(a,b,c,d,e,f){var g=$('<div id="modal_overlay" style="display:none;"></div>'),h=$('<div class="modal"></div>');this.closeModal=function(){g.fadeOut(200,function(){$(this).remove()})},"string"==typeof b?h.append('<header><h2 class="title">'+b+"</h2></header>"):h.append(b),$("<section></section>").appendTo(h).append(a);var i=$("<footer></footer>").appendTo(h);if(c){var j;j="string"==typeof c?$('<span id="dialog-ok" class="text-button">'+c+"</span>"):c,j.appendTo(i).click(function(){var a=!1;_.isFunction(e)&&(a=e()),a||this.closeModal()}.bind(this))}d&&$('<span id="dialog-cancel" class="text-button">'+d+"</span>").appendTo(i).click(function(){var a=!1;_.isFunction(f)&&(a=f()),a||this.closeModal()}.bind(this)),$(h).keyup(function(a){13==(a.keyCode?a.keyCode:a.which)&&$("#dialog-ok").trigger("click")}),g.append(h),$("body").append(g),g.fadeIn(200)}function FreeboardModel(a,b,c){var d=this;this.version=0,this.isEditing=ko.observable(!1),this.allow_edit=ko.observable(!1),this.allow_edit.subscribe(function(a){a?$("#main-header").show():$("#main-header").hide()}),this.header_image=ko.observable(),this.plugins=ko.observableArray(),this.datasources=ko.observableArray(),this.panes=ko.observableArray(),this.userPerms={},this.datasourceData={},this.processDatasourceUpdate=function(a,b){var c=a.name();d.datasourceData[c]=b,_.each(d.panes(),function(a){_.each(a.tabs(),function(a){_.each(a.widgets(),function(a){a.processDatasourceUpdate(c,b)})})})},this._datasourceTypes=ko.observable(),this.datasourceTypes=ko.computed({read:function(){d._datasourceTypes();var b=[];return _.each(a,function(a){var c=a.type_name,d=c;_.isUndefined(a.display_name)||(d=a.display_name),b.push({name:c,display_name:d})}),b}}),this._widgetTypes=ko.observable(),this.widgetTypes=ko.computed({read:function(){d._widgetTypes();var a=[];return _.each(b,function(b){var c=b.type_name,d=c;_.isUndefined(b.display_name)||(d=b.display_name),a.push({name:c,display_name:d})}),a}}),this.addPluginSource=function(a){a&&-1==d.plugins.indexOf(a)&&d.plugins.push(a)},this.serialize=function(){var a=[];_.each(d.panes(),function(b){a.push(b.serialize())});var b=[];return _.each(d.datasources(),function(a){b.push(a.serialize())}),{version:1,header_image:d.header_image(),allow_edit:d.allow_edit(),plugins:d.plugins(),panes:a,datasources:b,columns:c.getUserColumns(),userPerms:d.userPerms}},this.deserialize=function(e,f){function g(){_.isUndefined(e.allow_edit)?d.allow_edit(!0):d.allow_edit(e.allow_edit),d.version=e.version||0,d.header_image(e.header_image),_.each(e.datasources,function(b){var c=new DatasourceModel(d,a);c.deserialize(b),d.addDatasource(c)});var g=_.sortBy(e.panes,function(a){return c.getPositionForScreenSize(a).row});_.each(g,function(a){var c=new PaneModel(d,b);c.deserialize(a),d.panes.push(c)}),void 0!==e.userPerms?d.userPerms=e.userPerms:d.userPerms={editableAttributes:{},passwordMod:!1},d.allow_edit()&&0==d.panes().length&&d.setEditing(!0),_.isFunction(f)&&f(),c.processResize(!0)}d.clearDashboard(),c.setUserColumns(e.columns),c.updateGridWidth(e.columns),_.each(e.plugins,function(a){d.addPluginSource(a)}),_.isArray(e.plugins)&&e.plugins.length>0?head.js(e.plugins,function(){g()}):g()},this.clearDashboard=function(){c.removeAllPanes(),_.each(d.datasources(),function(a){a.dispose()}),_.each(d.panes(),function(a){a.dispose()}),d.plugins.removeAll(),d.datasources.removeAll(),d.panes.removeAll()},this.getUserPermission=function(){return d.userPerms},this.setUserPermission=function(a){return d.userPerms=a},this.loadDashboard=function(a,b){c.showLoadingIndicator(!0),d.deserialize(a,function(){c.showLoadingIndicator(!1),_.isFunction(b)&&b(),freeboard.emit("dashboard_loaded")})},this.loadDashboardFromLocalFile=function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var a=document.createElement("input");a.type="file",$(a).on("change",function(a){var b=a.target.files;if(b&&b.length>0){var c=b[0],e=new FileReader;e.addEventListener("load",function(a){var b=a.target,c=JSON.parse(b.result);d.loadDashboard(c),d.setEditing(!1)}),e.readAsText(c)}}),$(a).trigger("click")}else alert("Unable to load a file in this browser.")},this.saveDashboard=function(a,b){var c=$(b.currentTarget).data("pretty"),e="application/octet-stream",f=document.createElement("a");if(c)var g=new Blob([JSON.stringify(d.serialize(),null,"\t")],{type:e});else var g=new Blob([JSON.stringify(d.serialize())],{type:e});document.body.appendChild(f),f.href=window.URL.createObjectURL(g),f.download="dashboard.json",f.target="_self",f.click()},this.addDatasource=function(a){d.datasources.push(a)},this.deleteDatasource=function(a){delete d.datasourceData[a.name()],a.dispose(),d.datasources.remove(a)},this.createPane=function(){window.Need_Save=!0;var a=new PaneModel(d,b);d.addPane(a)},this.addGridColumnLeft=function(){c.addGridColumnLeft()},this.addGridColumnRight=function(){c.addGridColumnRight()},this.subGridColumnLeft=function(){c.subGridColumnLeft()},this.subGridColumnRight=function(){c.subGridColumnRight()},this.addPane=function(a){d.panes.push(a)},this.deletePane=function(a){a.dispose(),d.panes.remove(a)},this.deleteWidget=function(a){ko.utils.arrayForEach(d.panes(),function(b){b.widgetRemove(a)}),a.dispose()},this.setEditing=function(a,b){if(d.allow_edit()||!a){d.isEditing(a),_.isUndefined(b)&&(b=!0);var e=b?250:0,f=$("#admin-bar").outerHeight();a?($("#toggle-header-icon").addClass("icon-chevron-up").removeClass("icon-wrench"),$(".gridster .gs_w").css({cursor:"pointer"}),$("#main-header").animate({top:"0px"},e),$("#board-content").animate({top:f+20+"px"},e),$("#main-header").data().shown=!0,$(".editTool").show(),c.attachWidgetEditIcons($(".sub-section")),c.showPaneEditIcons(!0),c.enableGrid()):($("#toggle-header-icon").addClass("icon-wrench").removeClass("icon-chevron-up"),$(".gridster .gs_w").css({cursor:"default"}),$("#main-header").animate({top:"-"+f+"px"},e),$("#board-content").animate({top:"20"},e),$("#main-header").data().shown=!1,$(".sub-section").unbind(),$(".editTool").hide(),c.showPaneEditIcons(!1),c.disableGrid()),c.showPaneEditIcons(a,b)}},this.toggleEditing=function(){var a=!d.isEditing();d.setEditing(a)}}function FreeboardUI(){function a(a){var b=e(),c=function(){};a&&(c=function(a){var c=this,d=ko.dataFor(c),e=q(d);$(c).attr("data-sizex",Math.min(d.col_width(),b,r.cols)).attr("data-row",e.row).attr("data-col",e.col),d.processSizeChange()}),f(Math.min(b,w)),g(c),d()}function b(a){f(r.cols+1)&&(window.Need_Save=!0,g(function(){var b,c=this,d=ko.dataFor(c),e=r.cols>1?r.cols-1:1,f=d.col[e],g=d.row[e];a?(leftPreviewCol=!0,b={row:g,col:f<r.cols?f+1:r.cols}):(rightPreviewCol=!0,b={row:g,col:f}),$(c).attr("data-sizex",Math.min(d.col_width(),r.cols)).attr("data-row",b.row).attr("data-col",b.col)})),d(),w=r.cols}function c(a){f(r.cols-1)&&g(function(){window.Need_Save=!0;var b,c=this,d=ko.dataFor(c),e=r.cols+1,f=d.col[e],g=d.row[e];if(a){var h=f>1?f-1:1;b={row:g,col:h}}else{var h=f<=r.cols?f:r.cols;b={row:g,col:h}}$(c).attr("data-sizex",Math.min(d.col_width(),r.cols)).attr("data-row",b.row).attr("data-col",b.col)}),d(),w=r.cols}function d(){var a=$(".column-tool"),b=$("#board-content").width(),c=Math.floor(b/v);r.cols<=u?a.addClass("min"):a.removeClass("min"),r.cols>=c?a.addClass("max"):a.removeClass("max")}function e(){var a=$("#board-content").width();return Math.floor(a/v)}function f(a){(void 0===a||a<u)&&(a=u);var b=e();a>b&&(a=b);var c=v*a+a;return $(".responsive-column-width").css("max-width",c),y=a,a!==r.cols}function g(a){var b=r.$el;b.find("> li").unbind().removeData(),$(".responsive-column-width").css("width",""),r.generate_grid_and_stylesheet(),b.find("> li").each(a),r.init(),$(".responsive-column-width").css("width",r.cols*t+r.cols*s*2)}function h(){return w}function i(a){w=Math.max(u,a)}function j(a,b,c){var d=q(b),e=d.col,f=d.row,g=Number(b.width()),h=Number(b.getCalculatedHeight());r.add_widget(a,g,h,e,f),c&&n(!0),l(b,f,e),$(a).addClass("pane"),$(a).attrchange({trackValues:!0,callback:function(a){"data-row"==a.attributeName?l(b,Number(a.newValue),void 0):"data-col"==a.attributeName&&l(b,void 0,Number(a.newValue))}})}function k(a,b){var c=b.getCalculatedHeight(),d=Number($(a).attr("data-sizey")),e=Number($(a).attr("data-sizex")),f=Number.parseInt(b.col_width());c==d&&f==e||r.resize_widget($(a),f,c,function(){r.set_dom_grid_height()})}function l(a,b,c){var d=r.cols;_.isUndefined(b)||(a.row[d]=Number.parseInt(b)),_.isUndefined(c)||(a.col[d]=Number.parseInt(c))}function m(a){a?x.fadeOut(0).appendTo("body").fadeIn(500):x.fadeOut(500).remove()}function n(a,b){_.isUndefined(b)&&(b=!0);var c=b?250:0;a?($(".pane-tools").css("display","block").animate({opacity:1},c),$("#column-tools").fadeIn(c),$(".hidden-header-toolbar").fadeIn(c)):($(".pane-tools").animate({opacity:0},c).css("display","none"),$("#column-tools").fadeOut(c),$(".hidden-header-toolbar").fadeOut(c))}function o(a){$(a).hover(function(){p(this,!0)},function(){p(this,!1)})}function p(a,b){b?$(a).find(".sub-section-tools").fadeIn(250):$(a).find(".sub-section-tools").fadeOut(250)}function q(a){var b=y;if(_.isNumber(a.row)&&_.isNumber(a.col)){var c={};c[b]=a.row,a.row=c,c={},c[b]=a.col,a.col=c}var d=1,e=1e3;for(var f in a.col){if(f==b)return{row:a.row[f],col:a.col[f]};if(a.col[f]>b)d=b;else{var g=b-f;g<e&&(d=f,e=g)}}return d in a.col&&d in a.row?{row:a.row[d],col:a.col[d]}:{row:1,col:d}}var r,s=10,t=300,u=3,v=s+t+s,w=u,x=$('<div class="wrapperloading"><div class="loading up" ></div><div class="loading down"></div></div>'),y=3;return ko.bindingHandlers.grid={init:function(b,c,d,e,f){r=$(b).gridster({widget_margins:[s,s],widget_base_dimensions:[t,10],resize:{enabled:!1,axes:"x"}}).data("gridster"),a(!1),r.disable()}},{showLoadingIndicator:function(a){m(a)},showPaneEditIcons:function(a,b){n(a,b)},attachWidgetEditIcons:function(a){o(a)},getPositionForScreenSize:function(a){return q(a)},processResize:function(b){a(b)},disableGrid:function(){r.disable()},enableGrid:function(){r.enable()},addPane:function(a,b,c){j(a,b,c)},updatePane:function(a,b){k(a,b)},removePane:function(a){r.remove_widget(a)},removeAllPanes:function(){r.remove_all_widgets()},addGridColumnLeft:function(){b(!0)},addGridColumnRight:function(){b(!1)},subGridColumnLeft:function(){c(!0)},subGridColumnRight:function(){c(!1)},getUserColumns:function(){return h()},setUserColumns:function(a){i(a)},updateGridWidth:function(a){f(a)}}}function PaneModel(a,b){var c=this;this.title=ko.observable(),this.pane_id=ko.observable(),this.width=ko.observable(1),this.display_header=ko.observable(2),this.header_theme=ko.observable("primary"),this.row={},this.col={},this.pane_type=ko.observable(),this.col_width=ko.observable(1),this.col_width.subscribe(function(a){c.processSizeChange()}),this.tabs=ko.observableArray(),this.currentTabIdx=ko.observable(0),this.tabs.push(new PaneTabModel(a,b)),this.currentTabIdx.subscribe(function(a){c.refreshWidgets(),c.processSizeChange()}),this.addWidget=function(a){c.tabs()[c.currentTabIdx()].addWidget(a)},this.refreshWidgets=function(){for(var a=c.tabs()[c.currentTabIdx()].widgets(),b=a.length,d=0;d<b;d++)a[d].shouldRender(!0)},this.widgetRemove=function(a){c.tabs()[c.currentTabIdx()].widgets.remove(a)},this.widgetCanMoveUp=function(a){return c.tabs()[c.currentTabIdx()].widgets.indexOf(a)>=1},this.widgetCanMoveDown=function(a){return c.tabs()[c.currentTabIdx()].widgets.indexOf(a)<c.tabs()[c.currentTabIdx()].widgets().length-1},this.moveWidgetUp=function(a){if(c.widgetCanMoveUp(a)){window.Need_Save=!0;var b=c.tabs()[c.currentTabIdx()].widgets,d=b().indexOf(a);b().splice(d-1,2,b()[d],b()[d-1]),b.valueHasMutated()}},this.moveWidgetDown=function(a){if(c.widgetCanMoveDown(a)){window.Need_Save=!0;var b=c.tabs()[c.currentTabIdx()].widgets,d=b().indexOf(a);b().splice(d,2,b()[d+1],b()[d]),b.valueHasMutated()}};var d=function(a){try{return parseInt(a.settings().container_width)}catch(a){return console.error("unable to get container_width for widget"),console.error(a),100}};this.processSizeChange=function(){var a;void 0!==c.tabs()[c.currentTabIdx()]&&setTimeout(function(){_.each(c.tabs()[c.currentTabIdx()].widgets(),function(b){a=d(b),b.parentElement&&a&&b.parentElement.css({"flex-basis":a+"%"}),b.processSizeChange()})},50)},this.getCalculatedHeight=function(){var a=0;if(void 0!==c.tabs()[c.currentTabIdx()])for(var b=c.tabs()[c.currentTabIdx()].widgets(),e=0,f=b.length,g=0,h=0,i=0,j=0;e<f;e++)g=d(b[e]),h=b[e].height(),j+=g,j>100&&(a+=i,i=0,j-=100,j=g),i=Math.max(h,i),100!==j&&e!==f-1||(a+=i,i=0,j=0);a*=6,a+=3,a*=10,1==c.pane_type()&&(a+=35);var k=Math.ceil((a+20)/30);return Math.max(4,k)},this.serialize=function(){for(var a=[],b=c.tabs(),d=0,e=b.length;d<e;d++)a.push(b[d].serialize());return{pane_type:c.pane_type(),title:c.title(),pane_id:c.pane_id(),width:c.width(),display_header:c.display_header(),header_theme:c.header_theme(),row:c.row,col:c.col,col_width:c.col_width(),tabs:a}},this.deserialize=function(d){c.pane_type(d.pane_type),c.tabs.removeAll(),c.title(d.title),c.pane_id(d.pane_id),c.width(d.width);var e=void 0===d.display_header||d.display_header;c.display_header(e);var f=void 0===d.header_theme?"primary":d.header_theme;if(c.header_theme(f),c.row=d.row,c.col=d.col,c.col_width(d.col_width||1),d.tabs){for(var g=0,h=d.tabs.length;g<h;g++){var i=new PaneTabModel(a,b);i.deserialize(d.tabs[g]),c.tabs.push(i)}c.currentTabIdx(0)}else{var j=new PaneTabModel(a,b);_.each(d.widgets,function(c){var d=new WidgetModel(a,b);d.deserialize(c),j.widgets.push(d)}),c.tabs.push(j),c.currentTabIdx(0)}},this.dispose=function(){_.each(c.tabs()[c.currentTabIdx()].widgets,function(a){a.dispose()})},this.addTab=function(d){c.tabs.push(new PaneTabModel(a,b)),c.currentTabIdx(c.tabs().length-1),d&&e($(d).parent())},this.editTab=function(a){var b={},d=c.tabs()[a],e=!1,f=$("<form>").on("submit",function(){return!1}),g=$("<input>").attr({type:"text",placeholder:"Tab Title"}).val(d.title()).addClass("form-input-row"),h=$("<input>").attr("type","button").val("Delete Tab").on("click",function(){new DialogBox($("<p>Are you sure you want to delete this tab?</p>"),"Confirm Delete","Yes","No",function(){e=!0,$("#dialog-ok").trigger("click")})});f.append([g,h]),b=new DialogBox(f,"Tab Editor","Save","Cancel",function(){return b.closeModal(),d.title(g.val()),e&&(1===c.tabs().length?c.pane_type(!1):a>0?(c.currentTabIdx(a-1),c.tabs.splice(a,1)):(c.tabs.splice(a,1),c.currentTabIdx(a))),!0})},this.updateCurrentTab=function(a){c.currentTabIdx(a)};var e=function(a){a.animate({scrollLeft:"+=1500"},500)};this.headerShouldDisplay=function(){return c.display_header()},this.headerShouldHide=function(){return!c.display_header()},this.getHeaderTheme=function(){return c.header_theme()}}function PaneTabModel(a,b){var c=this;this.title=ko.observable(),this.widgets=ko.observableArray(),this.addWidget=function(a){c.widgets.push(a)},this.serialize=function(){var a={};return a.title=c.title(),a.widgets=[],_.each(c.widgets(),function(b){a.widgets.push(b.serialize())}),a},this.deserialize=function(d){c.title(d.title),_.each(d.widgets,function(d){var e=new WidgetModel(a,b);e.deserialize(d),c.widgets().push(e)})}}function WidgetModel(a,b){function c(){_.isUndefined(e.widgetInstance)||(_.isFunction(e.widgetInstance.onDispose)&&e.widgetInstance.onDispose(),e.widgetInstance=void 0)}function d(a,b){try{return b&&(a="debugger;"+a),new Function("datasources","panes",a)}catch(b){return new Function("datasources","panes",'return "'+a+'";')}}var e=this,f={};this.datasourceRefreshNotifications={},this.calculatedSettingScripts={},this.title=ko.observable(),this.fillSize=ko.observable(!1),this.type=ko.observable(),this.type.subscribe(function(a){function d(){f.newInstance(e.settings(),function(a){e.fillSize(!0===f.fill_size),e.widgetInstance=a,e.shouldRender(!0),e._heightUpdate.valueHasMutated()},e.updateCallback)}if(c(),a in b&&_.isFunction(b[a].newInstance)){var f=b[a];f.external_scripts?head.js(f.external_scripts.slice(0),d):d()}}),this.settings=ko.observable({}),this.settings.subscribe(function(a){!_.isUndefined(e.widgetInstance)&&_.isFunction(e.widgetInstance.onSettingsChanged)&&e.widgetInstance.onSettingsChanged(a),e.updateCalculatedSettings(),e._heightUpdate.valueHasMutated()}),this.processDatasourceUpdate=function(a,b){e.datasourceRefreshNotifications[a]&&e.processCalculatedSetting(a,b)},_datasourceListToMap=function(a){var b={};if(a)for(var c=0,d=a.length;c<d;c++)b[a[c].name()]=a[c];return b},_paneListToMap=function(a){var b={};if(a)for(var c=0,d=a.length;c<d;c++)b[a[c].pane_id()]=a[c];return b};var g,h;this.callValueFunction=function(b,c){var d=_datasourceListToMap(a.datasources()),f=_paneListToMap(a.panes());try{g=d[c].latestData()}catch(a){console.warn("Unable to get the latest data for the datasource with name '"+c+".' Please make sure it implements the 'latestData' method."),console.warn(a)}try{h=this.widgetInstance.getValue()}catch(a){console.warn("Unable to get the value for the widget with type '"+e.type()+".' Please make sure it implements the 'getValue' method."),console.warn(a)}var i={datasource:g,widget:h};return b.call(i,d,f)},this.processSizeChange=function(){!_.isUndefined(e.widgetInstance)&&_.isFunction(e.widgetInstance.onSizeChanged)&&e.widgetInstance.onSizeChanged()},this.processCalculatedSetting=function(a,b){if(e.calculatedSettingScripts[a]){var c=void 0;if(b&&f[a]&&_.isEqual(b,f[a]))return;try{c=e.calculatedSettingScripts[a].incoming_parser&&_.isFunction(e.calculatedSettingScripts[a].incoming_parser)?e.callValueFunction(e.calculatedSettingScripts[a].incoming_parser,a):b}catch(a){console.error("Unable to execute incoming parser for widget of type "+this.type()),console.error(a)}if(!_.isUndefined(e.widgetInstance)&&_.isFunction(e.widgetInstance.onCalculatedValueChanged)&&!_.isUndefined(c))try{e.widgetInstance.onCalculatedValueChanged(e.calculatedSettingScripts[a].settingName,c)}catch(a){console.log(a.toString())}}},this.updateCalculatedSettings=function(){if(e.datasourceRefreshNotifications={},e.calculatedSettingScripts={},!_.isUndefined(e.type())){var a=b[e.type()].settings,c=e.settings();_.each(a,function(a){if("data"==a.type)if("static"===c._datatype)e.widgetInstance.onCalculatedValueChanged(a.name,c[a.name]);else if("dynamic"===c._datatype)for(var b=c[a.name],f=0,g=b.length;f<g;f++)if(!_.isUndefined(b[f].dsName)){var h={},i=b[f]._debug||!1;h.settingName=a.name,b[f].incoming_parser&&(e.datasourceRefreshNotifications[b[f].dsName]=b[f].dsName,h.incoming_parser=d(b[f].incoming_parser,i)),b[f].outgoing_parser&&(h.outgoing_parser=d(b[f].outgoing_parser,i)),e.calculatedSettingScripts[b[f].dsName]=h,e.processCalculatedSetting(b[f].dsName)}if("datasources"==a.type)for(var b=c[a.name],f=0,g=b.length;f<g;f++)if(!_.isUndefined(b[f].dsName)){var h={};h.settingName=a.name;var i=b[f]._debug||!1;b[f].incoming_parser&&(e.datasourceRefreshNotifications[b[f].dsName]=b[f].dsName,h.incoming_parser=d(b[f].incoming_parser,i)),b[f].outgoing_parser&&(h.outgoing_parser=d(b[f].outgoing_parser,i)),e.calculatedSettingScripts[b[f].dsName]=h,e.processCalculatedSetting(b[f].dsName)}})}},this._heightUpdate=ko.observable(),this.height=ko.computed({read:function(){return e._heightUpdate(),!_.isUndefined(e.widgetInstance)&&_.isFunction(e.widgetInstance.getHeight)?e.widgetInstance.getHeight():1}}),this.shouldRender=ko.observable(!1),this.render=function(a){this.parentElement=$(a).parent(),e.shouldRender(!1),!_.isUndefined(e.widgetInstance)&&_.isFunction(e.widgetInstance.render)&&(e.widgetInstance.render(a),e.updateCalculatedSettings())},this.dispose=function(){},this.serialize=function(){return{title:e.title(),type:e.type(),settings:e.settings()}},this.deserialize=function(a){e.title(a.title),e.settings(a.settings),e.type(a.type)},this.processAndSendData=function(a){var b=a.name();return this.calculatedSettingScripts[b].outgoing_parser&&_.isFunction(this.calculatedSettingScripts[b].outgoing_parser)&&(data=this.callValueFunction(this.calculatedSettingScripts[b].outgoing_parser,b)),f[b]=data,a.datasourceInstance.sendData(data)},this.updateCallback=function(a,c){var d,f=b[e.type()].settings,g=e.settings(),h=!1,i=[];if(c){h=!0;for(var j=0,k=c.length;j<k;j++)(d=freeboard.getDatasource(c[j].dsName))&&i.push(e.processAndSendData(d))}else _.each(f,function(a){if("data"===a.type&&"dynamic"===g._datatype){h=!0;for(var b=0,c=g[a.name].length;b<c;b++)(d=freeboard.getDatasource(g[a.name][b].dsName))&&i.push(e.processAndSendData(d))}});if(!h)if(c)for(var j=0,k=c.length;j<k;j++)(d=freeboard.getDatasource(c[j].dsName))&&i.push(e.processAndSendData(d));else for(var j=0,k=e.settings().datasources.length;j<k;j++)(d=freeboard.getDatasource(e.settings().datasources[j].dsName))&&i.push(e.processAndSendData(d));return $.when.apply($,i)}}DatasourceModel=function(a,b){function c(){_.isUndefined(e.datasourceInstance)||(_.isFunction(e.datasourceInstance.onDispose)&&e.datasourceInstance.onDispose(),e.datasourceInstance=void 0)}function d(a,b){try{return b&&(a="debugger;"+a),new Function("datasources",a)}catch(b){return new Function("datasources",'return "'+a+'";')}}var e=this,f={};this.datasourceRefreshNotifications={},this.calculatedSettingScripts={},this.name=ko.observable(),this.latestData=ko.observable(),this.settings=ko.observable({}),this.settings.subscribe(function(a){!_.isUndefined(e.datasourceInstance)&&_.isFunction(e.datasourceInstance.onSettingsChanged)&&e.datasourceInstance.onSettingsChanged(a),e.updateCalculatedSettings()}),this.processDatasourceUpdate=function(a,b){e.datasourceRefreshNotifications[a]&&e.processCalculatedSetting(a,b)},_datasourceListToMap=function(a){var b={};if(a)for(var c=0,d=a.length;c<d;c++)b[a[c].name()]=a[c];return b};var g;this.callValueFunction=function(b,c){var d=_datasourceListToMap(a.datasources());try{g=d[c].latestData()}catch(a){console.warn("Unable to get the latest data for the datasource with name '"+c+".' Please make sure it implements the 'latestData' method."),console.warn(a)}var e={datasource:g};return b.call(e,d)},this.processCalculatedSetting=function(a,b){if(e.calculatedSettingScripts[a]){var c=void 0;if(b&&f[a]&&_.isEqual(b,_lastSend[a]))return;try{c=e.calculatedSettingScripts[a].incoming_parser&&_.isFunction(e.calculatedSettingScripts[a].incoming_parser)?e.callValueFunction(e.calculatedSettingScripts[a].incoming_parser,a):b}catch(a){console.error("Unable to execute incoming parser for widget of type "+this.type()),console.error(a)}if(!_.isUndefined(e.datasourceInstance)&&_.isFunction(e.datasourceInstance.onCalculatedValueChanged)&&!_.isUndefined(c))try{e.datasourceInstance.onCalculatedValueChanged(e.calculatedSettingScripts[a].settingName,c)}catch(a){console.log(a.toString())}}},this.updateCalculatedSettings=function(){if(e.datasourceRefreshNotifications={},e.calculatedSettingScripts={},!_.isUndefined(e.type())){var a=b[e.type()].settings,c=e.settings();_.each(a,function(a){if("data"===a.type)if("static"===c._datatype)e.datasourceInstance.onCalculatedValueChanged(a.name,c[a.name]);else if("dynamic"===c._datatype)for(var b=c[a.name],f=0,g=b.length;f<g;f++)if(!_.isUndefined(b[f].dsName)){var h={},i=b[f]._debug||!1;h.settingName=a.name,b[f].incoming_parser&&(e.datasourceRefreshNotifications[b[f].dsName]=b[f].dsName,h.incoming_parser=d(b[f].incoming_parser,i)),b[f].outgoing_parser&&(h.outgoing_parser=d(b[f].outgoing_parser,i)),e.calculatedSettingScripts[b[f].dsName]=h,e.processCalculatedSetting(b[f].dsName)}})}},this.updateCallback=function(b){e.latestData(b);var c=new Date;e.last_updated(c.toLocaleTimeString()),a.processDatasourceUpdate(e,b);for(var d=freeboard.getDatasources(),f=0;f<d.length;f++)if(d[f].name()!=e.name()){var g=d[f].settings();for(var h in g)if(g.hasOwnProperty(h)&&_.isArray(g[h]))for(var i=0;i<g[h].length;i++)d[f].updateCalculatedSettings()}},this.type=ko.observable(),this.type.subscribe(function(a){function d(){f.newInstance(e.settings(),function(a){e.datasourceInstance=a,a.updateNow()},e.updateCallback)}if(c(),a in b&&_.isFunction(b[a].newInstance)){var f=b[a];f.external_scripts?head.js(f.external_scripts.slice(0),d):d()}}),this.last_updated=ko.observable("never"),this.last_error=ko.observable(),this.serialize=function(){return{name:e.name(),type:e.type(),settings:e.settings()}},this.deserialize=function(a){e.settings(a.settings),e.name(a.name),e.type(a.type)},this.getDataRepresentation=function(a){return new Function("data","return "+a+";").call(void 0,e.latestData())},this.updateNow=function(){!_.isUndefined(e.datasourceInstance)&&_.isFunction(e.datasourceInstance.updateNow)&&e.datasourceInstance.updateNow()},this.dispose=function(){c()},this.sendData=function(a,b){return $.when(e.datasourceInstance.sendData(a))},this.query=function(){if(!_.isUndefined(e.datasourceInstance)&&!_.isUndefined(e.datasourceInstance.query))return e.datasourceInstance.query},this.clearQuery=function(){!_.isUndefined(e.datasourceInstance)&&_.isFunction(e.datasourceInstance.clearQuery)&&e.datasourceInstance.clearQuery()}},DeveloperConsole=function(a){function b(){function b(a){var b=$("<tr></tr>"),d=$('<ul class="board-toolbar"></ul>'),e=$('<input class="table-row-value" style="width:100%;" type="text">'),f=$('<li><i class="icon-trash icon-white"></i></li>').click(function(a){c=_.without(c,e),b.remove()});c.push(e),a&&e.val(a),d.append(f),g.append(b.append($("<td></td>").append(e)).append($('<td class="table-row-operation">').append(d)))}var c=[],d=$("<div></div>"),e=$('<div class="table-operation text-button">ADD</div>'),f=$('<table class="table table-condensed sub-table"></table>');f.append($('<thead style=""><tr><th>Plugin Script URL</th></tr></thead>'));var g=$("<tbody></tbody>");f.append(g),d.append($("<p>Here you can add references to other scripts to load datasource or widget plugins.</p>")).append(f).append(e).append('<p>To learn how to build plugins for freeboard, please visit <a target="_blank" href="http://freeboard.github.io/freeboard/docs/plugin_example.html">http://freeboard.github.io/freeboard/docs/plugin_example.html</a></p>'),_.each(a.plugins(),function(a){b(a)}),e.click(function(a){b()}),new DialogBox(d,"Developer Console","OK",null,function(){_.each(a.plugins(),function(a){$('script[src^="'+a+'"]').remove()}),a.plugins.removeAll(),_.each(c,function(b){var c=b.val();c&&c.length>0&&(a.addPluginSource(c),head.js(c+"?"+Date.now()))})})}return{showDeveloperConsole:function(){b()}}},JSEditor=function(){function a(a){c=a}function b(a,b,c){var d='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (datasources["MyDatasource"].sensor.tempInF * 1.8 + 32).toFixed(2);';a||(a=b&&b.exampleText?b.exampleText:d);var e=$('<div class="code-window"></div>'),f=$('<div class="code-mirror-wrapper"></div>'),g=$('<div class="code-window-footer"></div>'),h='This javascript will be re-evaluated any time a datasource referenced here is updated, and the value you <code><span class="cm-keyword">return</span></code> will be displayed in the widget. You can assume this javascript is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">datasources</span>)</code> where datasources is a collection of javascript objects (keyed by their name) corresponding to the most current data in a datasource.',i=b&&b.helpText?b.helpText:h,j=$('<div class="code-window-header cm-s-ambiance">'+i+"</div>");e.append([j,f,g]),$("body").append(e);var k=CodeMirror(f.get(0),{value:a,mode:"javascript",theme:"ambiance",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0}),l=$('<span id="dialog-cancel-code" class="text-button">Close</span>').click(function(){if(c){var a=k.getValue();a===d&&(a=""),c(a),e.remove()}});g.append(l)}var c="";return{displayJSEditor:function(a,c,d){b(a,c,d)},setAssetRoot:function(b){a(b)}}},JSEditorOld=function(){function a(a){c=a}function b(a,b){var c='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (datasources["MyDatasource"].sensor.tempInF * 1.8 + 32).toFixed(2);';a||(a=c);var d=$('<div class="code-window"></div>'),e=$('<div class="code-mirror-wrapper"></div>'),f=$('<div class="code-window-footer"></div>'),g=$('<div class="code-window-header cm-s-ambiance">This javascript will be re-evaluated any time a datasource referenced here is updated, and the value you <code><span class="cm-keyword">return</span></code> will be displayed in the widget. You can assume this javascript is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">datasources</span>)</code> where datasources is a collection of javascript objects (keyed by their name) corresponding to the most current data in a datasource.</div>');d.append([g,e,f]),$("body").append(d);var h=CodeMirror(e.get(0),{value:a,mode:"javascript",theme:"ambiance",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0}),i=$('<span id="dialog-cancel-code" class="text-button">Close</span>').click(function(){if(b){var a=h.getValue();a===c&&(a=""),b(a),d.remove()}});f.append(i)}var c="";return{displayJSEditor:function(a,c){b(a,c)},setAssetRoot:function(b){a(b)}}};var PARSER_LABEL={INCOMING:"INCOMING PARSER",OUTGOING:"OUTGOING PARSER"};PluginEditor=function(a,b,c,d){function e(a,b){var c=$('<div class="validation-error"></div>').html(b);$("#setting-value-container-"+a).append(c)}function f(){$("#setting-row-instance-name").length?$("#setting-row-instance-name").nextAll().remove():$("#setting-row-plugin-types").nextAll().remove()}function g(a){return!isNaN(parseFloat(a))&&isFinite(a)}function h(b,c,d,e){return $('<li><i class="icon-fullscreen"></i><label>'+b+"</label></li>").mousedown(function(b){b.preventDefault(),a.displayJSEditor(d(),c,e)})}function j(a,b,c,d){var e=$('<div class="styled-select"></div>'),f=$("<select>").css({position:"absolute",width:"414px",height:"30px",resize:"none","white-space":"nowrap",overflow:"auto"}),g=$('<ul class="board-toolbar datasource-input-suffix"></ul>'),j=$('<div class="calculated-setting-row">'),k=freeboard.getDatasources(),l="",q="";if(b&&b.dsName&&void 0!==b.dsName)q=b.dsName;else{if(!(k.length>0))return void console.warn("Portal has no datasources to select from.");b.dsName=q=k[0].name()}void 0===b._debug&&(b._debug=!1);for(i in k){l=k[i].name();var r=$("<option>").val(l).text(l);l===q&&r.attr("selected","selected"),f.append(r)}f.change(function(){b.dsName=f.val(),b=s(b)}),e.append([f,g]),j.append(e),c.incoming_parser&&(b.incoming_parser||(b.incoming_parser=o,b=s(b)),g.append(h(PARSER_LABEL.INCOMING,{helpText:m,exampleText:b.incoming_parser},function(){return b.incoming_parser||""},function(a){b.incoming_parser=a}))),c.outgoing_parser&&(b.outgoing_parser||(b.outgoing_parser=p,b=s(b)),g.append(h(PARSER_LABEL.OUTGOING,{helpText:n,exampleText:b.outgoing_parser},function(){return b.outgoing_parser||""},function(a){b.outgoing_parser=a})));var t=$('<input type="checkbox">').css({width:"25px"}).on("change",function(a){a.preventDefault(),b._debug=!b._debug});b._debug&&t.attr("checked","checked");var u=$("<label>").text("Debug").css("margin-top","-6px").prepend(t),v=$("<li>").append(u);if(g.append(v),d&&_.isFunction(d)){var w=$('<li class="remove-setting-row"><i class="icon-minus"></i><label></label></li>').mousedown(function(a){a.preventDefault(),j.remove(),d(b)});g.prepend(w)}$(a).append(j)}function k(a,b,c,d,k){function m(a,b){var c=$('<div id="setting-row-'+a+'" class="form-row"></div>').appendTo(o);return c.append('<div class="form-label"><label class="control-label">'+b+"</label></div>"),$('<div id="setting-value-container-'+a+'" class="form-value"></div>').appendTo(c)}function n(a,b,c){_.each(a,function(a){function e(){q.settings[a.name].length>0?t.show():t.hide()}function f(b){var c=$("<tr></tr>").appendTo(v),d={};_.isArray(q.settings[a.name])||(q.settings[a.name]=[]),q.settings[a.name].push(d),_.each(a.settings,function(a){var e=$("<td></td>").appendTo(c),f="";_.isUndefined(b[a.name])||(f=b[a.name]),d[a.name]=f,$('<input class="table-row-value" type="text">').appendTo(e).val(f).change(function(){d[a.name]=$(this).val()})}),c.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="icon-trash icon-white"></i>').click(function(){var b=q.settings[a.name].indexOf(d);-1!=b&&(q.settings[a.name].splice(b,1),c.remove(),e())}))))),r.scrollTop(r[0].scrollHeight),e()}function g(b){for(i=0,len=q.settings[a.name].length;i<len;i++)if(_.isEqual(q.settings[a.name][i],b)){q.settings[a.name].splice(i,1);break}}function k(){var b=$("<textarea></textarea>").css({position:"absolute",width:"400px",height:"20px",resize:"none","white-space":"nowrap",overflow:"auto","z-index":"10"}).val(d[a.name]||""),c=$('<ul class="board-toolbar datasource-input-suffix"></ul>'),e=$('<div class="calculated-setting-row"></div>');b.change(function(){B.find("textarea").each(function(b){var c=$(this).val();c&&(q.settings[a.name]=c)})}),e.append(b).append(c),c.append(h("STATIC DATA",{helpText:"static help",exampleText:"static example"},function(){return q.settings[a.name]||""},function(a){b.val(a),b.change()})),C.hide(),B.append(e)}function l(){if(a.name in d){var b=d[a.name];if(a.multi_input&&_.isArray(b))for(var c,e=0;e<b.length;e++)q.settings[a.name].push(b[e]),e>0&&(c=g),j(B,q.settings[a.name][e],a,c),!0;else _.isArray(b)&&b.length>0?(q.settings[a.name].push(b[0]),j(B,q.settings[a.name][0],a,null)):(q.settings[a.name].push({}),j(B,q.settings[a.name][0],a,null))}else q.settings[a.name].push({}),j(B,q.settings[a.name][0],a,null);!0===a.multi_input&&C.show()}function n(b){switch(B.empty(),q.settings._datatype=b,b){case"static":q.settings[a.name]=d[a.name]||"",D.attr("selected","selected"),k();break;case"dynamic":q.settings[a.name]=[],E.attr("selected","selected"),l();break;default:D.attr("selected","selected"),k()}}!_.isUndefined(a.default_value)&&_.isUndefined(d[a.name])&&(d[a.name]=a.default_value);var o=a.name;_.isUndefined(a.display_name)||(o=a.display_name);var p=m(a.name,o);switch(a.type){case"array":var r=$('<div class="form-table-value-subtable"></div>').appendTo(p),s=$('<table class="table table-condensed sub-table"></table>').appendTo(r),t=$("<thead></thead>").hide().appendTo(s),u=$("<tr></tr>").appendTo(t),v=$("<tbody></tbody>").appendTo(s),w=[];_.each(a.settings,function(a){var b=a.name;_.isUndefined(a.display_name)||(b=a.display_name),$("<th>"+b+"</th>").appendTo(u)}),a.name in d&&(w=d[a.name]),$('<div class="table-operation text-button">ADD</div>').appendTo(p).click(function(){var b={};_.each(a.settings,function(a){b[a.name]=""}),f(b)}),_.each(w,function(a,b){f(a)});break;case"boolean":q.settings[a.name]=d[a.name];var x=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+a.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(p),y=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+a.name+'-onoff">').prependTo(x).change(function(){q.settings[a.name]=this.checked});a.name in d&&y.prop("checked",d[a.name]);break;case"option":var z=d[a.name],y=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(p)).change(function(){q.settings[a.name]=$(this).val()});_.each(a.options,function(a){var b,c;_.isObject(a)?(b=a.name,c=a.value):b=a,_.isUndefined(c)&&(c=b),_.isUndefined(z)&&(z=c),$("<option></option>").text(b).attr("value",c).appendTo(y)}),q.settings[a.name]=z,a.name in d&&y.val(d[a.name]);break;case"data":void 0!==d._datatype&&(q.settings._datatype=d._datatype);var A=$("<div>"),B=$("<div>"),C=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="icon-plus"></i><label>ADD</label></li></ul>').css({"margin-bottom":"5px",display:"none"}).mousedown(function(b){b.preventDefault(),q.settings[a.name].push({}),j(B,q.settings[a.name][q.settings[a.name].length-1],a,g)});A.append([B,C]);var D=$("<option>").val("static").text("Static"),E=$("<option>").val("dynamic").text("Dynamic"),F=$("<select>").appendTo($('<div class="styled-select"></div>').css("margin-bottom","5px").appendTo(p)).on("change",function(){n(F.val())});if(void 0!==a.force_data){switch(a.force_data){case"dynamic":F.append(E);break;case"static":F.append(D);break;default:console.error("Error: unrecognized forced datatype")}n(a.force_data)}else F.append([D,E]),n(void 0!==q.settings._datatype?q.settings._datatype:"static");p.append(A);break;default:q.settings[a.name]=d[a.name];var y=$('<input type="text">').appendTo(p).change(function(){"number"==a.type?q.settings[a.name]=Number($(this).val()):q.settings[a.name]=$(this).val()});if(a.name in d&&y.val(d[a.name]),b&&a.typeahead_data_field&&y.addClass("typeahead_data_field-"+a.typeahead_data_field),b&&a.typeahead_field){var G=[];y.keyup(function(a){a.which>=65&&a.which<=91&&y.trigger("change")}),$(y).autocomplete({source:G,select:function(a,b){y.val(b.item.value),y.trigger("change")}}),y.change(function(d){var e=y.val(),f=_.template(b)({input:e});$.get(f,function(b){if(c&&(b=b[c]),b=_.select(b,function(b){return b[a.typeahead_field][0]==e[0]}),G=_.map(b,function(b){return b[a.typeahead_field]}),$(y).autocomplete("option","source",G),1==b.length){b=b[0];for(var d in b)if(b.hasOwnProperty(d)){var f=$(_.template("input.typeahead_data_field-<%= field %>")({field:d}));f&&(f.val(b[d]),f.val()!=y.val()&&f.trigger("change"))}}})})}}_.isUndefined(a.suffix)||p.append($('<div class="input-suffix">'+a.suffix+"</div>")),_.isUndefined(a.description)||p.append($('<div class="setting-description">'+a.description+"</div>"))})}q={type:c,settings:{}};var o=$("<div></div>"),p=$('<div id="plugin-description"></div>').hide();o.append(p),new DialogBox(o,a,"Save","Cancel",function(){$(".validation-error").remove(),$("textarea").blur();for(var a=0;a<l.settings.length;a++){var b=l.settings[a];if(b.required&&(_.isUndefined(q.settings[b.name])||""==q.settings[b.name]))return e(b.name,"This is required."),!0;if("integer"==b.type&&q.settings[b.name]%1!=0)return e(b.name,"Must be a whole number."),!0;if("number"==b.type&&!g(q.settings[b.name]))return e(b.name,"Must be a number."),!0}_.isFunction(k)&&k(q)});var r,s=_.keys(b);if(s.length>1){var t=m("plugin-types","Type");r=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(t)),r.append($("<option>Select a type...</option>").attr("value","undefined"));var u=[];for(var v in b)u.push({display_name:b[v].display_name,type_name:b[v].type_name});u.sort(function(a,b){return a.display_name.localeCompare(b.display_name)}),_.each(u,function(a){r.append($("<option></option>").text(a.display_name).attr("value",a.type_name))}),r.change(function(){q.type=$(this).val(),q.settings={},f(),l=b[r.val()],_.isUndefined(l)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#setting-row-instance-name").show(),l.description&&l.description.length>0?p.html(l.description).show():p.hide(),$("#dialog-ok").show(),n(l.settings,l.typeahead_source,l.typeahead_data_segment))})}else 1==s.length&&(l=b[s[0]],q.type=l.type_name,q.settings={},n(l.settings));r&&(_.isUndefined(c)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#dialog-ok").show(),r.val(c).trigger("change")))}var l,m='This javascript will be re-evaluated any time the corresponding datasource is updated, and the value you <code><span class="cm-keyword">return</span></code> will be displayed in the widget. You have access to the following: <br> 1) The <code><span class="cm-keyword">this</span></code> keyword which has the following properties - <br> &nbsp;&nbsp;&nbsp;&nbsp; <code><span class="cm-keyword">widget</span></code> (widget that uses the datasource) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i. Use this to retrieve the current value for your widget, e.g., <code><span class="cm-keyword">this.widget</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; <code><span class="cm-keyword">datasource</span></code> (datasource which triggered the parser) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i. Use this to retrieve the current value for your datasource, e.g., <code><span class="cm-keyword">this.datasource</span></code>  <br>  2) A variable named <code><span class="cm-keyword">datasources</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; Use this to access any datasource within your portal. e.g., <code><span class="cm-keyword">datasources["dataSourceName"].latestData()</span> <br> 3) A variable named <code><span class="cm-keyword">panes</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; Use this to access any pane within your portal. e.g., <code><span class="cm-keyword">panes["uniquePaneId"].updateCurrentTab(2)</span></code>',n='This javascript will be re-evaluated any time this widget\'s state changes, and the value you <code><span class="cm-keyword">return</span></code> will be sent to this datasource. You have access to the following: <br> 1) The <code><span class="cm-keyword">this</span></code> keyword which has the following properties - <br> &nbsp;&nbsp;&nbsp;&nbsp; <code><span class="cm-keyword">widget</span></code> (widget that uses the datasource) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i. Use this to retrieve the current value for your widget, e.g., <code><span class="cm-keyword">this.widget</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; <code><span class="cm-keyword">datasource</span></code> (datasource which triggered the parser) <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i. Use this to retrieve the current value for your datasource, e.g., <code><span class="cm-keyword">this.datasource</span></code>  <br>  2) A variable named <code><span class="cm-keyword">datasources</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; Use this to access any datasource within your portal. e.g., <code><span class="cm-keyword">datasources["dataSourceName"].latestData()</span> <br> 3) A variable named <code><span class="cm-keyword">panes</span></code> <br> &nbsp;&nbsp;&nbsp;&nbsp; Use this to access any pane within your portal. e.g., <code><span class="cm-keyword">panes["uniquePaneId"].updateCurrentTab(2)</span></code>',o="// default - return the value for the datasource \nreturn this.datasource;",p="// default - return the value for the widget \nreturn this.widget;",q={type:"",settings:{}},r=function(a){var b=freeboard.getDatasources();for(i in b)if(b[i].name()===a)return b[i];return null},s=function(a){var b=r(a.dsName);if(null===b)return console.error("unknown datasource"),a;var c=b.type();return void 0===l.default_parsers||void 0===l.default_parsers[c]?(void 0!==a.outgoing_parser&&(a.outgoing_parser=p),void 0!==a.incoming_parser&&(a.incoming_parser=o),a):(void 0!==a.incoming_parser&&(void 0!==l.default_parsers[c].incoming?a.incoming_parser=l.default_parsers[c].incoming:a.incoming_parser=o),void 0!==a.outgoing_parser&&(void 0!==l.default_parsers[c].outgoing?a.outgoing_parser=l.default_parsers[c].outgoing:a.outgoing_parser=p),a)};return{createPluginEditor:function(a,b,c,d,e,f){k(a,b,c,d,e,f)}}},ValueEditor=function(a){function b(a,b){switch(b){case m.ANY:return!0;case m.ARRAY:return _.isArray(a);case m.OBJECT:return _.isObject(a);case m.STRING:return _.isString(a);case m.NUMBER:return _.isNumber(a);case m.BOOLEAN:return _.isBoolean(a)}}function c(a,c){$(a).parent().find(".validation-error").remove(),b(l,c)||$(a).parent().append("<div class='validation-error'>This field expects an expression that evaluates to type "+c+".</div>")}function d(a){var b=($(a).val().match(/\n/g)||[]).length,c=Math.min(200,20*(b+1));$(a).css({height:c+"px"})}function e(a,b,c){var d=[];if(b)for(var e,f=0,g=b.length;f<g;f++)e=b[f].name(),e.indexOf(a)>-1&&d.push({value:e,entity:b[f].getDataRepresentation("data"),precede_char:"",follow_char:""});k=d}function f(b,d){var f=$(b).val().substring(0,$(b).getCaretPosition());if(f=f.replace(String.fromCharCode(160)," "),e(f,a.datasources(),d),k.length>0){i||(i=$('<ul id="value-selector" class="value-dropdown"></ul>').insertAfter(b).width($(b).outerWidth()-2).css("left",$(b).position().left).css("top",$(b).position().top+$(b).outerHeight()-1)),i.empty(),i.scrollTop(0);var h=!0;j=0,_.each(k,function(a,c){var d=g(b,f,a,c);h&&($(d).addClass("selected"),h=!1)})}else c(b,d),$(b).next("ul#value-selector").remove(),i=null,j=-1}function g(a,b,c,d){var e=c.value;return c.preview&&(e=e+"<span class='preview'>"+c.preview+"</span>"),$("<li>"+e+"</li>").appendTo(i).mouseenter(function(){$(this).trigger("freeboard-select")}).mousedown(function(a){$(this).trigger("freeboard-insertValue"),a.preventDefault()}).data("freeboard-optionIndex",d).data("freeboard-optionValue",c.value).bind("freeboard-insertValue",function(){var d=c.value;d=c.precede_char+d+c.follow_char;var e=b.lastIndexOf("]");-1!=e?$(a).replaceTextAt(e+1,$(a).val().length,d):$(a).insertAtCaret(d),l=c.entity,$(a).triggerHandler("mouseup")}).bind("freeboard-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),j=$(this).data("freeboard-optionIndex")})}function h(a,b){$(a).addClass("calculated-value-input").bind("keyup mouseup freeboard-eval",function(c){if(i&&"keyup"==c.type&&(38==c.keyCode||40==c.keyCode||13==c.keyCode))return void c.preventDefault();f(a,b)}).focus(function(){$(a).css({"z-index":3001}),d(a)}).focusout(function(){c(a,b),$(a).css({height:"","z-index":3e3}),$(a).next("ul#value-selector").remove(),i=null,j=-1}).bind("keydown",function(a){if(i)if(38==a.keyCode||40==a.keyCode){a.preventDefault();var b=$(i).find("li");38==a.keyCode?j--:40==a.keyCode&&j++,j<0?j=b.size()-1:j>=b.size()&&(j=0);var c=$(b).eq(j);c.trigger("freeboard-select"),$(i).scrollTop($(c).position().top)}else 13==a.keyCode&&(a.preventDefault(),-1!=j&&$(i).find("li").eq(j).trigger("freeboard-insertValue"))})}var i=(new RegExp('.*datasources\\["([^"]*)("\\])?(.*)$'),null),j=0,k=[],l=null,m={ANY:"any",ARRAY:"array",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean"};return{createValueEditor:function(a,b){b?h(a,b):h(a,m.ANY)},EXPECTED_TYPE:m}},ValueEditorOld=function(a){function b(a,b){return!(!_.isArray(a)&&!_.isObject(a))||c(a,b)}function c(a,b){switch(b){case o.ANY:return!0;case o.ARRAY:return _.isArray(a);case o.OBJECT:return _.isObject(a);case o.STRING:return _.isString(a);case o.NUMBER:return _.isNumber(a);case o.BOOLEAN:return _.isBoolean(a)}}function d(a,b){$(a).parent().find(".validation-error").remove(),c(n,b)||$(a).parent().append("<div class='validation-error'>This field expects an expression that evaluates to type "+b+".</div>")}function e(a){var b=($(a).val().match(/\n/g)||[]).length,c=Math.min(200,20*(b+1));$(a).css({height:c+"px"})}function f(a,c,d){var e=j.exec(a),f=[];if(e)if(""==e[1])_.each(c,function(a){f.push({value:a.name(),entity:void 0,precede_char:"",follow_char:'"]'})});else if(""!=e[1]&&_.isUndefined(e[2])){var g=e[1];_.each(c,function(a){var b=a.name();b!=g&&0==b.indexOf(g)&&f.push({value:b,entity:void 0,precede_char:"",follow_char:'"]'})})}else{var h=_.find(c,function(a){return a.name()===e[1]});if(!_.isUndefined(h)){var i="data",k="";if(!_.isUndefined(e[2])){var l=e[3].lastIndexOf("]")+1;i+=e[3].substring(0,l),k=e[3].substring(l,e[3].length),k=k.replace(/^[\[\"]*/,""),k=k.replace(/[\"\]]*$/,"")}var o=h.getDataRepresentation(i);if(n=o,_.isArray(o)){for(var p=0;p<o.length;p++)if(0==p.toString().indexOf(k)){var q=o[p];b(q,d)&&f.push({value:p,entity:q,precede_char:"[",follow_char:"]",preview:q.toString()})}}else _.isObject(o)&&_.each(o,function(a,c){0==c.indexOf(k)&&b(a,d)&&f.push({value:c,entity:a,precede_char:'["',follow_char:'"]'})})}}m=f}function g(b,c){var e=$(b).val().substring(0,$(b).getCaretPosition());if(e=e.replace(String.fromCharCode(160)," "),f(e,a.datasources(),c),m.length>0){k||(k=$('<ul id="value-selector" class="value-dropdown"></ul>').insertAfter(b).width($(b).outerWidth()-2).css("left",$(b).position().left).css("top",$(b).position().top+$(b).outerHeight()-1)),k.empty(),k.scrollTop(0);var g=!0;l=0,_.each(m,function(a,c){var d=h(b,e,a,c);g&&($(d).addClass("selected"),g=!1)})}else d(b,c),$(b).next("ul#value-selector").remove(),k=null,l=-1}function h(a,b,c,d){var e=c.value;return c.preview&&(e=e+"<span class='preview'>"+c.preview+"</span>"),$("<li>"+e+"</li>").appendTo(k).mouseenter(function(){$(this).trigger("freeboard-select")}).mousedown(function(a){$(this).trigger("freeboard-insertValue"),a.preventDefault()}).data("freeboard-optionIndex",d).data("freeboard-optionValue",c.value).bind("freeboard-insertValue",function(){var d=c.value;d=c.precede_char+d+c.follow_char;var e=b.lastIndexOf("]");-1!=e?$(a).replaceTextAt(e+1,$(a).val().length,d):$(a).insertAtCaret(d),n=c.entity,$(a).triggerHandler("mouseup")}).bind("freeboard-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),l=$(this).data("freeboard-optionIndex")})}function i(a,b){$(a).addClass("calculated-value-input").bind("keyup mouseup freeboard-eval",function(c){if(k&&"keyup"==c.type&&(38==c.keyCode||40==c.keyCode||13==c.keyCode))return void c.preventDefault();g(a,b)}).focus(function(){$(a).css({"z-index":3001}),e(a)}).focusout(function(){d(a,b),$(a).css({height:"","z-index":3e3}),$(a).next("ul#value-selector").remove(),k=null,l=-1}).bind("keydown",function(a){if(k)if(38==a.keyCode||40==a.keyCode){a.preventDefault();var b=$(k).find("li");38==a.keyCode?l--:40==a.keyCode&&l++,l<0?l=b.size()-1:l>=b.size()&&(l=0);var c=$(b).eq(l);c.trigger("freeboard-select"),$(k).scrollTop($(c).position().top)}else 13==a.keyCode&&(a.preventDefault(),-1!=l&&$(k).find("li").eq(l).trigger("freeboard-insertValue"))})}var j=new RegExp('.*datasources\\["([^"]*)("\\])?(.*)$'),k=null,l=0,m=[],n=null,o={ANY:"any",ARRAY:"array",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean"};return{createValueEditor:function(a,b){b?i(a,b):i(a,o.ANY)},EXPECTED_TYPE:o}},function(a){function b(){var a=document.createElement("p"),b=!1;if(a.addEventListener)a.addEventListener("DOMAttrModified",function(){b=!0},!1);else{if(!a.attachEvent)return!1;a.attachEvent("onDOMAttrModified",function(){b=!0})}return a.setAttribute("id","target"),b}function c(b,c){if(b){var d=this.data("attr-old-value");if(c.attributeName.indexOf("style")>=0){d.style||(d.style={});var e=c.attributeName.split(".");c.attributeName=e[0],c.oldValue=d.style[e[1]],c.newValue=e[1]+":"+this.prop("style")[a.camelCase(e[1])],d.style[e[1]]=c.newValue}else c.oldValue=d[c.attributeName],c.newValue=this.attr(c.attributeName),d[c.attributeName]=c.newValue;this.data("attr-old-value",d)}}var d=window.MutationObserver||window.WebKitMutationObserver;a.fn.attrchange=function(e){var f={trackValues:!1,callback:a.noop};if("function"==typeof e?f.callback=e:a.extend(f,e),f.trackValues&&a(this).each(function(b,c){for(var d,e={},b=0,f=c.attributes,g=f.length;b<g;b++)d=f.item(b),e[d.nodeName]=d.value;a(this).data("attr-old-value",e)}),d){var g={subtree:!1,attributes:!0,attributeOldValue:f.trackValues},h=new d(function(b){b.forEach(function(b){var c=b.target;f.trackValues&&(b.newValue=a(c).attr(b.attributeName)),f.callback.call(c,b)})});return this.each(function(){h.observe(this,g)})}return b()?this.on("DOMAttrModified",function(a){a.originalEvent&&(a=a.originalEvent),a.attributeName=a.attrName,a.oldValue=a.prevValue,f.callback.call(this,a)}):"onpropertychange"in document.body?this.on("propertychange",function(b){b.attributeName=window.event.propertyName,c.call(a(this),f.trackValues,b),f.callback.call(this,b)}):this}}(jQuery),function(a){a.eventEmitter={_JQInit:function(){this._JQ=a(this)},emit:function(a,b){!this._JQ&&this._JQInit(),this._JQ.trigger(a,b)},once:function(a,b){!this._JQ&&this._JQInit(),this._JQ.one(a,b)},on:function(a,b){!this._JQ&&this._JQInit(),this._JQ.bind(a,b)},off:function(a,b){!this._JQ&&this._JQInit(),this._JQ.unbind(a,b)}}}(jQuery);var freeboard=function(){function a(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var b={},c={},d=new FreeboardUI,e=new FreeboardModel(b,c,d),f=new JSEditor,g=new JSEditorOld,h=new ValueEditor(e),i=new ValueEditorOld(e),j=new PluginEditor(f,g,h,i),k=new DeveloperConsole(e),l={values:{"font-family":'"HelveticaNeue-UltraLight", "Helvetica Neue Ultra Light", "Helvetica Neue", sans-serif',color:"#d3d4d4","font-weight":100}};return ko.bindingHandlers.pluginEditor={init:function(a,f,g,h,i){var k=ko.unwrap(f()),l={},m=void 0,n="";"datasource"==k.type?(l=b,n="Datasource"):"widget"==k.type?(l=c,n="Widget"):"pane"==k.type&&(n="Pane"),$(a).click(function(f){if("delete"==k.operation){new DialogBox($("<p>Are you sure you want to delete this "+n+"?</p>"),"Confirm Delete","Yes","No",function(){window.Need_Save=!0,"datasource"==k.type?e.deleteDatasource(h):"widget"==k.type?e.deleteWidget(h):"pane"==k.type&&e.deletePane(h)})}else{var g=void 0;"datasource"==k.type?"add"==k.operation?m={}:(g=h.type(),m=h.settings(),m.name=h.name()):"widget"==k.type?"add"==k.operation?m={}:(g=h.type(),m=h.settings()):"pane"==k.type&&(m={},"edit"==k.operation&&(m.title=h.title(),m.col_width=h.col_width(),m.pane_type=h.pane_type(),m.display_header=h.display_header(),m.pane_id=h.pane_id(),m.header_theme=h.header_theme()),l={settings:{settings:[{name:"title",display_name:"Title",type:"text"},{name:"col_width",display_name:"Columns",type:"integer",default_value:1,required:!0},{name:"pane_type",display_name:"Tabbed Pane",type:"boolean",default_value:!1},{name:"display_header",display_name:"Display Header",type:"boolean",default_value:!0},{name:"header_theme",display_name:"Theme",type:"option",options:[{name:"Primary",value:"primary"},{name:"Secondary",value:"secondary"}]},{name:"pane_id",display_name:"Pane ID",type:"text",description:"Optional: Unique ID for pane. Necessary for updating panes programmatically"}]}}),j.createPluginEditor(n,l,g,m,function(f){if(window.Need_Save=!0,"add"==k.operation){if("datasource"==k.type){var g=new DatasourceModel(e,b);e.addDatasource(g),g.name(f.settings.name),delete f.settings.name,g.settings(f.settings),g.type(f.type)}else if("widget"==k.type){var g=new WidgetModel(e,c);g.settings(f.settings),g.type(f.type),h.addWidget(g),d.attachWidgetEditIcons(a),d.processResize(!0)}}else if("edit"==k.operation)if("pane"==k.type){if(h.title(f.settings.title),h.col_width(f.settings.col_width),!f.settings.pane_type&&void 0!==h.tabs()){for(var i=h.tabs();i.length>1;)i[0].widgets(i[0].widgets().concat(i[1].widgets())),i.splice(1,1);h.updateCurrentTab(0)}h.pane_type(f.settings.pane_type),h.display_header(f.settings.display_header),h.header_theme(f.settings.header_theme),h.pane_id(f.settings.pane_id),d.processResize(!1)}else"datasource"==k.type?(h.name(f.settings.name),delete f.settings.name):"widget"==k.type&&d.processResize(!0),h.type(f.type),h.settings(f.settings)})}})}},ko.virtualElements.allowedBindings.datasourceTypeSettings=!0,ko.bindingHandlers.datasourceTypeSettings={update:function(a,b,c,d,e){processPluginSettings(a,b,c,d,e)}},ko.bindingHandlers.pane={init:function(a,b,c,f,g){e.isEditing()&&$(a).css({cursor:"pointer"}),d.addPane(a,f,g.$root.isEditing())},update:function(a,b,c,f,g){-1==e.panes.indexOf(f)&&d.removePane(a),d.updatePane(a,f)}},ko.bindingHandlers.widget={init:function(a,b,c,f,g){e.isEditing()&&d.attachWidgetEditIcons($(a).parent())},update:function(a,b,c,d,e){d.shouldRender()&&($(a).empty(),d.render(a))}},$(function(){function a(){d.processResize(!0)}d.showLoadingIndicator(!0);var b;$(window).resize(function(){clearTimeout(b),b=setTimeout(a,500)})}),{initialize:function(b,c){ko.applyBindings(e);var f=a("load");""!=f?$.ajax({url:f,success:function(a){e.loadDashboard(a),_.isFunction(c)&&c()}}):(e.allow_edit(b),e.setEditing(b),d.showLoadingIndicator(!1),_.isFunction(c)&&c(),freeboard.emit("initialized"))},newDashboard:function(){e.loadDashboard({allow_edit:!0})},loadDashboard:function(a,b){e.loadDashboard(a,b)},serialize:function(){return e.serialize()},setEditing:function(a,b){e.setEditing(a,b)},isEditing:function(){return e.isEditing()},loadDatasourcePlugin:function(a){_.isUndefined(a.display_name)&&(a.display_name=a.type_name),a.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}),e.addPluginSource(a.source),b[a.type_name]=a,e._datasourceTypes.valueHasMutated()},resize:function(){canResize&&d.processResize(!0)},loadWidgetPlugin:function(a){_.isUndefined(a.display_name)&&(a.display_name=a.type_name),e.addPluginSource(a.source),c[a.type_name]=a,e._widgetTypes.valueHasMutated()},setAssetRoot:function(a){f.setAssetRoot(a)},addStyle:function(a,b){var c=a+"{"+b+"}",d=$("style#fb-styles");0==d.length&&(d=$('<style id="fb-styles" type="text/css"></style>'),$("head").append(d)),d[0].styleSheet?d[0].styleSheet.cssText+=c:d.text(d.text()+c)},showLoadingIndicator:function(a){d.showLoadingIndicator(a)},showDialog:function(a,b,c,d,e){new DialogBox(a,b,c,d,e)},getDatasource:function(a){var b=e.datasources(),c=_.find(b,function(b){return b.name()===a});return c||null},getDatasources:function(){return e.datasources()},getDatasourceSettings:function(a){var b=this.getDatasource(a);return b?b.settings():null},setDatasourceSettings:function(a,b){var c=e.datasources(),d=_.find(c,function(b){return b.name()===a});if(!d)return void console.log("Datasource not found");var f=_.defaults(b,d.settings());d.settings(f)},getStyleString:function(a){var b="";return _.each(l[a],function(a,c){b=b+c+":"+a+";"}),b},getStyleObject:function(a){return l[a]},showDeveloperConsole:function(){k.showDeveloperConsole()},getUserPermission:function(){return e.getUserPermission()},setUserPermission:function(a){e.setUserPermission(a)}}}();$.extend(freeboard,jQuery.eventEmitter);